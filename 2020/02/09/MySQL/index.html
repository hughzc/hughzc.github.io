<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('https://hughzc.github.io').hostname,
    root: '/',
    scheme: 'Pisces',
    version: '7.6.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="尚硅谷MySQL课程笔记  数据库操作基础数据库概述优点 可将数据持久化到硬盘 可存储大量数据 方便检索 保证数据的一致性，完整性 安全，可共享 通过组合分析，可以产生新数据">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL">
<meta property="og:url" content="https://hughzc.github.io/2020/02/09/MySQL/index.html">
<meta property="og:site_name" content="未名的奇妙旅程">
<meta property="og:description" content="尚硅谷MySQL课程笔记  数据库操作基础数据库概述优点 可将数据持久化到硬盘 可存储大量数据 方便检索 保证数据的一致性，完整性 安全，可共享 通过组合分析，可以产生新数据">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E5%AD%97%E6%AE%B5.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E6%9F%A5%E8%AF%A2%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E8%B5%B7%E5%88%AB%E5%90%8D%E5%89%8D.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E8%B5%B7%E5%88%AB%E5%90%8D%E5%90%8E.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%8A%A0%E6%B3%95.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/concat%E6%8B%BC%E6%8E%A5.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E9%87%8D%E5%A4%8D%E9%83%A8%E9%97%A8%E7%BC%96%E5%8F%B7.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E7%BC%96%E5%8F%B7%E5%8E%BB%E9%87%8D.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E6%98%BE%E7%A4%BA%E8%A1%A8%E7%BB%93%E6%9E%84.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%B8%A6%E9%80%97%E5%8F%B7%E6%8B%BC%E6%8E%A5.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/IFNULL%E4%BD%BF%E7%94%A8.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/LENGTH%E5%87%BD%E6%95%B0.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%B7%A5%E8%B5%84%E5%8D%87%E5%BA%8F%E7%BC%96%E5%8F%B7%E9%99%8D%E5%BA%8F.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%BC%95%E5%8F%B7%E6%8E%92%E5%BA%8F.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/NOW%E5%87%BD%E6%95%B0.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%BD%93%E5%89%8D%E6%97%A5%E6%9C%9F.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E6%97%A5%E6%9C%9F%E8%BD%AC%E6%8D%A2.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E8%87%AA%E8%BF%9E%E6%8E%A5.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%9B%BD%E5%AE%B6%E5%AF%B9%E9%83%A8%E9%97%A8%E8%A1%A8.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/jobgrades.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%B7%A6%E6%9F%A5%E8%AF%A21.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E4%B8%89%E7%A7%8D%E8%BF%9E%E6%8E%A5.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E5%B7%A6%E5%A4%96%E5%8F%B3%E5%A4%96%E5%85%A8%E5%A4%96.png">
<meta property="og:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E7%94%B7%E7%94%9F%E5%A5%B3%E7%94%9F.png">
<meta property="article:published_time" content="2020-02-09T02:37:14.000Z">
<meta property="article:modified_time" content="2020-03-11T09:04:34.747Z">
<meta property="article:author" content="未名Hugh">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hughzc.github.io/2020/02/09/MySQL/%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E5%AD%97%E6%AE%B5.png">

<link rel="canonical" href="https://hughzc.github.io/2020/02/09/MySQL/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>MySQL | 未名的奇妙旅程</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">未名的奇妙旅程</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">未名的技术博客，记录学习点滴</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://hughzc.github.io/2020/02/09/MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="未名Hugh">
      <meta itemprop="description" content="技术博客，Java，Spring Boot，并发编程，网络编程">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="未名的奇妙旅程">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-09 10:37:14" itemprop="dateCreated datePublished" datetime="2020-02-09T10:37:14+08:00">2020-02-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-11 17:04:34" itemprop="dateModified" datetime="2020-03-11T17:04:34+08:00">2020-03-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>尚硅谷MySQL课程笔记</p>
</blockquote>
<h1 id="数据库操作基础"><a href="#数据库操作基础" class="headerlink" title="数据库操作基础"></a>数据库操作基础</h1><h2 id="数据库概述"><a href="#数据库概述" class="headerlink" title="数据库概述"></a>数据库概述</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul>
<li><strong>可将数据持久化到硬盘</strong></li>
<li><strong>可存储大量数据</strong></li>
<li><strong>方便检索</strong></li>
<li>保证数据的一致性，完整性</li>
<li>安全，可共享</li>
<li>通过组合分析，可以产生新数据</li>
</ul>
<a id="more"></a>

<h3 id="常见数据库产品"><a href="#常见数据库产品" class="headerlink" title="常见数据库产品"></a>常见数据库产品</h3><ul>
<li>Oracle：甲骨文（产品免费，服务收费）</li>
<li>DB2：IBM（兼容性相对不好）</li>
<li>SQL Server：微软（兼容性不好）</li>
<li>MySQL：甲骨文（开源，免费，性能高）</li>
</ul>
<h3 id="数据库相关概念"><a href="#数据库相关概念" class="headerlink" title="数据库相关概念"></a>数据库相关概念</h3><ul>
<li><p>DB</p>
<p>数据库（database）：存储数据的“仓库”，保存了一系列有组织的数据</p>
</li>
<li><p>DBMS</p>
<p>数据库管理系统（Database Management System）：数据库是通过DBMS创建和操作的容器</p>
</li>
<li><p>SQL</p>
<p>结构化查询语言（Structure Query Language）：专门用来与数据库软件通信的语言</p>
</li>
</ul>
<h3 id="数据库存储数据特点"><a href="#数据库存储数据特点" class="headerlink" title="数据库存储数据特点"></a>数据库存储数据特点</h3><ol>
<li><p>将数据放到<strong>表</strong>中，表再放到库中</p>
</li>
<li><p>一个数据库可以有多个表，每个表有唯一性的用于标识的表名</p>
</li>
<li><p>表的<strong>特性</strong>定义了数据在表中如何存储，类似java中“类”的设计</p>
</li>
<li><p>表由<strong>列</strong>组成，也称为字段。所有表都是由一个或多个列组成，每一列类似java中的“<strong>属性</strong>”</p>
</li>
<li><p>表中的数据按<strong>行</strong>存储，每一行类似java中的“<strong>对象</strong>”</p>
</li>
<li><p>表中的所有记录，类似于“<strong>对象的集合</strong>”</p>
</li>
</ol>
<p>orm设计思想：object relation mapping 对象关系映射</p>
<h2 id="初识MySQL"><a href="#初识MySQL" class="headerlink" title="初识MySQL"></a>初识MySQL</h2><h3 id="MySQL数据库介绍"><a href="#MySQL数据库介绍" class="headerlink" title="MySQL数据库介绍"></a>MySQL数据库介绍</h3><p>​    MySQL前身为瑞典公司AB，2008年被sun公司收购，2009sun被oracle收购。</p>
<p>特点：</p>
<ol>
<li>体积小，安装较方便</li>
<li>开源，免费</li>
<li>性能高，稳定性好</li>
<li>兼容性好</li>
</ol>
<p>​    MySQL是一种开源的关系型数据库管理系统，广泛应用在中小型网站中。</p>
<h3 id="DBMS分类"><a href="#DBMS分类" class="headerlink" title="DBMS分类"></a>DBMS分类</h3><ul>
<li><p>基于共享文件系统的DBMS（Access）</p>
</li>
<li><p>基于客户机–服务器的DBMS   C/S  （MySQL，Oracle，SqlServer）</p>
<p>主要安装服务端。</p>
</li>
</ul>
<h3 id="MySQL服务的启动与停止"><a href="#MySQL服务的启动与停止" class="headerlink" title="MySQL服务的启动与停止"></a>MySQL服务的启动与停止</h3><p><strong>方式一：图形化</strong></p>
<p>右击–计算机管理–服务–MySQL服务</p>
<p><strong>方式二：通过管理员身份运行dos</strong></p>
<p>net start 服务名</p>
<p>net stop 服务名</p>
<h3 id="MySQL服务的登录与退出"><a href="#MySQL服务的登录与退出" class="headerlink" title="MySQL服务的登录与退出"></a>MySQL服务的登录与退出</h3><p><strong>方式一：通过dos命令</strong></p>
<p>mysql -h主机名 -P端口号 -u用户名 -p密码</p>
<p>注意：</p>
<p>​    如果是本机，则-h主机名可以省略</p>
<p>​    如果端口号是3306，则-P端口号可以省略</p>
<p>​    默认端口号3306，要先开启服务端，以管理员身份开cmd输入net start mysql5.5，后面为自定义的mysql服务名，然后开启mysql服务，普通用户打开cmd，输入mysql -u用户名 -p密码，即可。</p>
<p>使用exit退出，也可以mysql -uroot -p，然后再输入密码，这样可以隐藏密码。</p>
<p>连接其他主机上的数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h主机名 -P端口号 -u用户名 -p密码</span><br></pre></td></tr></table></figure>

<p><strong>方式二：通过图形化界面客户端</strong></p>
<p>通过sqlyog，直接输入用户名，密码等</p>
<h2 id="MySQL的常见命令和语法规范"><a href="#MySQL的常见命令和语法规范" class="headerlink" title="MySQL的常见命令和语法规范"></a>MySQL的常见命令和语法规范</h2><h3 id="常见命令"><a href="#常见命令" class="headerlink" title="常见命令"></a>常见命令</h3><ul>
<li><p>show databases; 看数据库有哪些</p>
<ul>
<li><p>information_schema 服务端基本信息数据</p>
</li>
<li><p>mysql 用户信息，表信息等</p>
</li>
<li><p>performance_schema 性能分析</p>
<p><strong>前三个都不要改动！！！</strong></p>
</li>
<li><p>test</p>
<p>默认为空</p>
</li>
</ul>
</li>
<li><p>show tables;                            显示当前库中所有表</p>
</li>
<li><p>show tables from  库名;        直接看某个数据库的表 不影响当前库，因为<strong>没有使用use切换库</strong>。</p>
</li>
<li><p>show columns from 表名;     显示指定表中所有列</p>
</li>
<li><p>desc 表名;                                看表结构  describe</p>
</li>
<li><p>use 库名;                                  使用/打开指定数据库</p>
</li>
<li><p>select database();                   查看当前所在库</p>
</li>
</ul>
<h3 id="语法规范"><a href="#语法规范" class="headerlink" title="语法规范"></a>语法规范</h3><ul>
<li><p>不区分大小写</p>
</li>
<li><p>每条命令结尾建议用分号，也可以用\g</p>
</li>
<li><p>注释</p>
<ul>
<li><p>单行注释：#注释文字</p>
</li>
<li><p>单行注释：– 注释文字，中间要有空格</p>
</li>
<li><p>多行注释：/* 注释文字 */</p>
</li>
</ul>
</li>
<li><p>每条命令如果根据需要，可以进行缩进或换行</p>
<p>关键字最好单独一行</p>
</li>
</ul>
<h2 id="DQL语言"><a href="#DQL语言" class="headerlink" title="DQL语言"></a>DQL语言</h2><h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><ul>
<li><p>DDL（Data Definition Language）：数据定义语言，用来定义数据库对象：库、表、列等；</p>
<p>create/drop/alter</p>
</li>
<li><p><strong>DML</strong>（Data Manipulation Language）：数据操作语言，用来定义数据库记录（数据）；</p>
<p><strong>insert/update/delete</strong></p>
</li>
<li><p>DCL（Data Control Language）：数据控制语言，用来定义访问权限和安全级别；</p>
<p>TCL(Transaction Control Language)</p>
</li>
<li><p><strong>DQL</strong>（Data Query Language）：数据查询语言，用来查询记录（数据）。</p>
<p><strong>select</strong></p>
</li>
</ul>
<h3 id="进阶一：基础查询"><a href="#进阶一：基础查询" class="headerlink" title="进阶一：基础查询"></a>进阶一：基础查询</h3><p>语法：</p>
<p>select 查询列表 from 表名;</p>
<p>特点：</p>
<ol>
<li><p>查询的结果集是一个虚拟表</p>
</li>
<li><p>select 查询列表 类似于System.out.println(打印内容);</p>
<p>select后面跟的查询列表，可以有多个部分组成，中间用逗号隔开</p>
<p>例如：select 字段1,字段2, 表达式 from 表;</p>
<p>System.out.println()的打印内容，只能有一个。</p>
</li>
<li><p>执行顺序</p>
<p>select first_name from employees;</p>
<p>先执行from语句，查询是否有此表，然后执行select语句，输出查询的列</p>
</li>
<li><p>查询列表可以是：字段，表达式，常量，函数等，也可以是这些的组合</p>
</li>
</ol>
<h4 id="查询常量"><a href="#查询常量" class="headerlink" title="查询常量"></a>查询常量</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<h4 id="查询表达式"><a href="#查询表达式" class="headerlink" title="查询表达式"></a>查询表达式</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">100</span>/<span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h4 id="查询单个字段"><a href="#查询单个字段" class="headerlink" title="查询单个字段"></a>查询单个字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`last_name`</span> <span class="keyword">FROM</span> <span class="string">`employees`</span>;</span><br><span class="line"><span class="keyword">SELECT</span> last_name <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    注意，着重号的使用是为了区分关键字，如某一column名为name，但同时NAME为关键字，这时候需要加着重号。如果不为关键字，则不用加。为了快捷输入，可以双击名称。</p>
<img src="/2020/02/09/MySQL/%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E5%AD%97%E6%AE%B5.png" class title="This is an example image">

<h4 id="查询多个字段"><a href="#查询多个字段" class="headerlink" title="查询多个字段"></a>查询多个字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`first_name`</span>,<span class="string">`last_name`</span>,<span class="string">`email`</span> <span class="keyword">FROM</span> <span class="string">`employees`</span>;</span><br></pre></td></tr></table></figure>

<p>​    中间用逗号隔开。</p>
<img src="/2020/02/09/MySQL/%E6%9F%A5%E8%AF%A2%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5.png" class title="This is an example image">

<h4 id="查询所有字段"><a href="#查询所有字段" class="headerlink" title="查询所有字段"></a>查询所有字段</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="string">`employees`</span>;</span><br></pre></td></tr></table></figure>

<img src="/2020/02/09/MySQL/%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5.png" class title="This is an example image">

<p>​    不好点在于字段顺序为表中定义顺序，因此开发中更常用的是将所有字段按照需要的顺序点击，如果太长不方便阅读，使用快捷键F12，来自动换行。</p>
<h4 id="查询函数（调用函数，获取返回值）"><a href="#查询函数（调用函数，获取返回值）" class="headerlink" title="查询函数（调用函数，获取返回值）"></a>查询函数（调用函数，获取返回值）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATABASE</span>(); <span class="comment">#查询当前的数据库</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">VERSION</span>();  <span class="comment">#查询当前数据库服务器版本</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>();     <span class="comment">#查询当前用户</span></span><br></pre></td></tr></table></figure>

<h4 id="起别名"><a href="#起别名" class="headerlink" title="起别名"></a>起别名</h4><p>方式一：使用as关键字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>() <span class="keyword">AS</span> 用户名;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>() <span class="keyword">AS</span> <span class="string">`用户名`</span>;</span><br></pre></td></tr></table></figure>

<p>使用前</p>
<img src="/2020/02/09/MySQL/%E8%B5%B7%E5%88%AB%E5%90%8D%E5%89%8D.png" class title="This is an example image">

<p>使用后</p>
<img src="/2020/02/09/MySQL/%E8%B5%B7%E5%88%AB%E5%90%8D%E5%90%8E.png" class title="This is an example image">

<p>​    加<strong>着重号</strong>是为了方便识别，如下面例子。注意：是着重号而不是引号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name <span class="keyword">AS</span> 姓 名 <span class="keyword">FROM</span> <span class="string">`employees`</span>;    <span class="comment">#报错，因为不知道名是干嘛的</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name <span class="keyword">AS</span> <span class="string">"姓 名"</span> <span class="keyword">FROM</span> <span class="string">`employees`</span>;</span><br></pre></td></tr></table></figure>

<p>​    如果姓名中间有空格，不加<strong>着重号</strong>会报错。</p>
<p>方式二：使用空格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>() <span class="string">`用户名`</span>;</span><br></pre></td></tr></table></figure>

<h4 id="concat的使用"><a href="#concat的使用" class="headerlink" title="concat的使用"></a>concat的使用</h4><p>– 需求：查询 first_name和last_name拼接成的全名，最终起别名为：姓 名</p>
<p>方案一：使用+号</p>
<p>​    如果是按照Java的思路</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name+last_name <span class="keyword">AS</span> <span class="string">"姓 名"</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>但是出来结果为</p>
<img src="/2020/02/09/MySQL/%E5%8A%A0%E6%B3%95.png" class title="This is an example image">

<p>​    这是因为在Java中+可以执行加法运算，也可以实现字符串的拼接（至少要求一个为字符串）。</p>
<p>​    但在MySQL中，+作用为</p>
<ol>
<li><p>加法运算</p>
<ul>
<li><p>两个操作数为数值型</p>
<p>100+1.5</p>
</li>
<li><p>其中一个操作数为字符型</p>
<p>将字符型数据强制转换成数值型，如果无法转换，则直接当做0处理</p>
<p>‘张无忌’+100 ===&gt; 100</p>
</li>
<li><p>其中一个操作数为null</p>
<p>null+null ===&gt; null</p>
<p>null+100 ===&gt; null</p>
</li>
</ul>
</li>
</ol>
<p>因此两个char直接相加，都不能识别，结果为0。</p>
<p>方案二：使用concat()拼接函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(first_name,last_name) <span class="keyword">AS</span> <span class="string">"姓 名"</span> </span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    concat()函数中支持任意长度的String。</p>
<img src="/2020/02/09/MySQL/concat%E6%8B%BC%E6%8E%A5.png" class title="This is an example image">

<h4 id="distinct去重"><a href="#distinct去重" class="headerlink" title="distinct去重"></a>distinct去重</h4><p>需求：查询员工涉及到的部门编号有哪些</p>
<p>​    如有10个员工都是部门90，有10个员工都是部分80，将所有部门编号不重复的显示出来。</p>
<p>如果直接敲入SELECT department_id FROM employees;，那么会出现重复的编号如下。</p>
<img src="/2020/02/09/MySQL/%E9%87%8D%E5%A4%8D%E9%83%A8%E9%97%A8%E7%BC%96%E5%8F%B7.png" class title="This is an example image">

<p>​    可以通过增加distinct关键字来去重</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> <span class="string">`department_id`</span> <span class="keyword">FROM</span> <span class="string">`employees`</span>;</span><br></pre></td></tr></table></figure>

<p>​    显示结果为</p>
<img src="/2020/02/09/MySQL/%E7%BC%96%E5%8F%B7%E5%8E%BB%E9%87%8D.png" class title="This is an example image">

<h4 id="查看表的结构"><a href="#查看表的结构" class="headerlink" title="查看表的结构"></a>查看表的结构</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DESC employees;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">COLUMNS</span> <span class="keyword">FROM</span> <span class="string">`employees`</span>;</span><br></pre></td></tr></table></figure>

<p>​    上面两种都可以显示表所有列的结构</p>
<img src="/2020/02/09/MySQL/%E6%98%BE%E7%A4%BA%E8%A1%A8%E7%BB%93%E6%9E%84.png" class title="This is an example image">

<h3 id="练习题1"><a href="#练习题1" class="headerlink" title="练习题1"></a>练习题1</h3><p>1、下面的语句是否可以执行成功</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  last_name,</span><br><span class="line">  job_id,</span><br><span class="line">  salary <span class="keyword">AS</span> sal </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  employees ;</span><br></pre></td></tr></table></figure>

<p>​    可以，输出多个，将salary起名为sal。</p>
<p>2、下面语句是否可以执行成功</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees ;</span><br></pre></td></tr></table></figure>

<p>​    可以，输出eployees中全部。</p>
<p>3、找出下面语句中的错误</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  employee_id,</span><br><span class="line">  last_name，</span><br><span class="line">  salary * <span class="number">12</span> “ ANNUAL SALARY ” </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  employees ;</span><br></pre></td></tr></table></figure>

<p>​    错误在于last_name后面的逗号为中文逗号，12后面的双引号为中文的符号，更改即可。salary*12起名为ANNUAL SALARY。</p>
<p>4、显示表 departments 的结构，并查询其中的全部数据 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DESC departments;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> departments;</span><br></pre></td></tr></table></figure>

<p>​    可以使用desc，也可以使用SHOW COLUMNS FROM departments;</p>
<p>5、显示出表 employees 中的全部 job_id （不能重复）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> job_id <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    考distinct关键字的使用，查哪个表，就from哪个。</p>
<p>6、显示出表 employees 的全部列，各个列之间用逗号连接，列头显示成 OUT_PUT </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(employee_id,<span class="string">','</span>,first_name,<span class="string">','</span>,last_name,<span class="string">','</span>,commission_pct) <span class="keyword">AS</span> <span class="string">"OUT_PUT"</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    考concat使用，在不同列之间还要拼接上‘,’，然后起名。</p>
<p>​    但是有的为null，有的是正常的。</p>
<img src="/2020/02/09/MySQL/%E5%B8%A6%E9%80%97%E5%8F%B7%E6%8B%BC%E6%8E%A5.png" class title="This is an example image">

<p>​    然后调用SELECT commission_pct FROM employees;，发现有的commission_pct为null值。在拼接时，只要有一个为null，那么就不能直接拼接。这时候需要判断，只有在不为空的时候才进行拼接。使用函数ifnull。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> commission_pct, <span class="keyword">IFNULL</span>(commission_pct,<span class="string">"空"</span>) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    此函数需要输入两个参数，一个是进行判断的参数，第二个是如果此参数为null要显示的参数。</p>
<img src="/2020/02/09/MySQL/IFNULL%E4%BD%BF%E7%94%A8.png" class title="This is an example image">

<p>​    因此将commission进行替换为ifnull即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(employee_id,<span class="string">','</span>,first_name,<span class="string">','</span>,last_name,<span class="string">','</span>,<span class="keyword">IFNULL</span>(commission_pct,<span class="string">''</span>)) <span class="keyword">AS</span> <span class="string">"OUT_PUT"</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="进阶二：条件查询"><a href="#进阶二：条件查询" class="headerlink" title="进阶二：条件查询"></a>进阶二：条件查询</h3><h4 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h4><p>select 查询列表 </p>
<p>from 表名</p>
<p><strong>where 筛选条件</strong>;</p>
<p>​    执行顺序：1，from；2，where；3，select。</p>
<p>​    在没有索引时逐行查询，再筛选有where满足的语句，进行select输出。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`first_name`</span>,<span class="string">`last_name`</span> <span class="keyword">FROM</span> <span class="string">`employees`</span> <span class="keyword">WHERE</span> <span class="string">`salary`</span>&gt;<span class="number">2000</span>;</span><br></pre></td></tr></table></figure>

<h4 id="特点："><a href="#特点：" class="headerlink" title="特点："></a>特点：</h4><ol>
<li><p>按关系表达式筛选</p>
<p>关系运算符：</p>
<table>
<thead>
<tr>
<th>小于</th>
<th>&lt;</th>
</tr>
</thead>
<tbody><tr>
<td>小于等于</td>
<td>&lt;=</td>
</tr>
<tr>
<td>大于</td>
<td>&gt;</td>
</tr>
<tr>
<td>大于等于</td>
<td>&gt;=</td>
</tr>
<tr>
<td>等于</td>
<td>=</td>
</tr>
<tr>
<td>不等于</td>
<td>&lt;&gt;</td>
</tr>
</tbody></table>
<p>补充：不等于!=也可以，但不建议</p>
</li>
<li><p>按逻辑表达式</p>
<p>逻辑运算符</p>
<table>
<thead>
<tr>
<th>与</th>
<th>and</th>
</tr>
</thead>
<tbody><tr>
<td>或</td>
<td>or</td>
</tr>
<tr>
<td>非</td>
<td>not</td>
</tr>
</tbody></table>
<p>补充：也可以使用&amp;&amp;   ||    !   但不建议</p>
</li>
<li><p>模糊查询</p>
<ul>
<li>like</li>
<li>in</li>
<li>between and</li>
<li>is null</li>
</ul>
</li>
</ol>
<h4 id="按关系表达式查询"><a href="#按关系表达式查询" class="headerlink" title="按关系表达式查询"></a>按关系表达式查询</h4><p>案例1：查询部门编号不是100的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id &lt;&gt; <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p>​    先按照select,from,where写好，然后进行填充。输出的是员工信息，但是不确定，用*号，然后选择的表是员工表，条件是部门编号不为100。的后跟什么，select后加什么。的前面是什么，where后加什么</p>
<p>案例2：查询工资小于15000的姓名、工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary&lt;<span class="number">15000</span>;</span><br></pre></td></tr></table></figure>

<p>​    的后为姓名工资，放在select后，的前为工资小于15000，放在where后。</p>
<h4 id="按逻辑表达式查询"><a href="#按逻辑表达式查询" class="headerlink" title="按逻辑表达式查询"></a>按逻辑表达式查询</h4><p>案例1：查询部门编号不是50-100之间员工姓名、部门编号、邮箱</p>
<p>方式1：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_id,email</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id &gt; <span class="number">100</span> <span class="keyword">OR</span> department_id &lt; <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p>方式2：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_id,email</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span>(department_id &gt;= <span class="number">50</span> <span class="keyword">AND</span> department_id &lt;= <span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p>案例2：查询奖金率&gt;0.03 或者员工编号在60-110之间的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct &gt; <span class="number">0.03</span> <span class="keyword">OR</span> (employee_id &gt;= <span class="number">60</span> <span class="keyword">AND</span> employee_id &lt;= <span class="number">110</span>);</span><br></pre></td></tr></table></figure>

<h4 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h4><h5 id="like"><a href="#like" class="headerlink" title="like"></a>like</h5><p>功能：一般和通配符搭配使用，对字符型数据进行<strong>部分匹配查询</strong></p>
<p>like/ not like</p>
<p>常见的通配符：</p>
<ul>
<li>_    任意单个字符</li>
<li>%   任意多个字符，支持0到多个字符</li>
</ul>
<p>案例1：查询姓名中包含字符a的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%a%'</span>;</span><br></pre></td></tr></table></figure>

<p>​    姓名中包含a，使用like，因为a前面有几个字符不知道，因此a前面加%；a后面有几个字符不知道，因此a后面加%。而sql中字符要用单引号括起来，因此是like ‘%a%’。</p>
<p>案例2：查询姓名中最后一个字符为e的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%e'</span>;</span><br></pre></td></tr></table></figure>

<p>​    最后个字符为e，因此e前面有几个字符不知道，但e后面没有字符，因此是like ‘%e’。</p>
<p>案例3：查询姓名中第一个字符为e的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'e%'</span>;</span><br></pre></td></tr></table></figure>

<p>​    第一个个字符为e，因此e后面有几个字符不知道，但e前面没有字符，因此是like ‘e%’。</p>
<p>案例4：查询姓名中第三个字符为x的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'__x%'</span>;</span><br></pre></td></tr></table></figure>

<p>​    x前面有2个字符，因此添加2个下划线_，然后x后面的字符个数位置，使用%，因此为‘__x%’。</p>
<p>案例5：查询姓名中包含第二个字符为_的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'_\_%'</span>;</span><br></pre></td></tr></table></figure>

<p>​    第二个下划线需要使用转义字符在转义。</p>
<p>​    但这种在sql中不是常见语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'_$_%'</span> ESCAPE <span class="string">'$'</span>;</span><br></pre></td></tr></table></figure>

<p>​    使用一个喜欢的而且不常见的字符作为转义字符，利用ESCAPE来标记其为转义字符。</p>
<h5 id="in"><a href="#in" class="headerlink" title="in"></a>in</h5><p>功能：查询某字段的值是否<strong>属于指定的列表</strong>之内</p>
<p>a  in(常量值1,常量值2,常量值3,….)  意思是看a是否是在这些值之内</p>
<p>a not in(常量值1,常量值2,常量值3,….)  意思是看a是否是均在这些值之内</p>
<p>in/not in  在或者不在</p>
<p>案例1：查询部门编号是30/50/90的员工名和部门编号</p>
<p>方式1：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span>(<span class="number">30</span>,<span class="number">50</span>,<span class="number">90</span>);</span><br></pre></td></tr></table></figure>

<p>方式2：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id =<span class="number">30</span></span><br><span class="line"><span class="keyword">OR</span> department_id =<span class="number">50</span></span><br><span class="line"><span class="keyword">OR</span> department_id =<span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<p>案例2：查询工种编号不是SH_CLERK或IT_PROG的员工信息</p>
<p>方式1：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id <span class="keyword">NOT</span> <span class="keyword">IN</span>(<span class="string">'SH_CLERK'</span>,<span class="string">'IT_PROG'</span>);</span><br></pre></td></tr></table></figure>

<p>方式2：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> (job_id = <span class="string">'SH_CLERK'</span></span><br><span class="line"><span class="keyword">OR</span> job_id = <span class="string">'IT_PROG'</span>);</span><br></pre></td></tr></table></figure>

<h5 id="between-and"><a href="#between-and" class="headerlink" title="between and"></a>between and</h5><p>功能：判断某个字段的值是否介于xx之间。判断的是区间值。<strong>包含临界值</strong>。</p>
<p>between and / not between and</p>
<p>案例1：查询部门编号是30-90之间的部门编号、员工姓名</p>
<p>方式1：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id,last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">BETWEEN</span> <span class="number">30</span> <span class="keyword">AND</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<p>​    between和and之间，要<strong>先写小的数，再写大的</strong>。</p>
<p>方式2：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id,last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id &gt;= <span class="number">30</span> <span class="keyword">AND</span> department_id &lt;= <span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<p>​    两种方式是等价的，因此一定要先写小的，不然查询不到。</p>
<p>案例2：查询年薪不是100000-200000之间的员工姓名、工资、年薪</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary,salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct,<span class="number">0</span>)) 年薪</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct,<span class="number">0</span>)) <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">100000</span> <span class="keyword">AND</span> <span class="number">200000</span>;</span><br></pre></td></tr></table></figure>

<p>​    首先在表格中没有年薪，因此要明确年薪的计算</p>
<blockquote>
<p>年薪=月薪x12x(1+奖金率)</p>
</blockquote>
<p>​    但奖金率有可能为空，因此要使用ifnull进行判断，如果为空则设置为0，然后给年薪起名，条件语句是年薪不在100000和200000之间，因此使用not between。</p>
<p>​    小技巧：可以先进行select和from进行判断语句是否写正确，然后再写where语句。</p>
<h5 id="is-null"><a href="#is-null" class="headerlink" title="is null"></a>is null</h5><p>is null / is not null</p>
<p>案例1：查询没有奖金的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>​    直接用=null无法判断出来。</p>
<p>案例2：查询有奖金的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>=与is null比较</p>
<ul>
<li>=               只能判断普通的内容</li>
<li>IS              只能判断NULL值</li>
<li>&lt;=&gt;          安全等于，既能判断普通内容，又能判断NULL值，但<strong>可读性差</strong></li>
</ul>
<h3 id="进阶三：排序查询"><a href="#进阶三：排序查询" class="headerlink" title="进阶三：排序查询"></a>进阶三：排序查询</h3><p>语法：</p>
<p>select 查询列表</p>
<p>from 表格</p>
<p>where 筛选条件  （<strong>可省略</strong>）</p>
<p>order by 排序列表</p>
<p>执行顺序</p>
<ol>
<li><p>from 子句</p>
</li>
<li><p>where 子句</p>
</li>
<li><p>select 子句</p>
</li>
<li><p>order by 子句</p>
<p><strong>先查出来，再排序</strong></p>
</li>
</ol>
<p>特点：</p>
<ol>
<li><p>排序列表可以是单个字段、多个字段、表达式、函数、列数以及以上的组合</p>
</li>
<li><p>升序，通过  asc ， 默认行为</p>
<p>降序，通过 desc</p>
</li>
<li><p>order by的位置一般放在查询语句的最后（除limit语句之外）</p>
</li>
</ol>
<h4 id="按单个字段排序"><a href="#按单个字段排序" class="headerlink" title="按单个字段排序"></a>按单个字段排序</h4><p>案例1：将员工编号大于120的员工信息进行工资的升序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id &gt; <span class="number">120</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>​    其中ASC可以省略。</p>
<p>案例2：将员工编号大于120的员工信息进行工资的降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id &gt; <span class="number">120</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h4 id="按表达式排序"><a href="#按表达式排序" class="headerlink" title="按表达式排序"></a>按表达式排序</h4><p>案例1：对有奖金的员工，按年薪降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *,salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct,<span class="number">0</span>))  年薪</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct,<span class="number">0</span>)) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>​    计算出年薪表达式，然后选择奖金率不为空，再按照年薪排序，但表达式太长。</p>
<h4 id="按别名排序"><a href="#按别名排序" class="headerlink" title="按别名排序"></a>按别名排序</h4><p>案例1：对有奖金的员工，按年薪降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *,salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct,<span class="number">0</span>))  年薪</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 年薪 <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>​    计算出年薪表达式，然后选择奖金率不为空，再按照年薪排序，但表达式太长。</p>
<p>​    判断：where判断处是否能使用年薪？</p>
<p>​    不能，因为执行顺序是from,where,select,order by，在where处别名年薪还没有被定义，因此只能在order by后使用。</p>
<p>​    这里语法可以被简化，因为经过where判断后，已经不存在奖金率为null的情况，因此不用在select中加上对奖金率IFNULL的判断。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *,salary*<span class="number">12</span>*(<span class="number">1</span>+commission_pct)  年薪</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 年薪 <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h4 id="按函数的结果排序"><a href="#按函数的结果排序" class="headerlink" title="按函数的结果排序"></a>按函数的结果排序</h4><p>案例1：按姓名的字数长度进行升序</p>
<p>获取字数长度可以使用LENGTH()函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(last_name),last_name</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<img src="/2020/02/09/MySQL/LENGTH%E5%87%BD%E6%95%B0.png" class title="This is an example image">

<p>​    因此直接order by length(last_name)即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">LENGTH</span>(last_name);</span><br></pre></td></tr></table></figure>

<h4 id="按多个字段排序"><a href="#按多个字段排序" class="headerlink" title="按多个字段排序"></a>按多个字段排序</h4><p>案例1：查询员工的姓名、工资、部门编号，先按工资升序，再按部门编号降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>, department_id <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>​    总体先 按照工资排序，当有工资相同的情况，按照部门编号降序</p>
<img src="/2020/02/09/MySQL/%E5%B7%A5%E8%B5%84%E5%8D%87%E5%BA%8F%E7%BC%96%E5%8F%B7%E9%99%8D%E5%BA%8F.png" class title="This is an example image">

<p>​    中间用逗号隔开，每个排序方式都是相独立指定的。</p>
<h4 id="按列数排序，用的少"><a href="#按列数排序，用的少" class="headerlink" title="按列数排序，用的少"></a>按列数排序，用的少</h4><p>案例1：查询员工信息，按照第二列排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>​    用的较少，阅读性较差</p>
<h3 id="练习题2"><a href="#练习题2" class="headerlink" title="练习题2"></a>练习题2</h3><p>1、查询员工的姓名和部门号和年薪，按年薪降序 按姓名升序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_id,salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct,<span class="number">0</span>)) 年薪</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> 年薪 <span class="keyword">DESC</span>, last_name <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>疑问：当order by中别名加了引号后就不能正确排序，如下所示</p>
<img src="/2020/02/09/MySQL/%E5%BC%95%E5%8F%B7%E6%8E%92%E5%BA%8F.png" class title="This is an example image">

<p>​    后经人提醒，应该是<strong>着重号</strong>而不是引号，因此正确的使用别名方式应该如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_id,salary*<span class="number">12</span>*(<span class="number">1</span>+<span class="keyword">IFNULL</span>(commission_pct,<span class="number">0</span>)) <span class="string">`年 薪`</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">`年 薪`</span> <span class="keyword">DESC</span>, last_name <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>2、选择工资不在8000到17000的员工的姓名和工资，按工资降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">8000</span> <span class="keyword">AND</span> <span class="number">17000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>3、查询邮箱中包含e的员工信息，并先按邮箱的字节数降序，再按部门号升序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">'%e%'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">LENGTH</span>(email) <span class="keyword">DESC</span>, department_id <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="进阶四：常见函数"><a href="#进阶四：常见函数" class="headerlink" title="进阶四：常见函数"></a>进阶四：常见函数</h3><p>函数：类似于java中的“方法”，为了解决某个问题，将编写的一系列的命令集合封装在一起，对外仅仅暴露方法名，供外部调用。</p>
<p>1、自定义方法（函数）</p>
<p>2、调用方法啊（函数）</p>
<ul>
<li>叫什么：函数名</li>
<li>干什么：函数功能</li>
</ul>
<p>常见函数：</p>
<ul>
<li>字符函数</li>
<li>数学函数</li>
<li>日期函数</li>
<li>流程控制函数</li>
</ul>
<h4 id="字符函数"><a href="#字符函数" class="headerlink" title="字符函数"></a>字符函数</h4><p>1、CONCAT 拼接函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="string">'hello,'</span>,first_name,last_name) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    可以指定多个参数</p>
<p>2、LENGTH 获取<strong>字节</strong>长度</p>
<p>​    一个汉字识别为3个字节</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(<span class="string">'hello,李四'</span>);</span><br></pre></td></tr></table></figure>

<p>​    输出为12。</p>
<p>3、CHAR_LENGTH 获取<strong>字符</strong>长度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(<span class="string">'hello,李四'</span>);</span><br></pre></td></tr></table></figure>

<p>​    输出为8。</p>
<p>4、SUBSTRING 截取子串</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="string">'武汉加油，中国加油'</span>,<span class="number">1</span>,<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>substr(str，起始索引，截取的字符长度)  <strong>起始索引从1开始</strong>！！！    </p>
<p>substr(str，起始索引)    默认将后面全部截取</p>
<p>第一个参数为完整字符串，第二个参数为起始位置，其中SQL中从1开始，第三个参数为截取长度。</p>
<p>5、INSTR 获取字符第一次出现的索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INSTR</span>(<span class="string">'三打白骨精aa白骨精'</span>,<span class="string">'白骨精'</span>);</span><br></pre></td></tr></table></figure>

<p>​    结果为3，因为白骨精第一次出现的索引是3。</p>
<p>6、TRIM 去前后指定的字符，默认是去空格</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRIM</span>(<span class="string">'   虚 竹   '</span>) <span class="keyword">AS</span> <span class="string">`a`</span>;</span><br></pre></td></tr></table></figure>

<p>结果为虚 竹。前后空格被去掉，中间不去掉</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRIM</span>(<span class="string">'x'</span> <span class="keyword">FROM</span> <span class="string">'xxxxx虚xx竹xxxx'</span>) <span class="keyword">AS</span> <span class="string">`a`</span>;</span><br></pre></td></tr></table></figure>

<p>结果为虚xx竹，将指定的字符从字符串中去掉了，中间的不受影响。</p>
<p>7、LPAD/RPAD  左填充/右填充</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LPAD</span>(<span class="string">'武汉加油'</span>,<span class="number">10</span>,<span class="string">'a'</span>);</span><br></pre></td></tr></table></figure>

<p>结果为aaaaaa武汉加油，往左边填充指定的字符，至指定长度。</p>
<p>也可以用来<strong>截取字符串</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LPAD</span>(<span class="string">'庆历四年滕子京谪守巴陵郡'</span>,<span class="number">4</span>,<span class="string">'a'</span>);</span><br></pre></td></tr></table></figure>

<p>当指定长度比输入字符串长度更短时，会截取字符串为指定长度，因此输出为庆历四年。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> RPAD(<span class="string">'武汉加油'</span>,<span class="number">10</span>,<span class="string">'a'</span>);</span><br></pre></td></tr></table></figure>

<p>​    输出结果为武汉加油aaaaaa，在右边填充。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> RPAD(<span class="string">'庆历四年滕子京谪守巴陵郡'</span>,<span class="number">4</span>,<span class="string">'a'</span>);</span><br></pre></td></tr></table></figure>

<p>​    结果同样为庆历四年。</p>
<p>8、UPPER/LOWER  变大写/小写</p>
<p>案例：查询员工表中的姓名，要求格式：姓首字符大写，其他字符小写，名所有字符大写，且姓和名之间用_分割，最后起别名“OUTPUT”。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="keyword">SUBSTR</span>(first_name,<span class="number">1</span>,<span class="number">1</span>),<span class="keyword">LOWER</span>(<span class="keyword">SUBSTR</span>(first_name,<span class="number">2</span>)),<span class="string">'_'</span>,<span class="keyword">UPPER</span>(last_name)) <span class="keyword">AS</span> <span class="string">`OUTPUT`</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>9、STRCMP 比较两个字符大小</p>
<p>STRCMP(str1,str2)</p>
<p>​    如果str1比较大，输出1；如果str2比较大，输出-1；如果两个一样大，返回0。</p>
<p>​    <strong>字符均用单引号括起来</strong>。</p>
<p>​    对应String compareTo()方法，其从首位比较两个字符串，如果第一个不等，则返回二者ASCII码差值，如果相等，再比较第二个，以此类推。如果比较到最后都一样（较短长度的字符串位置），则返回二者长度的差值。</p>
<p>10、LEFT/RIGHT  截取子串</p>
<p>​    从左边截取指定的长度或从右边截取指定的长度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LEFT</span>(<span class="string">'武汉加油'</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RIGHT</span>(<span class="string">'武汉加油'</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>分别输出武和加油。</p>
<p>11、REPLACE 替换</p>
<p>REPLACE（str, a, b）    用字符串b替换字符串str中所有出现的字符串a</p>
<h4 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h4><p>1、ABS 绝对值</p>
<p>2、CEIL 向上取整，返回<strong>&gt;=</strong>该参数的最小整数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">1.1</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">1.0</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">-1.09</span>);</span><br></pre></td></tr></table></figure>

<p>​    结果为2和1和-1，因为是大于等于。</p>
<p>3、FLOOR 向下取整，返回&lt;=该参数的最大整数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FLOOR</span>(<span class="number">-1.09</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FLOOR</span>(<span class="number">0.09</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FLOOR</span>(<span class="number">1.00</span>);</span><br></pre></td></tr></table></figure>

<p>​    结果为-2,0和1，因为是小于等于。</p>
<p>4、ROUND 四舍五入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">1.87</span>);</span><br></pre></td></tr></table></figure>

<p>​    结果为2，小数点后没有保存位数。</p>
<p>​    但是想保留两个小数，可以增加一个参数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">1.8712345</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>​    结果为1.87。</p>
<p>5、<strong>TRUNCATE</strong> 截断</p>
<p>truncate(num,count)</p>
<p>​    在数字小数点后保留指定位数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">1.8723131</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>​    小数点后保留一位小数，结果为1.8。</p>
<p>6、MOD 取余</p>
<p><strong>被除数的正负决定了结果的正负</strong></p>
<p>​    与%结果一样。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MOD</span>(<span class="number">-10</span>,<span class="number">3</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MOD</span>(<span class="number">10</span>,<span class="number">-3</span>);</span><br></pre></td></tr></table></figure>

<p>​    结果为-1和1，正负决定于被除数，即前面一个数。</p>
<p> A%B = A - (A/B)*B</p>
<p>​    小技巧：绝对值取余再看正负。</p>
<p>6、RAND 随机数</p>
<p>RAND(x)    返回0~1的随机值</p>
<p>7、SQRT 平方根</p>
<p>SQRT(x)    返回x的平方根</p>
<p>8、POW 次方</p>
<p>POW(x,y)    返回x的y次方</p>
<h4 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h4><p>1、NOW  获取当前时间+时间，包括日期、小时</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NOW</span>();</span><br></pre></td></tr></table></figure>

<img src="/2020/02/09/MySQL/NOW%E5%87%BD%E6%95%B0.png" class title="This is an example image">

<p>2、CURDATE  获取当前日期</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURDATE</span>();</span><br></pre></td></tr></table></figure>

<img src="/2020/02/09/MySQL/%E5%BD%93%E5%89%8D%E6%97%A5%E6%9C%9F.png" class title="This is an example image">

<p>3、CURTIME 获取当前时间，只有小时</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURTIME</span>();</span><br></pre></td></tr></table></figure>

<img src="/2020/02/09/MySQL/%E5%BD%93%E5%89%8D%E6%97%B6%E9%97%B4.png" class title="This is an example image">

<p>4、DATEDIFF 获取两个日期之差</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATEDIFF</span>(<span class="string">'2020-2-17'</span>,<span class="string">'2018-6-24'</span>);</span><br></pre></td></tr></table></figure>

<p>​    输出两个日期时间，前面日期减去后面，得到天数。</p>
<p>5、DATE_FORMAT 格式转换</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(<span class="string">'2020-2-17'</span>,<span class="string">'%Y年%m月%d日 %H小时%i分钟%s秒'</span>) <span class="string">`当前日期`</span>;</span><br></pre></td></tr></table></figure>

<p>年月日小时分秒有规定的格式</p>
<img src="/2020/02/09/MySQL/%E6%97%A5%E6%9C%9F%E8%BD%AC%E6%8D%A2.png" class title="This is an example image">

<p>​    如可以查看员工的入职日期</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(hiredate,<span class="string">'%Y年%m月%d日 %H小时%i分钟%s秒'</span>) <span class="string">`入职日期`</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>6、STR_TO_DATE 按指定格式解析字符串为日期</p>
<p>查看入职日期比指定日期小的人</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> hiredate &lt; <span class="keyword">STR_TO_DATE</span>(<span class="string">'3/15 1998'</span>,<span class="string">'%m/%d %Y'</span>);</span><br></pre></td></tr></table></figure>

<p>这样就可以进行比较。</p>
<p>7、返回具体的时间值</p>
<p>YEAR(date)<br>MONTH(date)<br>DAY(date)<br>HOUR(time)<br>MINUTE(time)<br>SECOND(time)    </p>
<h4 id="其他函数"><a href="#其他函数" class="headerlink" title="其他函数"></a>其他函数</h4><p>version 当前数据库服务器的版本</p>
<p>database 当前打开的数据库</p>
<p>user 当前用户</p>
<p>password(‘字符’) 返回该字符的密码形式</p>
<p>md5(‘字符’) 返回该字符的md5加密形式</p>
<h4 id="流程控制函数"><a href="#流程控制函数" class="headerlink" title="流程控制函数"></a>流程控制函数</h4><p>1、IF函数</p>
<p>if(条件表达式，表达式1，表达式2)</p>
<p>如果条件表达式成立，返回表达式1，否则返回表达式2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="number">100</span>&gt;<span class="number">9</span>,<span class="string">'good'</span>,<span class="string">'bad'</span>);</span><br></pre></td></tr></table></figure>

<p>​    如果成立，输出第二个，不然输出第三个。类似于三目运算符。</p>
<p>需求：如果有奖金，则显示最终奖金，如果没有，则显示0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">IF</span>(commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,salary*<span class="number">12</span>*commission_pct,<span class="number">0</span>) <span class="string">`奖金`</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">`奖金`</span> <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>2、CASE函数</p>
<p>情况1：类似于switch语句，可以实现等值判断</p>
<p>CASE 表达式</p>
<p>WHEN 值1 THEN 结果1</p>
<p>WHEN 值2 THEN 结果2</p>
<p>…</p>
<p>ELSE 结果n</p>
<p>END</p>
<p>案例：部门编号是30，工资显示为2倍；部门编号是50，工资显示为3倍；部门编号是60，工资显示为4倍；否则不变。显示部门编号，新工资，旧工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id,salary,</span><br><span class="line"><span class="keyword">CASE</span> department_id</span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">30</span> <span class="keyword">THEN</span> salary*<span class="number">2</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">50</span> <span class="keyword">THEN</span> salary*<span class="number">3</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">60</span> <span class="keyword">THEN</span> salary*<span class="number">4</span></span><br><span class="line"><span class="keyword">ELSE</span> salary </span><br><span class="line"><span class="keyword">END</span> <span class="string">`new salary`</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    case开头到end结尾均为新工资，因此要起别名的话要<strong>写在end后面</strong>。</p>
<p>情况2：类似于多重IF语句，实现区间判断。</p>
<p>CASE</p>
<p>WHEN 条件1 THEN 结果1</p>
<p>WHEN条件2 THEN 结果2</p>
<p>…</p>
<p>ELSE 结果n</p>
<p>END</p>
<p>案例：如果工资&gt;20000，显示级别A；如果工资&gt;15000，显示级别B；如果工资&gt;10000，显示级别C；否则，显示D。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">WHEN</span> salary&gt;<span class="number">20000</span> <span class="keyword">THEN</span> <span class="string">'A'</span></span><br><span class="line"><span class="keyword">WHEN</span> salary&gt;<span class="number">15000</span> <span class="keyword">THEN</span> <span class="string">'B'</span></span><br><span class="line"><span class="keyword">WHEN</span> salary&gt;<span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">'C'</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">'D'</span></span><br><span class="line"><span class="keyword">END</span> <span class="string">`grade`</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    WHEN后面记得要加THEN。</p>
<h3 id="练习题3"><a href="#练习题3" class="headerlink" title="练习题3"></a>练习题3</h3><p>1、显示系统时间（注：日期+时间）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NOW</span>();</span><br></pre></td></tr></table></figure>

<p>2、查询员工号，姓名，工资，以及工资提高百分之20%后的结果（new salary）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,salary,salary*<span class="number">1.2</span> <span class="string">`new lalary`</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>3、将员工的姓名按首字母排序，并写成姓名的长度（length）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(last_name) <span class="string">`长度`</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUBSTR</span>(last_name,<span class="number">1</span>,<span class="number">1</span>) <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>或者使用LEFT函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(last_name) <span class="string">`长度`</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">LEFT</span>(last_name,<span class="number">1</span>) <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>4、做一个查询，产生下面的效果</p>
<p><last_name> earns &lt; salary&gt; monthly but wants &lt;salary*3&gt; Dream Salary</last_name></p>
<p>King earns 24000 monthly but wants 72000</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(last_name,<span class="string">' earns '</span>,salary,<span class="string">' monthly but wants '</span>,salary*<span class="number">3</span>) <span class="string">`Dream Salary`</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>5、使用case-when，按照下面的条件：</p>
<p>job grade</p>
<p>AD_PRES A</p>
<p>ST_MAN B</p>
<p>IT_PROG C</p>
<p>SA_REP D</p>
<p>ST_CLERK E</p>
<p>产生下面的结果</p>
<p>Last_name Job_id Grade </p>
<p>king AD_PRES A</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,job_id,</span><br><span class="line"><span class="keyword">CASE</span> job_id</span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">'AD_PRES'</span> <span class="keyword">THEN</span> <span class="string">'A'</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">'ST_MAN'</span> <span class="keyword">THEN</span> <span class="string">'B'</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">'IT_PROG'</span> <span class="keyword">THEN</span> <span class="string">'C'</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">'SA_REP'</span> <span class="keyword">THEN</span> <span class="string">'D'</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="string">'ST_CLERK'</span> <span class="keyword">THEN</span> <span class="string">'E'</span></span><br><span class="line"><span class="keyword">END</span> <span class="string">`Grade`</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    <strong>凡是常量值均瑶用引号括起来</strong>！！！</p>
<p>以上为单行函数，一列出来一个值，还有分组函数，多列进去出来一个值。</p>
<h3 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h3><p>​    分组函数往往用于实现将一组数据进行统计计算，最终得到一个值，又称为聚合函数或统计函数</p>
<p>1、分组函数清单</p>
<ul>
<li>sum(字段名) ：求和</li>
<li>avg(字段名) ：求平均数</li>
<li>max(字段名) ：求最大值</li>
<li>min(字段名)：求最小值</li>
<li>count(字段名) ：计算非空字段值的个数</li>
</ul>
<p>2、支持的类型：</p>
<ul>
<li>sum和avg一般用于处理数值型</li>
<li>max，min，count可以处理任何数据类型</li>
</ul>
<p>3、以上分组函数都忽略NULL</p>
<p>4、都可以搭配DISTINCT使用，实现去重的统计</p>
<p>select max(distinct 字段) from 表</p>
<p>5、和分组函数一同查询的字段，要求是group by后出现的字段</p>
<p>案例1：查询员工信息表中，所有员工的工资和、工资平均值、最低工资、最高工资、有工资的个数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(salary),<span class="keyword">AVG</span>(salary),<span class="keyword">MIN</span>(salary),<span class="keyword">MAX</span>(salary),<span class="keyword">COUNT</span>(salary) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>案例2：添加筛选条件</p>
<p>1、查询emp表中记录数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(employee_id) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>​    选择一个不可能为空的，计算其count即可</p>
<p>2、查询emp表中有佣金的人数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(salary) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>3、查询emp表中月薪大于2500的人数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(salary) <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary&gt;<span class="number">2500</span>;</span><br></pre></td></tr></table></figure>

<p>​    天剑查询写在where中。</p>
<p>4、查询有领导的人数</p>
<p>COUNT本身去掉了空值，因此可以不用WHERE判断</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(manager_id) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h4 id="count的补充介绍"><a href="#count的补充介绍" class="headerlink" title="count的补充介绍"></a>count的补充介绍</h4><p>1、统计结果集的行数，推荐使用count(*)</p>
<p>查询结果中的总行数，用*统计行数较多。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id = <span class="number">30</span>;</span><br></pre></td></tr></table></figure>

<p>这样可以不用关心count中到底要写哪个字段，可以用于方便获取行数。</p>
<p>也可以使用常量值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>相当于加了一个常量列，但是效率与可读性没*高。</p>
<p>效率上：</p>
<p>MyISAM存储引擎，count(*)最高</p>
<p>InnoDB存储引擎，count(*)和count(1)效率&gt;count(字段)</p>
<p>2、搭配distinct实现去重的统计</p>
<p>需求：查询有员工的部门个数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> department_id) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="进阶五：分组查询"><a href="#进阶五：分组查询" class="headerlink" title="进阶五：分组查询"></a>进阶五：分组查询</h3><h4 id="分组查询引入"><a href="#分组查询引入" class="headerlink" title="分组查询引入"></a>分组查询引入</h4><p>思考题：求每个部门的总工资，平均工资。需要使用分组查询。</p>
<img src="/2020/02/09/MySQL/%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2.png" class title="This is an example image">

<p>​    使用CROUP BY 关键字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(salary) <span class="string">`总工资`</span>,<span class="keyword">AVG</span>(salary) <span class="string">`平均工资`</span>,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>

<p>出来结果如下</p>
<img src="/2020/02/09/MySQL/%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C.png" class title="This is an example image">

<p>​    查询需要一一对应，否则无意义。</p>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><p>select 查询列表</p>
<p>from 表名</p>
<p>where 筛选条件</p>
<p>group by 分组列表</p>
<p>having 分组后筛选</p>
<p>order by 排序列表;</p>
<p>执行顺序</p>
<ol>
<li>from子句</li>
<li>where子句</li>
<li>group by子句</li>
<li>having子句</li>
<li>select子句</li>
<li>order by子句</li>
</ol>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ol>
<li><p>查询列表往往是   分组函数和被分组的字段</p>
</li>
<li><p>分组查询中的筛选分为两类</p>
<table>
<thead>
<tr>
<th></th>
<th>筛选的基表</th>
<th>使用的关键词</th>
<th>位置</th>
</tr>
</thead>
<tbody><tr>
<td>分组前筛选</td>
<td>原始表(from后的表)</td>
<td>where</td>
<td>group by前面</td>
</tr>
<tr>
<td>分组后筛选</td>
<td>分组后的结果集</td>
<td>having</td>
<td>group by后面</td>
</tr>
</tbody></table>
<p>where—group by—having</p>
<p>分组函数做条件只可能放在having后面</p>
</li>
<li><p>group by后面可以接函数</p>
</li>
</ol>
<h4 id="简单的分组"><a href="#简单的分组" class="headerlink" title="简单的分组"></a>简单的分组</h4><p>案例1：查询每个工种的员工平均工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary),job_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id;</span><br></pre></td></tr></table></figure>

<p>select后将分组函数和被分组字段放在一起。</p>
<p>案例2：查询每个领导的手下人数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*),manager_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> manager_id;</span><br></pre></td></tr></table></figure>

<p>人数，使用COUNT(*)来查询，用领导id来分组。将领导id为空的去掉。</p>
<h4 id="可以实现分组前的筛选"><a href="#可以实现分组前的筛选" class="headerlink" title="可以实现分组前的筛选"></a>可以实现分组前的筛选</h4><p>案例1：查询邮箱中包含a字符的每个部门的最高工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary) <span class="string">`最高工资`</span>,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">'%a%'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>

<p>案例2：查询每个领导收下有奖金的员工的平均工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) <span class="string">`平均工资`</span>,manager_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> manager_id;</span><br></pre></td></tr></table></figure>

<p>按照领导分组。</p>
<h4 id="可以实现分组后的筛选"><a href="#可以实现分组后的筛选" class="headerlink" title="可以实现分组后的筛选"></a>可以实现分组后的筛选</h4><p>案例1：查询哪个部门的员工个数&gt;5</p>
<p>分析1：查询每个部门的员工个数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="string">`员工个数`</span>,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>

<p>分析2：在刚才的结果基础上，筛选哪个部门的员工个数&gt;5</p>
<p>因此思路是在where后加count(<em>)&gt;5的判断，但会报错，原因在于select执行在where后，count函数此时还无意义。此时where的条件只能看到from后面emp的表，没有包含count()这一列，因此应该放在group by后面，但会报错，因为此时不应该用where，而是使用having连接词，*</em>having才支持后面加分组函数和分组后的筛选**。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="string">`员工个数`</span>,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>小结：分组前筛选，还没有group by，此时能够筛选的列只能够从from后面的原始表格列中获取；而分组后筛选，基于的表是分组后的表，因此此时可以按照分组后的结果来筛选。为了区分分组前和分组后，使用关键词不同，分组前为where，分组后为having。</p>
<p>案例2：每个工种有奖金的员工的最高工资&gt;12000的工种编号和最高工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_id,<span class="keyword">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">MAX</span>(salary)&gt;<span class="number">12000</span>;</span><br></pre></td></tr></table></figure>

<p>有奖金的判断在分组前，最高工资的判断在分组后。</p>
<p>案例3：领导编号&gt;102的每个领导手下的最低工资大于5000的领导编号和最低工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> manager_id,<span class="keyword">MIN</span>(salary) <span class="string">`最低工资`</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id &gt; <span class="number">102</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> manager_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">MIN</span>(salary) &gt; <span class="number">5000</span></span><br></pre></td></tr></table></figure>

<p>将题干分段，先查询每个领导手下的最低工资，筛选刚才的结果。领导编号可以在分组前计算出来，因此可以放在where这。也可以放在having那，虽然结果一样，但这样效率比较低。因此既能放where和having的，优先放在where后面。</p>
<h4 id="可以实现排序"><a href="#可以实现排序" class="headerlink" title="可以实现排序"></a>可以实现排序</h4><p>案例：查询没有奖金的员工的最高工资&gt;6000的工种编号和最高工资，按最高工资升序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_id,<span class="keyword">MAX</span>(salary) <span class="string">`最高工资`</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="string">`最高工资`</span> &gt; <span class="number">6000</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">`最高工资`</span> <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>先按照工种分类，查询每个工种没有奖金的员工的最高工资；筛选刚才的 结果，看哪个最高工资&gt;6000；按最高工资升序。</p>
<h4 id="按多个字段分组"><a href="#按多个字段分组" class="headerlink" title="按多个字段分组"></a>按多个字段分组</h4><p>案例：查询每个工种每个部门的最低工资，并按最低工资降序</p>
<p>​    多个分组字段用<strong>逗号隔开</strong>，两个字段没有顺序要求。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary) <span class="string">`最低工资`</span>,job_id,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id,department_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">`最低工资`</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<h3 id="进阶六：连接查询"><a href="#进阶六：连接查询" class="headerlink" title="进阶六：连接查询"></a>进阶六：连接查询</h3><p>含义：又称多表查询，当查询的字段来自多个表时，就会用到连接查询。</p>
<p>如果直接使用以下语法，相当于用第一张表每一行内容去匹配第二张表每行内容，这样均能匹配成功。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>,boyName <span class="keyword">from</span> beauty,boys;</span><br></pre></td></tr></table></figure>

<p>这样一个人的“理想男友”会变成多个。即为笛卡尔乘积现象，两个表所有行数相乘。两个表实现完全连接。</p>
<p>笛卡尔成绩现象：表1有m行，表2有n行，结果=m*n行</p>
<p>发生原因：没有有效的连接条件</p>
<p>如何避免：添加有效的连接条件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`name`</span>,boyName <span class="keyword">FROM</span> beauty,boys</span><br><span class="line"><span class="keyword">WHERE</span> beauty.<span class="string">`boyfriend_id`</span> = boys.<span class="string">`id`</span>;</span><br></pre></td></tr></table></figure>

<p>用点号来标识属性的归属。</p>
<p>分类：</p>
<ul>
<li><p>按年代分类</p>
<ul>
<li>sql92标准：MySQL中仅仅支持内连接</li>
<li>sql99标准【推荐】：支持内连接+外连接（左外和右外）+交叉连接</li>
</ul>
</li>
<li><p>按功能分类</p>
<ul>
<li><p>内连接</p>
<ul>
<li>等值连接</li>
<li>非等值连接</li>
<li>自连接</li>
</ul>
</li>
<li><p>外连接</p>
<ul>
<li>左外连接</li>
<li>右外连接</li>
<li>全外连接</li>
</ul>
</li>
<li><p>交叉连接</p>
</li>
</ul>
</li>
</ul>
<h4 id="sql92标准"><a href="#sql92标准" class="headerlink" title="sql92标准"></a>sql92标准</h4><h5 id="等值连接"><a href="#等值连接" class="headerlink" title="等值连接"></a>等值连接</h5><p>1、等值连接</p>
<p>语法：</p>
<p>select 查询列表</p>
<p>from 表1 别名，表2，别名</p>
<p>where 表1.key=表2.key</p>
<p>【and 筛选条件】</p>
<p>【group by 分组字段】</p>
<p>【having 分组后的筛选】</p>
<p>【order by 排序字段】</p>
<p>特点：</p>
<ul>
<li>多表等值连接额结果为多表的交集部分</li>
<li>n表连接，至少需要n-1个连接条件</li>
<li>多表的顺序没有要求</li>
<li>一般需要为表起别名</li>
<li>可以搭配前面介绍的所有子句使用，如筛选，分组，排序</li>
</ul>
<p>案例1：查询女神名和对应的男神名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`name`</span>,boyName </span><br><span class="line"><span class="keyword">FROM</span> beauty,boys</span><br><span class="line"><span class="keyword">WHERE</span> beauty.<span class="string">`boyfriend_id`</span> = boys.<span class="string">`id`</span>;</span><br></pre></td></tr></table></figure>

<p>将要查询的两个属性写在select中，查询的表写在from中，用逗号隔开，最重要的是写where语句。</p>
<p>用第一个表的每一行去匹配第二个表的每一行。</p>
<p>案例2：查询员工名和对应的部门名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_name</span><br><span class="line"><span class="keyword">FROM</span> employees,departments</span><br><span class="line"><span class="keyword">WHERE</span> employees.<span class="string">`department_id`</span> = departments.<span class="string">`department_id`</span>;</span><br></pre></td></tr></table></figure>

<p>2、为表起别名</p>
<ul>
<li>提高语句的简洁度</li>
<li>区分多个重名的字段</li>
</ul>
<p>注意：如果为表起了别名，则查询的字段就不能使用原来的表名去限定。</p>
<p>案例：查询员工名，工种号，工种名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,employees.<span class="string">`job_id`</span>,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees,jobs</span><br><span class="line"><span class="keyword">WHERE</span> employees.<span class="string">`job_id`</span> = jobs.<span class="string">`job_id`</span>;</span><br></pre></td></tr></table></figure>

<p>如果一个字段在多个表中都出现，为了避免歧义，那么需要加上完整的表名，为了方便，给表起别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name,e.<span class="string">`job_id`</span>,j.job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e,jobs j</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`job_id`</span> = j.<span class="string">`job_id`</span>;</span><br></pre></td></tr></table></figure>

<p><strong>起了别名后，就不能再使用原来的名称了</strong>，因为from先执行，这样表就有了别名。</p>
<p>3、两个表的顺序是否可以调换</p>
<p>可以替换</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name,e.<span class="string">`job_id`</span>,j.job_title</span><br><span class="line"><span class="keyword">FROM</span> jobs j,employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`job_id`</span> = j.<span class="string">`job_id`</span>;</span><br></pre></td></tr></table></figure>

<p>表的交集</p>
<p>4、加筛选</p>
<p>案例1：查询有奖金的员工名、部门名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e,departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> e.<span class="string">`commission_pct`</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>在WHERE后利用AND添加筛选</p>
<p>案例2：查询城市名中第二个字符为o的部门名和城市名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_name,city</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`departments`</span> d,<span class="string">`locations`</span> l</span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">AND</span> city <span class="keyword">LIKE</span> <span class="string">'_o%'</span>;</span><br></pre></td></tr></table></figure>

<p>关键：找到两个的连接关系。一般都给表起别名，更方便。</p>
<p>5、加分组</p>
<p>案例1：查询每个城市的部门个数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="string">`部门个数`</span>,city</span><br><span class="line"><span class="keyword">FROM</span> departments d,locations l</span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city;</span><br></pre></td></tr></table></figure>

<p>部门个数，为count(*)，部门个数跟城市在两个表中，利用location_id进行连接，然后每个城市，用城市来进行分组。</p>
<p>案例2：查询有奖金的每个部门的部门名和部门的领导编号和该部门的最低工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_name,d.manager_id,<span class="keyword">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`departments`</span> d,<span class="string">`employees`</span> e</span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`department_id`</span> = e.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> e.<span class="string">`commission_pct`</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name,manager_id;</span><br></pre></td></tr></table></figure>

<p>先把要查询的写在select，然后来自的表，先加表格的连接条件，然后增加筛选，最后加上按照部门名和领导编号进行分组。</p>
<p>因为要查询的有两个列，不能确定这两个列是否一一对应，因此分组的时候最好将这两个组都添加上。</p>
<p>6、加排序</p>
<p>案例：查询每个工种的工种名和员工的个数，并且按员工个数降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_title,<span class="keyword">COUNT</span>(*) <span class="string">`员工个数`</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`jobs`</span> j,<span class="string">`employees`</span> e</span><br><span class="line"><span class="keyword">WHERE</span> j.<span class="string">`job_id`</span>=e.<span class="string">`job_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_title</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">`员工个数`</span> <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>7、三表连接</p>
<p>案例：查询员工名、部门名和所在的城市</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_name,city</span><br><span class="line"><span class="keyword">FROM</span> employees e,departments d,locations l</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span>;</span><br></pre></td></tr></table></figure>

<h5 id="非等值连接"><a href="#非等值连接" class="headerlink" title="非等值连接"></a>非等值连接</h5><p>语法：</p>
<p>select 查询列表</p>
<p>from 表1 别名，表2，别名</p>
<p>where 非等值条件</p>
<p>【and 筛选条件】</p>
<p>【group by 分组字段】</p>
<p>【having 分组后的筛选】</p>
<p>【order by 排序字段】</p>
<p>案例1：查询员工的工资和工资级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary,grade_level</span><br><span class="line"><span class="keyword">FROM</span> employees e,job_grades j</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`salary`</span> <span class="keyword">BETWEEN</span> j.<span class="string">`lowest_sal`</span> <span class="keyword">AND</span> j.<span class="string">`highest_sal`</span>;</span><br></pre></td></tr></table></figure>

<p>salary在最低和最高之间的范围即可。也可以在后面加AND用于筛选或者增加排序。</p>
<h5 id="自连接"><a href="#自连接" class="headerlink" title="自连接"></a>自连接</h5><p>案例：查询员工名和上级的名称</p>
<p>​    如员工有对应的领导编号，然后用领导编号再找为此编号的员工姓名。相当于<strong>一个表和自己相连接</strong>。</p>
<img src="/2020/02/09/MySQL/%E8%87%AA%E8%BF%9E%E6%8E%A5.png" class title="This is an example image">

<p>将一张表当成2张或更多来使用。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id,e.last_name,m.employee_id,m.last_name</span><br><span class="line"><span class="keyword">FROM</span> employees e,employees m</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`manager_id`</span>=m.<span class="string">`employee_id`</span>;</span><br></pre></td></tr></table></figure>

<p>这时候就体现出了起别名的好处，增加了代码可读性。</p>
<h3 id="练习题4"><a href="#练习题4" class="headerlink" title="练习题4"></a>练习题4</h3><p>1、显示员工表的最大工资，工资平均值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">max</span>(salary),<span class="keyword">avg</span>(salary) <span class="keyword">from</span> employees;</span><br></pre></td></tr></table></figure>

<p>2、查询员工表的employee_id，job_id，last_name，按department_id降序，salary升序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id，job_id，last_name</span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> department_id <span class="keyword">desc</span>,salary <span class="keyword">asc</span>;</span><br></pre></td></tr></table></figure>

<p>3、查询员工表的job_id中包含a和e的，并且a在e的前面</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> job_id</span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">where</span> job_id <span class="keyword">like</span> <span class="string">'%a%e%'</span>;</span><br></pre></td></tr></table></figure>

<p>4、已知表student，里面有id(学号)，name,grade_id(年级编号)；已知表grade，里面有id(年级编号),name(年级名)；已知表result，里面有id，score，studentNo(学号)。要求查询姓名、年级名、成绩。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> s.name,g.name,r.score</span><br><span class="line"><span class="keyword">from</span> student s,grade g,<span class="keyword">result</span> r</span><br><span class="line"><span class="keyword">where</span> s.grade_id=g.id</span><br><span class="line"><span class="keyword">and</span> s.id=r.studentNo;</span><br></pre></td></tr></table></figure>

<p>5、显示当前日期，以及去前后空格，截取子字符串的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select now();</span><br><span class="line">select trim(字符 from &#39;&#39;);</span><br><span class="line">select substr(str,startIndex);</span><br><span class="line">select substr(str,startIndex,length);</span><br></pre></td></tr></table></figure>

<p>6、显示所有员工的姓名，部门号和部门名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,d.department_id,department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e,departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span>;</span><br></pre></td></tr></table></figure>

<p>7、查询90号部门员工的job_id和90号部门的location_id</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.job_id,d.location_id</span><br><span class="line"><span class="keyword">FROM</span> employees e,departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> e.<span class="string">`department_id`</span>=<span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<p>限定条件为员工的部门编号为90</p>
<p>8、选择所有有奖金的员工的last_name,department_name,location_id,city</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name,d.department_name,d.location_id,l.city</span><br><span class="line"><span class="keyword">FROM</span> employees e,departments d,locations l</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">AND</span> e.<span class="string">`commission_pct`</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>9、选择city在Toronto工作的员工的last_name，job_id，department_id，department_name</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name,e.job_id,e.department_id,d.department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e,departments d,locations l</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">AND</span> l.<span class="string">`city`</span>=<span class="string">'Toronto'</span>;</span><br></pre></td></tr></table></figure>

<p>10、查询每个工种、每个部门的部门名、工种名和最低工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.department_name,j.job_title,<span class="keyword">MIN</span>(salary) <span class="string">`最低工资`</span></span><br><span class="line"><span class="keyword">FROM</span> departments d,jobs j,employees e</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">AND</span> e.<span class="string">`job_id`</span>=j.<span class="string">`job_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> j.job_title,d.department_name;</span><br></pre></td></tr></table></figure>

<p>11、查询每个国家下的部门个数大于2的国家编号</p>
<p>将位置表和部门表连接，这时候部门编号没有重复，每个部门编号都有对应的国家名，然后利用国家分组，就可以算出其部门个数。</p>
<img src="/2020/02/09/MySQL/%E5%9B%BD%E5%AE%B6%E5%AF%B9%E9%83%A8%E9%97%A8%E8%A1%A8.png" class title="This is an example image">

<p>最后加上分组后的筛选条件，放在having语句后</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> country_id,<span class="keyword">COUNT</span>(*) <span class="string">`部门个数`</span></span><br><span class="line"><span class="keyword">FROM</span> locations l,departments d</span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`location_id`</span>=l.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> country_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>having后也可以支持别名，但不太建议。</p>
<p>12、选择指定员工的姓名，员工号，以及他的管理者的姓名和员工号</p>
<p>格式类似于</p>
<p>employees     Emp#        manager            Mgr#</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name employees,e.employee_id <span class="string">`Emp#`</span>,m.last_name manager,m.employee_id <span class="string">`Mgr#`</span></span><br><span class="line"><span class="keyword">FROM</span> employees e,employees m</span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`manager_id`</span>=m.<span class="string">`employee_id`</span>;</span><br></pre></td></tr></table></figure>

<h4 id="sql99标准"><a href="#sql99标准" class="headerlink" title="sql99标准"></a>sql99标准</h4><p>语法：</p>
<p>select 查询列表</p>
<p>from 表1 别名【连接类型】</p>
<p>join 表2 别名</p>
<p>on连接条件</p>
<p>【where 筛选条件】</p>
<p>【group by 分组】</p>
<p>【having 筛选条件】</p>
<p>【order by 排序列表】</p>
<p>对比sql92，将连接条件和筛选条件进行了分类，提高可读性</p>
<p>分类：</p>
<ul>
<li><p><strong>内连接</strong>（重点）：inner</p>
</li>
<li><p>外连接</p>
<ul>
<li><strong>左外</strong>（重点）：left 【outer】</li>
<li><strong>右外</strong>（重点）：right【outer】</li>
<li>全外：full【outer】</li>
</ul>
</li>
<li><p>交叉连接：cross</p>
</li>
</ul>
<h5 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h5><p>select 查询列表</p>
<p>from 表1 别名</p>
<p>inner join 表2 别名</p>
<p>on 连接条件</p>
<p>【join 表3 别名 on 连接条件】</p>
<p>可以<strong>多个join相连接</strong>。</p>
<p>特点：</p>
<ul>
<li>添加排序、分组、筛选</li>
<li>inner可以省略</li>
<li>筛选条件放在where后面，连接条件放在on后面，提高分离性，便于阅读</li>
<li>inner join连接和sql92语法中的等值连接效果是一样，都是查询多表的交集</li>
</ul>
<p>1、等值连接</p>
<p>案例1：查询员工名、部门名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span>;</span><br></pre></td></tr></table></figure>

<p>将两个表的位置调换顺序也可以</p>
<p>案例2：查询名字中包含e的员工名和工种名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> jobs j</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`job_id`</span>=j.<span class="string">`job_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%e%'</span>;</span><br></pre></td></tr></table></figure>

<p>案例3：查询部门个数&gt;3的城市名和部门个数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> city,<span class="keyword">COUNT</span>(*) 部门个数</span><br><span class="line"><span class="keyword">FROM</span> locations l</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> l.<span class="string">`location_id`</span>=d.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> city</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>可以分步来做，先按照城市来分组，然后按照部门个数来筛选</p>
<p>案例4：查询哪个部门的部门员工个数&gt;3的部门名和员工个数，并按个数降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_name,<span class="keyword">COUNT</span>(*) 员工个数</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">3</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COUNT</span>(*) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>案例5：查询员工名、部门名、工种名，并按部门名排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> e.<span class="string">`job_id`</span>=j.<span class="string">`job_id`</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> department_name;</span><br></pre></td></tr></table></figure>

<p>三表连接，先写一个inner join 表1 别名 on 连接条件，然后再写一个inner join 表2 别名 on 连接条件。保证第三个表和前两个表中的<strong>至少一个有连接条件</strong>。</p>
<p>2、非等值连接</p>
<p>案例1：查询员工的工资级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary,grade_level</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> job_grades g</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`salary`</span> <span class="keyword">BETWEEN</span> g.<span class="string">`lowest_sal`</span> <span class="keyword">AND</span> g.<span class="string">`highest_sal`</span>;</span><br></pre></td></tr></table></figure>

<img src="/2020/02/09/MySQL/jobgrades.png" class title="This is an example image">

<p>案例2：查询工资级别的个数&gt;2的个数，并且按工资级别降序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> grade_level,<span class="keyword">COUNT</span>(*) 工资级别个数</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> job_grades g</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`salary`</span> <span class="keyword">BETWEEN</span> g.<span class="string">`lowest_sal`</span> <span class="keyword">AND</span> g.<span class="string">`highest_sal`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> grade_level</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">2</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> grade_level <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>3、自连接</p>
<p>案例：查询姓名中包含字符k员工的名字，上级的名字</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name,m.last_name</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> employees m</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`manager_id`</span>=m.<span class="string">`employee_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`last_name`</span> <span class="keyword">LIKE</span> <span class="string">'%k%'</span>;</span><br></pre></td></tr></table></figure>

<h5 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h5><p>应用场景：用于查询一个表中有，另一个表没有的记录</p>
<p>特点：</p>
<ol>
<li><p>外连接的查询结果为主表中的所有记录</p>
<ul>
<li>如果从表中有和它匹配的，则显示匹配的值</li>
<li>如果从表中没有和它匹配的，则显示null</li>
<li>外连接查询结果=内连接结果+主表中有而从表没有的记录</li>
</ul>
</li>
<li><p>左外连接，left join左边的是左表</p>
<p>右外连接，right join右边的是主表</p>
</li>
<li><p>左外和右外交换两个表的顺序，可以实现同样的效果</p>
</li>
<li><p>全外连接=内连接的结果+表1中有但表2没有的+表2中有但表1没有的</p>
</li>
</ol>
<p>引入：查询男朋友不在男神表的女神名</p>
<p>之前的内连接查两个表的交集部分，因此无法直接用来实现这里的需求。</p>
<p>做外连接实现</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> b.name,bo.*</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.<span class="string">`boyfriend_id`</span>=bo.<span class="string">`id`</span>;</span><br></pre></td></tr></table></figure>

<img src="/2020/02/09/MySQL/%E5%B7%A6%E6%9F%A5%E8%AF%A21.png" class title="This is an example image">

<p>如果只想看没有男朋友不在表中的女神信息，可以加入筛选</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> b.name,bo.*</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.<span class="string">`boyfriend_id`</span>=bo.<span class="string">`id`</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>选择id来判断是因为boys中的id为主键，不能为null。判断时最好选从表中的主键列。</p>
<p>右外连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> b.name,bo.*</span><br><span class="line"><span class="keyword">FROM</span> boys bo</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> beauty b</span><br><span class="line"><span class="keyword">ON</span> b.<span class="string">`boyfriend_id`</span>=bo.<span class="string">`id`</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>案例1：查询哪个部门没有员工</p>
<p>左外</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.*,e.employee_id</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e</span><br><span class="line"><span class="keyword">ON</span> d.<span class="string">`department_id`</span>=e.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`employee_id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>查询的没有员工的部门，因此主表是部门，然后与员工表左连接，筛选条件为没有员工即员工的id为NULL。</p>
<p>右外</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.*,e.employee_id</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> departments d </span><br><span class="line"><span class="keyword">ON</span> d.<span class="string">`department_id`</span>=e.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`employee_id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<h5 id="全外"><a href="#全外" class="headerlink" title="全外"></a>全外</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b.*,bo.*</span><br><span class="line"><span class="keyword">from</span> beauty b</span><br><span class="line"><span class="keyword">full</span> <span class="keyword">join</span> boys bo</span><br><span class="line"><span class="keyword">on</span> b.boyfriend_id=bo.id</span><br></pre></td></tr></table></figure>

<p>MySQL不支持</p>
<h5 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> b.*,bo.*</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">CROSS</span> <span class="keyword">JOIN</span> boys bo;</span><br></pre></td></tr></table></figure>

<p>结果就为笛卡尔乘积</p>
<h4 id="sql92与sql99"><a href="#sql92与sql99" class="headerlink" title="sql92与sql99"></a>sql92与sql99</h4><p>功能：sql99支持的更多</p>
<p>可读性：sql99实现连接条件和筛选条件的分离，可读性较高</p>
<p>下为内连接，左外，右外的比较</p>
<img src="/2020/02/09/MySQL/%E4%B8%89%E7%A7%8D%E8%BF%9E%E6%8E%A5.png" class title="This is an example image">

<p>下为左外，右外加筛选和全外的比较</p>
<img src="/2020/02/09/MySQL/%E5%B7%A6%E5%A4%96%E5%8F%B3%E5%A4%96%E5%85%A8%E5%A4%96.png" class title="This is an example image">

<h3 id="多表连接练习"><a href="#多表连接练习" class="headerlink" title="多表连接练习"></a>多表连接练习</h3><p>1、查询编号&gt;3的女神的男朋友信息，如果有则列出详细，如果没有，用null填充</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> b.name,b.<span class="string">`id`</span>,bo.*</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> boys bo</span><br><span class="line"><span class="keyword">ON</span> b.<span class="string">`boyfriend_id`</span>=bo.<span class="string">`id`</span></span><br><span class="line"><span class="keyword">WHERE</span> b.<span class="string">`id`</span>&gt;<span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>2、查询哪个城市没有部门</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> city</span><br><span class="line"><span class="keyword">FROM</span> locations l</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> l.<span class="string">`location_id`</span>=d.<span class="string">`location_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`department_id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>用从表的主键去判断</p>
<p>3、查询部门名为SAL或IT的员工信息</p>
<p>这两个部门可能没有员工，会外连接会比较全。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_name,e.*</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e</span><br><span class="line"><span class="keyword">ON</span> d.<span class="string">`department_id`</span>=e.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`department_name`</span> <span class="keyword">IN</span>(<span class="string">'SAL'</span>,<span class="string">'IT'</span>);</span><br></pre></td></tr></table></figure>

<p>如果用departments来当主表，信息会比较全，会将空的员工信息也显示上去。用d来当主表对比用e来当主表，会多出NULL的员工信息，因为有的部门中没有员工。想要哪个表信息更全，就用哪个表来当主键。差的是部门的员工信息，因此主要是看部门。如果用员工表当主表，会去掉空的员工信息。</p>
<h3 id="进阶七：子查询"><a href="#进阶七：子查询" class="headerlink" title="进阶七：子查询"></a>进阶七：子查询</h3><h4 id="含义："><a href="#含义：" class="headerlink" title="含义："></a>含义：</h4><p>出现在其他语句中的select语句，称为子查询或内查询</p>
<p>外部的查询语句，称为主查询或外查询</p>
<p>外面的语句可以是insert、update、delete、<strong>select</strong>等，一般select作为外面语句较多</p>
<h4 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h4><p>按子查询出现的位置：</p>
<ul>
<li>select后面<ul>
<li>仅仅支持标量子查询</li>
</ul>
</li>
<li>from后面<ul>
<li>支持表子查询</li>
</ul>
</li>
<li><strong>where或having后面</strong>（重点）<ul>
<li><strong>标量子查询</strong>（单行）（重点）</li>
<li><strong>列子查询</strong>（多行）（重点）</li>
<li>行子查询（较少）</li>
</ul>
</li>
<li>exists后面（相关子查询）<ul>
<li>表子查询    </li>
</ul>
</li>
</ul>
<p>按结果集的行列数不同：</p>
<ul>
<li>标量子查询（结果集只有一行一列）</li>
<li>列子查询（结果集有只一列多行）</li>
<li>行子查询（结果集有一行多列）</li>
<li>表子查询（结果集一般为多行多列）</li>
</ul>
<h4 id="where或having后面"><a href="#where或having后面" class="headerlink" title="where或having后面"></a>where或having后面</h4><p>1、标量子查询（单行子查询）</p>
<p>2、列子查询（多行子查询）</p>
<p>3、行子查询（多列多行）</p>
<p>特点：</p>
<ul>
<li><p>子查询放在小括号内</p>
</li>
<li><p>子查询一般放在条件的右侧</p>
</li>
<li><p>标量子查询，一般搭配着单行操作符使用</p>
<p>&lt;  &gt;  &lt;=  &gt;=  =  &lt;&gt;</p>
</li>
<li><p>列子查询，一般搭配多行操作符使用</p>
<p>IN,ANY/SOME,ALL</p>
</li>
<li><p>子查询的的执行优先于主查询执行，主查询的条件用到了子查询的结果</p>
</li>
</ul>
<p>1、标量子查询</p>
<p>案例1：谁的工资比Abel高</p>
<p>步骤1：查询Abel的工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> last_name=<span class="string">'Abel'</span>;</span><br></pre></td></tr></table></figure>

<p>出来的结果为一行一列，因此为标量子查询</p>
<p>步骤2：查询员工的信息，满足salary大于步骤1结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary&gt;(</span><br><span class="line">	<span class="keyword">SELECT</span> salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name=<span class="string">'Abel'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>案例2：返回job_id与141号员工相同，salary比143号员工多的员工姓名，job_id和工资</p>
<p>步骤1：查询141号员工的job_id</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id=<span class="number">141</span>;</span><br></pre></td></tr></table></figure>

<p>步骤2：查询143号员工的salary</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line"><span class="keyword">FROM</span>  employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id=<span class="number">143</span>;</span><br></pre></td></tr></table></figure>

<p>步骤3：查询员工的姓名，job_id和工资，要求job_id=步骤1，并且salary&gt;步骤2</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,job_id,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id=(</span><br><span class="line">	<span class="keyword">SELECT</span> job_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> employee_id=<span class="number">141</span></span><br><span class="line">) <span class="keyword">AND</span> salary&gt;(</span><br><span class="line">	<span class="keyword">SELECT</span> salary</span><br><span class="line">	<span class="keyword">FROM</span>  employees</span><br><span class="line">	<span class="keyword">WHERE</span> employee_id=<span class="number">143</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>案例3：返回公司工资最少的员工的last_name,job_id和salary</p>
<p>步骤1：查询公司的最低工资</p>
<p>步骤2：查询last_name,job_id和salary，要求salary=步骤1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,job_id,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary=(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>案例4：查询最低工资大于50号部门最低工资的部门id和其最低工资</p>
<p>步骤1：查询50号部门最低工资</p>
<p>步骤2：查询每个部门的最低工资</p>
<p>步骤3：在步骤2基础上筛选，满足min(salary)&gt;步骤1结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary),department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary)</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">WHERE</span> department_id=<span class="number">50</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>非法使用标量子查询</p>
<p>子查询结果不为一行一列，可能为空或者多行，都不可以。</p>
<p>2、列子查询（多行子查询）</p>
<ul>
<li>使用多行</li>
<li>使用多行比较操作符</li>
</ul>
<table>
<thead>
<tr>
<th><strong>操作符</strong></th>
<th><strong>含义</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>IN/NOT IN</strong></td>
<td>等于列表中的<strong>任意一个</strong></td>
</tr>
<tr>
<td>ANY|SOME</td>
<td>和子查询返回的<strong>某一个</strong>值比较</td>
</tr>
<tr>
<td>ALL</td>
<td>和子查询返回的<strong>所有</strong>值比较</td>
</tr>
</tbody></table>
<p>a &gt; any(10,15,20)，意思为a比其中某一个大即可，此时可以替换成min</p>
<p>a&gt;all(10,15,20)，要大于所有，此时可以替换成max</p>
<p>案例1：返回location_id是1400或1700的部门中的所有员工姓名</p>
<p>步骤1：查询location_id是1400或1700的部门标号</p>
<p>最好去重</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> location_id <span class="keyword">IN</span>(<span class="number">1400</span>,<span class="number">1700</span>)</span><br></pre></td></tr></table></figure>

<p>步骤2：查询员工姓名，要求部门号是步骤1结果中的某一个</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">    <span class="keyword">FROM</span> departments</span><br><span class="line">    <span class="keyword">WHERE</span> location_id <span class="keyword">IN</span>(<span class="number">1400</span>,<span class="number">1700</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>也可以将IN替换为= ANY，因为IN意思为在其中某个就可以，与= ANY意思相同。如果是NOT IN，表示全不在这个范围内，那么可以替换为NOT ALL，所有的都不在。</p>
<p>案例2：返回其它工种中比job_id为‘IT_PROG’工种任一工资低的员工的员工号、姓名、job_id 以及salary</p>
<p>步骤1：查询job_id为‘IT_PROG’部门任一工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> job_id=<span class="string">'IT_PROG'</span></span><br></pre></td></tr></table></figure>

<p>步骤2：查询员工号、姓名、job_id 以及salary，salary&lt;any（步骤1结果），job_id不为IT</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,job_id,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary&lt;<span class="keyword">ANY</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> job_id=<span class="string">'IT_PROG'</span></span><br><span class="line">) <span class="keyword">AND</span> job_id &lt;&gt; <span class="string">'IT_PROG'</span>;</span><br></pre></td></tr></table></figure>

<p>或者小于其中任意工资，就是小于其最大工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,job_id,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary&lt;(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> job_id=<span class="string">'IT_PROG'</span></span><br><span class="line">) <span class="keyword">AND</span> job_id &lt;&gt; <span class="string">'IT_PROG'</span>;</span><br></pre></td></tr></table></figure>

<p>案例3：返回其它工种中比job_id为‘IT_PROG’工种所有工资都低的员工的员工号、姓名、job_id 以及salary</p>
<p>相比于案例2，相当于把any替换为all</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,job_id,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary&lt;<span class="keyword">ALL</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> job_id=<span class="string">'IT_PROG'</span></span><br><span class="line">) <span class="keyword">AND</span> job_id &lt;&gt; <span class="string">'IT_PROG'</span>;</span><br></pre></td></tr></table></figure>

<p>或者小于所有，就是小于最小工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,job_id,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary&lt;(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">Min</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> job_id=<span class="string">'IT_PROG'</span></span><br><span class="line">) <span class="keyword">AND</span> job_id &lt;&gt; <span class="string">'IT_PROG'</span>;</span><br></pre></td></tr></table></figure>

<p>3、行子查询（结果集一行多列或多行多列）</p>
<p>案例：查询员工编号最小并且工资最高的员工信息</p>
<p>之前的写法</p>
<p>步骤1：查询最小的员工编号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(employee_id) </span><br><span class="line"><span class="keyword">FROM</span> employees</span><br></pre></td></tr></table></figure>

<p>步骤2：查询最高工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary) </span><br><span class="line"><span class="keyword">FROM</span> employees</span><br></pre></td></tr></table></figure>

<p>步骤3：查询员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id=(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(employee_id) </span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">) <span class="keyword">AND</span> salary=(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary) </span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>利用行子查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> (employee_id,salary)=(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(employee_id),<span class="keyword">MAX</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>比较有局限性，要求查询的多个结果能用相同的运算符计算得出。</p>
<h4 id="select后面"><a href="#select后面" class="headerlink" title="select后面"></a>select后面</h4><p>案例1：查询每个部门的员工个数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.*,(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*)</span><br><span class="line">	<span class="keyword">FROM</span> employees e</span><br><span class="line">	<span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line">) <span class="string">`个数`</span></span><br><span class="line"><span class="keyword">FROM</span> departments d;</span><br></pre></td></tr></table></figure>

<p>查询员工个数，然后显示在select后，因为要查询的员工数有要求和部门数id相同，需要加上筛选</p>
<p>如果用<strong>左外连接</strong>来做，如果直接查询count(*）这样查询到的员工数最少为1，错误将员工数为0的部门员工数查询为1，因为忽略了NULL值，应该使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.*,<span class="keyword">COUNT</span>(employee_id)</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees e</span><br><span class="line"><span class="keyword">ON</span> d.<span class="string">`department_id`</span>=e.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.<span class="string">`department_id`</span></span><br></pre></td></tr></table></figure>

<p>案例2：查询员工号=102的部门名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> department_name</span><br><span class="line">	<span class="keyword">FROM</span> departments d</span><br><span class="line">	<span class="keyword">JOIN</span> employees e</span><br><span class="line">	<span class="keyword">ON</span> d.<span class="string">`department_id`</span>=e.<span class="string">`department_id`</span></span><br><span class="line">	<span class="keyword">WHERE</span> e.<span class="string">`employee_id`</span>=<span class="number">102</span></span><br><span class="line">) <span class="string">`部门名`</span>;</span><br></pre></td></tr></table></figure>

<p>没必要多加一层select。可以被其他方式代替</p>
<h4 id="from后面"><a href="#from后面" class="headerlink" title="from后面"></a>from后面</h4><p>将子查询结果充当一张表，要求必须起别名</p>
<p>案例：查询每个部门的平均工资的工资等级</p>
<p>步骤1：查询每个部门的平均工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary),department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br></pre></td></tr></table></figure>

<p>这样就得到了平均工资的表</p>
<p>步骤2：连接步骤1的结果集和job_grades表，筛选平均工资在最低和最高之间</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ag_dep.*,g.<span class="string">`grade_level`</span></span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) ag,department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">) ag_dep</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> job_grades g</span><br><span class="line"><span class="keyword">ON</span> ag_dep.ag <span class="keyword">BETWEEN</span> g.<span class="string">`lowest_sal`</span> <span class="keyword">AND</span> g.<span class="string">`highest_sal`</span>;</span><br></pre></td></tr></table></figure>

<p>注意，步骤1得到的表需要起别名，要用到的平均工资也起别名，将1得到的表和登记表内连接，然后输出1的所有信息和等级表的等级。</p>
<h4 id="exists后面（相关子查询）"><a href="#exists后面（相关子查询）" class="headerlink" title="exists后面（相关子查询）"></a>exists后面（相关子查询）</h4><p>语法：</p>
<p>exists（完整的查询语句）</p>
<p>结果：1或0</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">EXISTS</span>(<span class="keyword">SELECT</span> employee_id <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>

<p>输出为1，表示子查询有值。输出0，表示子查询没有值</p>
<p>案例 1：查询有员工的部门名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> *</span><br><span class="line">	<span class="keyword">FROM</span> employees e</span><br><span class="line">	<span class="keyword">WHERE</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>或者使用WHERE后加IN</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> d.<span class="string">`department_id`</span> <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>案例2：查询没有女朋友的男神信息</p>
<p>in的方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> bo.*</span><br><span class="line"><span class="keyword">from</span> boys bo</span><br><span class="line"><span class="keyword">where</span> bo.id <span class="keyword">not</span> <span class="keyword">in</span>(</span><br><span class="line">	<span class="keyword">select</span> boyfiend_id</span><br><span class="line">	<span class="keyword">from</span> beauty</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>exists方式</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> bo.*</span><br><span class="line"><span class="keyword">from</span> boys bo</span><br><span class="line"><span class="keyword">where</span> <span class="keyword">not</span> <span class="keyword">exists</span>(</span><br><span class="line">	<span class="keyword">select</span> boyfriend_id</span><br><span class="line">	<span class="keyword">from</span> beauty b</span><br><span class="line">	<span class="keyword">where</span> bo.id=b.boyfriend_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="练习题5"><a href="#练习题5" class="headerlink" title="练习题5"></a>练习题5</h3><p>1、查询和Zlotkey相同部门的员工姓名和工资</p>
<p>步骤1：查询Zlotkey的部门</p>
<p>步骤2：查询部门号=步骤1的姓名和工资 </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id=(</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name=<span class="string">'Zlotkey'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>2、查询工资比公司平均工资高的员工的员工号，姓名和工资</p>
<p>步骤1：查询平均工资</p>
<p>步骤2：查询工资大于步骤1的员工号，姓名和工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> employee_id,last_name,salary</span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">where</span> salary&gt;(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>3、查询各部门中工资比本部门平均工资高的员工的员工号，姓名和工资</p>
<p>步骤1：查询各部门的平均工资</p>
<p>步骤2：连接步骤1结果集和employee表，进行筛选</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,e.salary,<span class="string">`avg`</span></span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id dep,<span class="keyword">AVG</span>(salary) <span class="string">`avg`</span></span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">) avg_dep</span><br><span class="line"><span class="keyword">ON</span> e.department_id=dep</span><br><span class="line"><span class="keyword">WHERE</span> e.salary &gt; <span class="string">`avg`</span>;</span><br></pre></td></tr></table></figure>

<p>技巧：先要自己知道大概是什么样的结果，再写了去验证</p>
<p>4、查询和姓名中包含字母u的员工在相同部门的员工的员工号和姓名</p>
<p>步骤1：查询姓名中包含u的员工部门（去重）</p>
<p>步骤2：查询部门号=步骤1中任意一个的员工号和姓名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id,last_name</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%u%'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>5、查询在部门的location_id为1700的部门工作的员工的员工号</p>
<p>步骤1：查询location_id为1700的部门</p>
<p>步骤2：查询部门号=步骤1中任意一个的员工号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> departments</span><br><span class="line">	<span class="keyword">WHERE</span> location_id=<span class="number">1700</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>6、查询管理者是King的员工姓名和工资</p>
<p>步骤1：查询姓名为King的员工编号</p>
<p>步骤2：查询哪个员工 的manager_id=步骤1</p>
<p>当不知道用in还是=的时候，用in即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> employee_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name=<span class="string">'K_ing'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>7、查询工资最高的员工的姓名，要求first_name和last_name显示为一列，列名为姓.名</p>
<p>步骤1：查询最高工资</p>
<p>步骤2：查询工资=步骤1的结果的姓，名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">concat</span>(first_name,<span class="string">'.'</span>,last_name) <span class="string">`姓.名`</span></span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">where</span> salary=(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span>  employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="进阶八：分页查询"><a href="#进阶八：分页查询" class="headerlink" title="进阶八：分页查询"></a>进阶八：分页查询</h3><p>应用场景：当要显示的数据，一页显示不全，需要分页提交sql请求</p>
<p>语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表</span><br><span class="line"><span class="keyword">from</span> 表</span><br><span class="line">【<span class="keyword">join</span> <span class="keyword">type</span>  <span class="keyword">join</span> 表<span class="number">2</span></span><br><span class="line"><span class="keyword">on</span> 连接条件</span><br><span class="line"><span class="keyword">where</span>筛选条件</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span>分组字段</span><br><span class="line"><span class="keyword">having</span> 分组后的筛选</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序的字段】</span><br><span class="line"><span class="keyword">limit</span> 【<span class="keyword">offset</span>】,<span class="keyword">size</span>;</span><br><span class="line">offset：要显示条目的起始索引（起始索引从0开始）</span><br><span class="line">size：要显示的条目个数</span><br></pre></td></tr></table></figure>

<p>特点：</p>
<ul>
<li><p>limit语句放在查询语句的最后，执行也是最后，select–order by–limit</p>
</li>
<li><p>公式</p>
<p>要显示的页数page，每页的条目数size</p>
<p>select 查询列表</p>
<p>from 表</p>
<p>limit (page-1)*size,size</p>
</li>
</ul>
<p>案例1：查询前五条员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">5</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">LIMIT</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>offset是可选的</p>
<p>案例2：查询第11条-25条</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">LIMIT</span> <span class="number">10</span>,<span class="number">15</span>;</span><br></pre></td></tr></table></figure>

<p>案例3：有奖金的员工信息，并且工资较高的前10名显示</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<h3 id="练习题6"><a href="#练习题6" class="headerlink" title="练习题6"></a>练习题6</h3><p>已知表 stuinfo，包含有以下字段</p>
<ul>
<li>id    学号</li>
<li>name姓名</li>
<li>email 邮箱 <a href="mailto:john@126.com">john@126.com</a></li>
<li>gradeId 年级编号</li>
<li>sex 性别 男/女</li>
<li>age 年龄</li>
</ul>
<p>已知表grade</p>
<ul>
<li>id 年级编号</li>
<li>gradeName 年级名称</li>
</ul>
<p>1、查询所有学员邮箱的用户名（注：邮箱中@前面的字符）</p>
<p>select substr(email,1,instr(email,’@’)-1)</p>
<p>from stuinfo;</p>
<p>用到的函数有截取字符串，获取指定字符在字符串中的位置</p>
<p>2、查询男生和女生的个数</p>
<p>select count(*) 个数,sex</p>
<p>from stuinfo</p>
<p>group by sex;</p>
<p>主要为对性别进行分组，然后计数</p>
<p>3、查询年龄&gt;18岁的所有学生的姓名和年级名称</p>
<p>select name,gradeName</p>
<p>from stuinfo s</p>
<p>inner join grade g</p>
<p>on s.gradeId=g.id</p>
<p>where age&gt;18;</p>
<p>考察连接查询</p>
<p>4、查询哪个年级的学生最小年龄&gt;20</p>
<p>步骤1：查询每个年级的最小年龄</p>
<p>select min(age),gradeId</p>
<p>from stuinfo</p>
<p>group by gradeId</p>
<p>步骤2：在步骤1的结果上进行筛选，因此直接加上having判断即可</p>
<p>select min(age) ,gradeId</p>
<p>from stuinfo</p>
<p>group by gradeId</p>
<p>having min(age)&gt;20;</p>
<p>5、说出查询语句中涉及到的所有的关键字，以及执行先后顺序</p>
<p>select 查询列表</p>
<p>from 表                                                </p>
<p>连接类型 join 表2</p>
<p>on    连接条件</p>
<p>where    筛选条件</p>
<p>group by    分组列表</p>
<p>having    分组后的筛选</p>
<p>order by    排序列表</p>
<p>limit 偏移,条目数;</p>
<p>执行顺序：1、from锁定数据源；2、join两表连接生成笛卡尔乘积表；3、on将满足条件的数据过滤出生成新表；4、where在3的基础上筛选生成新表；5、group by分组生成新的虚拟表格；6、having将分组后的表格进行筛选；7、select将筛选完毕后的表选出进行查看；8、order by进行排序；9、limit记性分页显示。</p>
<p>注意：<strong>having后执行的是select</strong>！！！<strong>select在order by前面</strong>！！！</p>
<p>6、查询生日在“1988-1-1”后的学生姓名、专业名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`studentname`</span>,<span class="string">`majorname`</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`student`</span> s</span><br><span class="line"><span class="keyword">JOIN</span> <span class="string">`major`</span> m</span><br><span class="line"><span class="keyword">ON</span> s.<span class="string">`majorid`</span>=m.<span class="string">`majorid`</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">DATEDIFF</span>(<span class="string">`borndate`</span>,<span class="string">'1988-1-1'</span>)&gt;<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>生日在某个日期之后，可以使用DATEDIFF函数来判断。或者使用WHERE borndate&gt;’1988-1-1’;也可以。</p>
<p>7、<strong>查询每个专业的男生人数和女生人数分别是多少</strong></p>
<p>方式一：</p>
<p>按照专业和性别进行分组，<strong>多个分组条件用逗号隔开</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) 个数,sex,<span class="string">`majorid`</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`student`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> sex,<span class="string">`majorid`</span></span><br></pre></td></tr></table></figure>

<p>但是这样显示效果不好，不是非常直观</p>
<p>方式二：</p>
<p>希望显示的效果是专业，男生，女神</p>
<p>因此基本语法应该为</p>
<p>select majorid,男，女</p>
<p>from student</p>
<p>group by major id;</p>
<p>然后男生，女生个数 可以使用子查询。如果直接使用select count(*) from student where sex=‘男’或者女，这样查到的人数是总体的，而并不是某个年级的。因此还需要附加条件，加上majorid的限制。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> majorid,</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex=<span class="string">'男'</span> <span class="keyword">AND</span> majorid=s.majorid) 男,</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex=<span class="string">'女'</span> <span class="keyword">AND</span> majorid=s.majorid) 女</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> majorid;</span><br></pre></td></tr></table></figure>

<img src="/2020/02/09/MySQL/%E7%94%B7%E7%94%9F%E5%A5%B3%E7%94%9F.png" class title="This is an example image">

<p>8、查询专业和张翠山一样的学生的最低分<br>步骤1：查询张翠山的专业</p>
<p>步骤2：查询学生最低分，筛选条件为专业为步骤1结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(score)</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`student`</span> s</span><br><span class="line"><span class="keyword">JOIN</span> <span class="string">`result`</span> r</span><br><span class="line"><span class="keyword">ON</span> s.<span class="string">`studentno`</span>=r.<span class="string">`studentno`</span></span><br><span class="line"><span class="keyword">WHERE</span> s.<span class="string">`majorid`</span>=(</span><br><span class="line">	<span class="keyword">SELECT</span> majorid</span><br><span class="line">	<span class="keyword">FROM</span> student</span><br><span class="line">	<span class="keyword">WHERE</span> <span class="string">`studentname`</span>=<span class="string">'张翠山'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>或者可以先查张翠山专业，然后查哪些编号学生在这个专业中，然后查这些学生的最低分</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(score)</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">result</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="string">`studentno`</span> <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="string">`studentno`</span></span><br><span class="line">	<span class="keyword">FROM</span> <span class="string">`student`</span></span><br><span class="line">	<span class="keyword">WHERE</span> <span class="string">`majorid`</span>=(</span><br><span class="line">		<span class="keyword">SELECT</span> majorid</span><br><span class="line">		<span class="keyword">FROM</span> student</span><br><span class="line">		<span class="keyword">WHERE</span> <span class="string">`studentname`</span>=<span class="string">'张翠山'</span></span><br><span class="line">	)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>9、查询大于60分的学生的姓名、密码、专业名</p>
<p>使用sql92写法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`studentname`</span>,<span class="string">`loginpwd`</span>,<span class="string">`majorname`</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`student`</span> s,<span class="string">`result`</span> r,<span class="string">`major`</span> m</span><br><span class="line"><span class="keyword">WHERE</span> s.<span class="string">`studentno`</span>=r.<span class="string">`studentno`</span></span><br><span class="line"><span class="keyword">AND</span> s.<span class="string">`majorid`</span>=m.<span class="string">`majorid`</span></span><br><span class="line"><span class="keyword">AND</span> r.<span class="string">`score`</span>&gt;<span class="number">60</span>;</span><br></pre></td></tr></table></figure>

<p>使用sql99写法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`studentname`</span>,<span class="string">`loginpwd`</span>,<span class="string">`majorname`</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`student`</span> s</span><br><span class="line"><span class="keyword">JOIN</span> <span class="string">`major`</span> m <span class="keyword">ON</span> s.<span class="string">`majorid`</span>=m.<span class="string">`majorid`</span></span><br><span class="line"><span class="keyword">JOIN</span> <span class="string">`result`</span> r <span class="keyword">ON</span> s.<span class="string">`studentno`</span>=r.<span class="string">`studentno`</span></span><br><span class="line"><span class="keyword">WHERE</span> r.<span class="string">`score`</span>&gt;<span class="number">60</span>;</span><br></pre></td></tr></table></figure>

<p>建议用99写法，更加直观，可读性较高。</p>
<p>10、<strong>按邮箱位数分组，查询每组的学生个数</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*),<span class="keyword">LENGTH</span>(email)</span><br><span class="line"><span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">LENGTH</span>(email);</span><br></pre></td></tr></table></figure>

<p><strong>group by后面也可以接函数</strong>。</p>
<p>11、查询学生名、专业名、分数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">`studentname`</span>,<span class="string">`majorname`</span>,<span class="string">`score`</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`student`</span> s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="string">`major`</span> m <span class="keyword">ON</span> s.<span class="string">`majorid`</span>=m.<span class="string">`majorid`</span></span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="string">`result`</span> r <span class="keyword">ON</span> s.<span class="string">`studentno`</span>=r.<span class="string">`studentno`</span></span><br></pre></td></tr></table></figure>

<p>因为有的人分数为空，为了显示所有情况，使用左连接。</p>
<p>12、查询哪个专业没有学生，分别用左连接和右连接实现</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> m.<span class="string">`majorid`</span>,m.<span class="string">`majorname`</span>,s.<span class="string">`studentno`</span></span><br><span class="line"><span class="keyword">FROM</span> major m</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> student s</span><br><span class="line"><span class="keyword">ON</span> s.<span class="string">`majorid`</span>=m.<span class="string">`majorid`</span></span><br><span class="line"><span class="keyword">WHERE</span> s.<span class="string">`studentno`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>专业表为主表，为了显示没有学生即null的情况，需要使用左连接或者右连接（一个表有另一个没有），筛选条件为学生的主键为NULL。</p>
<p>13、查询没有成绩的学生人数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) 学生人数</span><br><span class="line"><span class="keyword">FROM</span> student s</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="string">`result`</span> r</span><br><span class="line"><span class="keyword">ON</span> s.<span class="string">`studentno`</span>=r.<span class="string">`studentno`</span></span><br><span class="line"><span class="keyword">WHERE</span> r.<span class="string">`id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>先将没有成绩学生查出来，即用左连接，学生为主表，筛选条件为成绩的主键为空，然后在此基础上统计人数。</p>
<h3 id="子查询经典案例"><a href="#子查询经典案例" class="headerlink" title="子查询经典案例"></a>子查询经典案例</h3><p>1、查询工资最低的员工信息：last_name，salary</p>
<p>步骤1：查询最低工资</p>
<p>步骤2：查询员工信息，要求salary=最低工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> salary=(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>2、查询平均工资最低的部门信息</p>
<p>方式一：</p>
<p>步骤1：查询各部门的平均工资</p>
<p>步骤2：查询最低的平均工资</p>
<p>步骤3：查询部门编号等于最低平均工资的</p>
<p>步骤4：查询此部门信息</p>
<p>过于麻烦和啰嗦</p>
<p>方式二：</p>
<p>步骤1：查询各部门的平均工资</p>
<p>步骤2：求出最低平均工资的部门编号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary)</span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>步骤3：查询部门信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span> department_id = (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary)</span><br><span class="line">	<span class="keyword">LIMIT</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>思路：在得到部门与平均工资表后，按照平均工资排序并只要最小的，得到部门编号，效率较高。</p>
<p>方式三：</p>
<p>步骤1：查询各部门的平均工资</p>
<p>步骤2：查询平均工资最低的部门信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) <span class="string">`平均工资`</span>,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">) avg_dep <span class="keyword">ON</span> d.department_id=avg_dep.department_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="string">`平均工资`</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>思路：得到表后与部门表连接，然后排序后选出1条，效率较低。</p>
<p>3、查询平均工资最低的部门信息和该部门的平均工资</p>
<p>查询出最低工资及部门编号的表，和部门表进行连接输出</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.*,ag</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) ag,department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary)</span><br><span class="line">	<span class="keyword">LIMIT</span> <span class="number">1</span></span><br><span class="line">) avg_dep </span><br><span class="line"><span class="keyword">ON</span> d.department_id=avg_dep.department_id;</span><br></pre></td></tr></table></figure>

<p>表子查询及连接的方式</p>
<p>4、查询平均工资最高的job信息</p>
<p>步骤1：查询每个job的平均工资（先排序，再limit）</p>
<p>步骤2：找到最高的平均工资的job_id</p>
<p>步骤3：得到此job信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> jobs</span><br><span class="line"><span class="keyword">WHERE</span> job_id = (</span><br><span class="line">	<span class="keyword">SELECT</span> job_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary) <span class="keyword">DESC</span></span><br><span class="line">	<span class="keyword">LIMIT</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>5、查询平均工资高于公司平均工资的部门有哪些</p>
<p>步骤1：查询公司平均工资</p>
<p>步骤2：查询每个部门的平均工资表，筛选条件为工资大于平均工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) ag,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> ag &gt;(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>6、查询出公司中所有manager的详细信息</p>
<p>方式一：</p>
<p>两个表自连接，输出m表的信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> m.*</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> employees m</span><br><span class="line"><span class="keyword">ON</span> e.manager_id=m.employee_id;</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<p>步骤1：查询出所有的manager_id</p>
<p>步骤2：查询员工信息，需要满足employee_id在步骤1的结果中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> *</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span>(</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>查询结果：自连接更快</p>
<p>7、各个部门中，最高工资中最低的那个部门的最低工资是多少 </p>
<p>步骤1：选出各个部门的最高工资</p>
<p>步骤2：找到最高工资最低的部门编号（order by,limit）</p>
<p>步骤3：得到id=步骤2的部门的最低工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id = (</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">MAX</span>(salary) <span class="keyword">ASC</span></span><br><span class="line">	<span class="keyword">LIMIT</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>8、查询平均工资最高的部门的manager的详细信息：last_name，department_id，email，salary</p>
<p>方法一：</p>
<p>步骤1：查询平均工资最高的部门Id</p>
<p>步骤2：在departments表中找到id=步骤1结果的manager_id</p>
<p>步骤3：查询em_id=步骤2结果中的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,department_id,email,salary</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id = (</span><br><span class="line">	<span class="keyword">SELECT</span> manager_id</span><br><span class="line">	<span class="keyword">FROM</span> departments</span><br><span class="line">	<span class="keyword">WHERE</span> department_id = (</span><br><span class="line">		<span class="keyword">SELECT</span> department_id</span><br><span class="line">		<span class="keyword">FROM</span> employees</span><br><span class="line">		<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">		<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary) <span class="keyword">DESC</span></span><br><span class="line">		<span class="keyword">LIMIT</span> <span class="number">1</span></span><br><span class="line">	)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>方法二：</p>
<p>步骤1：查询平均工资最高的部门Id</p>
<p>步骤2：将员工表和部门表进行连接，筛选条件为步骤1结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,d.department_id,email,salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.employee_id=d.manager_id</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id=(</span><br><span class="line">	<span class="keyword">SELECT</span> department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary) <span class="keyword">DESC</span></span><br><span class="line">	<span class="keyword">LIMIT</span> <span class="number">1</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>两表连接效率比较低，执行时间比方式一更长。</p>
<h3 id="进阶九：union联合查询"><a href="#进阶九：union联合查询" class="headerlink" title="进阶九：union联合查询"></a>进阶九：union联合查询</h3><p>union：联合，合并，将多条查询语句结果合成一个结果</p>
<p>引入案例：查询部门编号&gt;90或邮箱中包含a的员工信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id&gt;<span class="number">90</span> <span class="keyword">OR</span> email <span class="keyword">LIKE</span> <span class="string">'%a%'</span>;</span><br></pre></td></tr></table></figure>

<p>如果使用union</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id&gt;<span class="number">90</span> </span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">'%a%'</span>;</span><br></pre></td></tr></table></figure>

<p>语法：</p>
<p>查询语句1</p>
<p>union</p>
<p>查询语句2</p>
<p>union</p>
<p>…</p>
<p>应用场景：要查询的结果来自多个表，且多个表没有直接的连接关系，但查询的信息一致时</p>
<p>特点：</p>
<ol>
<li>要求多条查询语句的查询列数是一致的</li>
<li>要求多条查询语句的查询的每一列的类型和顺序最好是一致的</li>
<li>使用union关键字默认去重，如果使用<strong>union all</strong>可以包含重复项</li>
</ol>
<h3 id="查询总结"><a href="#查询总结" class="headerlink" title="查询总结"></a>查询总结</h3><p>select 查询列表                       7</p>
<p>from 表1 别名                         1</p>
<p>连接类型 join 表2 别名          2</p>
<p>on 连接条件                            3</p>
<p>where 筛选                             4</p>
<p>group by 分组列表                 5</p>
<p>having 筛选                            6</p>
<p>order by 排序列表                 8</p>
<p>limit offset,limit;                    9</p>
<p>group by和having别名使用相对较少。select *输出全部信息，但实际为了可读性，最好写完整对应列。</p>
<h2 id="DML语言"><a href="#DML语言" class="headerlink" title="DML语言"></a>DML语言</h2><p>数据操作语言</p>
<ul>
<li>插入：insert</li>
<li>修改：update</li>
<li>删除：delete</li>
</ul>
<h3 id="插入语句"><a href="#插入语句" class="headerlink" title="插入语句"></a>插入语句</h3><h4 id="方式一：经典插入"><a href="#方式一：经典插入" class="headerlink" title="方式一：经典插入"></a>方式一：经典插入</h4><p>语法：</p>
<p>insert into 表名(列名,…) values(值1,…),(值2,…),…;</p>
<p>1、插入的值的类型要与列的类型一致或兼容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(<span class="keyword">id</span>,<span class="keyword">NAME</span>,sex,borndate,phone,photo,boyfriend_id) </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">13</span>,<span class="string">'唐艺昕'</span>,<span class="string">'女'</span>,<span class="string">'1990-4-23'</span>,<span class="string">'18988888888'</span>,<span class="literal">NULL</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>如果插入数据是‘1234’也可以插入到int列中，可以隐式转换。</p>
<p>2、不可以为null的列必须插入值，可以为null的列如何插入值</p>
<p>方式一：值直接写null</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(<span class="keyword">id</span>,<span class="keyword">NAME</span>,sex,borndate,phone,photo,boyfriend_id) </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">13</span>,<span class="string">'唐艺昕'</span>,<span class="string">'女'</span>,<span class="string">'1990-4-23'</span>,<span class="string">'18988888888'</span>,<span class="literal">NULL</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>方式二：列和值均不写</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(<span class="keyword">id</span>,<span class="keyword">NAME</span>,sex,borndate,phone,boyfriend_id) </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">14</span>,<span class="string">'金星'</span>,<span class="string">'女'</span>,<span class="string">'1990-4-23'</span>,<span class="string">'13888888888'</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>photo列和值均被省略</p>
<p>3、列的顺序可以调换，但要一一对应</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(<span class="keyword">NAME</span>,sex,<span class="keyword">id</span>,phone)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">'蒋欣'</span>,<span class="string">'女'</span>,<span class="number">16</span>,<span class="string">'123'</span>);</span><br></pre></td></tr></table></figure>

<p>4、列数和值的个数必须一致</p>
<p>5、可以省略列名，默认所有列，而且列的顺序和表中的顺序一致</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">18</span>,<span class="string">'张飞'</span>,<span class="string">'男'</span>,<span class="literal">NULL</span>,<span class="string">'1212'</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>

<h4 id="方式二："><a href="#方式二：" class="headerlink" title="方式二："></a>方式二：</h4><p>语法：</p>
<p>insert into 表名</p>
<p>set 列名=值,列名=值,…</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">id</span>=<span class="number">19</span>,<span class="keyword">NAME</span>=<span class="string">'刘涛'</span>,phone=<span class="string">'9001'</span>;</span><br></pre></td></tr></table></figure>

<h4 id="两种方式比较"><a href="#两种方式比较" class="headerlink" title="两种方式比较"></a>两种方式比较</h4><p>1、方式一支持插入多行，方式二不支持</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(<span class="keyword">id</span>,<span class="keyword">NAME</span>,sex,borndate,phone,photo,boyfriend_id) </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">23</span>,<span class="string">'唐艺昕1'</span>,<span class="string">'女'</span>,<span class="string">'1990-4-23'</span>,<span class="string">'18988888888'</span>,<span class="literal">NULL</span>,<span class="number">2</span>)</span><br><span class="line">,(<span class="number">24</span>,<span class="string">'唐艺昕2'</span>,<span class="string">'女'</span>,<span class="string">'1990-4-23'</span>,<span class="string">'18988888888'</span>,<span class="literal">NULL</span>,<span class="number">2</span>)</span><br><span class="line">,(<span class="number">25</span>,<span class="string">'唐艺昕3'</span>,<span class="string">'女'</span>,<span class="string">'1990-4-23'</span>,<span class="string">'18988888888'</span>,<span class="literal">NULL</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<p>在values后用逗号隔开，然后加括号写要插入的值。</p>
<p>2、方式一支持子查询，方式二不支持</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(<span class="keyword">id</span>,<span class="keyword">NAME</span>,phone) </span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">26</span>,<span class="string">'宋茜'</span>,<span class="string">'183298'</span>;</span><br></pre></td></tr></table></figure>

<p>这样也可以实现插入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(<span class="keyword">id</span>,<span class="keyword">NAME</span>,phone) </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,boyname,<span class="string">'1423432'</span></span><br><span class="line"><span class="keyword">FROM</span> boys</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span>&lt;<span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h3 id="修改语句"><a href="#修改语句" class="headerlink" title="修改语句"></a>修改语句</h3><h4 id="修改单表的记录【重要】"><a href="#修改单表的记录【重要】" class="headerlink" title="修改单表的记录【重要】"></a>修改单表的记录【重要】</h4><p>语法：</p>
<p>update 表名</p>
<p>set 列=新值，列=新值,…</p>
<p>where 筛选条件;</p>
<p>案例1：修改beauty表中姓唐的女神电话为13888888888</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> beauty <span class="keyword">SET</span> phone=<span class="string">'13888888888'</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NAME</span> <span class="keyword">LIKE</span> <span class="string">'唐%'</span>;</span><br></pre></td></tr></table></figure>

<p>案例2：修改boys表中id号为2的名称为张飞，魅力值为10</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> boys <span class="keyword">SET</span> boyName=<span class="string">'张飞'</span>,userCp=<span class="number">10</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<h4 id="修改多表的记录【补充】"><a href="#修改多表的记录【补充】" class="headerlink" title="修改多表的记录【补充】"></a>修改多表的记录【补充】</h4><p>语法：</p>
<p>sql92语法</p>
<p>update 表1 别名，表2 别名</p>
<p>set 列=值,….</p>
<p>where 连接条件</p>
<p>and 筛选条件;</p>
<p>sql99语法</p>
<p><strong>update 表1 别名</strong></p>
<p><strong>inner|left|right|full join 表2 别名</strong></p>
<p><strong>on 连接条件</strong></p>
<p><strong>set 列=值,….</strong></p>
<p><strong>where 筛选条件;</strong></p>
<p>案例1：修改张无忌的女朋友的手机号为114</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> boys bo</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> beauty b</span><br><span class="line"><span class="keyword">ON</span> bo.<span class="string">`id`</span>=b.<span class="string">`boyfriend_id`</span></span><br><span class="line"><span class="keyword">SET</span> b.<span class="string">`phone`</span>=<span class="string">'114'</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`boyName`</span>=<span class="string">'张无忌'</span>;</span><br></pre></td></tr></table></figure>

<p>案例2：修改没有男朋友的女神的男朋友编号都为2号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> boys bo</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> beauty b</span><br><span class="line"><span class="keyword">ON</span> bo.<span class="string">`id`</span>=b.<span class="string">`boyfriend_id`</span></span><br><span class="line"><span class="keyword">SET</span> b.<span class="string">`boyfriend_id`</span>=<span class="number">2</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`id`</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>筛选条件为从表的主键为空</p>
<h3 id="删除语句"><a href="#删除语句" class="headerlink" title="删除语句"></a>删除语句</h3><p>方式一：delete</p>
<p>语法：</p>
<ol>
<li><p>单表的删除【重点】</p>
<p>delete from 表名【 where 筛选条件】【limit 条目数】</p>
<p>筛选条件是可选的，如果不写删除条件，就是删除整个表数据。</p>
</li>
<li><p>多表的删除【补充】</p>
<ul>
<li><p>sql92语法</p>
<p>delete 删除表的别名 【，表2的别名，…】</p>
<p>from 表1 别名，表2 别名</p>
<p>where 连接条件</p>
<p>and 筛选条件;</p>
</li>
<li><p>sql99语法</p>
<p>delete 表1的别名【,表2的别名】</p>
<p>from 表1 别名</p>
<p>inner|left|right join 表2 别名 on 连接条件</p>
<p>where 筛选条件;</p>
</li>
</ul>
</li>
</ol>
<p>方式二：truncate</p>
<p>语法：truncate table 表名</p>
<p>清空数据，不能加where，将表中信息全部删除</p>
<h4 id="方式一：delete"><a href="#方式一：delete" class="headerlink" title="方式一：delete"></a>方式一：delete</h4><p>1、单表的删除</p>
<p>案例：删除手机号以9结尾的女神信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> beauty <span class="keyword">WHERE</span> phone <span class="keyword">LIKE</span> <span class="string">'%9'</span>;</span><br></pre></td></tr></table></figure>

<p>delete 和from 之间不能加列，删除的是一整行的信息。</p>
<p>2、多表 的删除</p>
<p>案例1：删除张无忌的女朋友的信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除哪个表信息就delete那个表</span></span><br><span class="line"><span class="keyword">DELETE</span> b</span><br><span class="line"><span class="keyword">FROM</span> boys bo</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> beauty b <span class="keyword">ON</span> bo.<span class="string">`id`</span>=b.<span class="string">`boyfriend_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`boyName`</span>=<span class="string">'张无忌'</span>;</span><br></pre></td></tr></table></figure>

<p>案例2：删除黄晓明的信息及他女朋友的信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> bo,b</span><br><span class="line"><span class="keyword">FROM</span> beauty b</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> boys bo <span class="keyword">ON</span> b.<span class="string">`boyfriend_id`</span>=bo.<span class="string">`id`</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`boyName`</span>=<span class="string">'黄晓明'</span>;</span><br></pre></td></tr></table></figure>

<p>将要删除的表写在delete后面。</p>
<h4 id="方式二：truncate语句"><a href="#方式二：truncate语句" class="headerlink" title="方式二：truncate语句"></a>方式二：truncate语句</h4><p>案例：将魅力值&gt;100的男神信息删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> boys;</span><br></pre></td></tr></table></figure>

<p>不能加where筛选，只能把表全部删除。</p>
<h4 id="两种方式比较【面试题，重要】"><a href="#两种方式比较【面试题，重要】" class="headerlink" title="两种方式比较【面试题，重要】"></a>两种方式比较【面试题，重要】</h4><ol>
<li>delete 可以加where条件，truncate不能加</li>
<li>truncate删除，效率高一点</li>
<li>加入要删除的表中有自增长列，用<strong>delete</strong>删除后，再插入数据，<strong>自增长列的值从断点开始</strong>；而用<strong>truncate</strong>删除后，再插入数据，<strong>自增长列的值从1</strong>开始</li>
<li><strong>truncate</strong>删除<strong>没有返回值</strong>，<strong>delete</strong>删除<strong>有返回值</strong></li>
<li>truncate删除不能回滚，delete删除可以回滚</li>
</ol>
<h3 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h3><p>1、插入语法的两种方式</p>
<p>方式一：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> my_employees</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">'patel'</span>,<span class="string">'Ralph'</span>,<span class="string">'Rpatel'</span>,<span class="number">895</span>)</span><br><span class="line">,(<span class="number">2</span>,<span class="string">'Dancs'</span>,<span class="string">'Betty'</span>,<span class="string">'Bdancs'</span>,<span class="number">860</span>)</span><br><span class="line">,(<span class="number">3</span>,<span class="string">'Biri'</span>,<span class="string">'Ben'</span>,<span class="string">'Bbiri'</span>,<span class="number">1100</span>)</span><br><span class="line">,(<span class="number">4</span>,<span class="string">'Newman'</span>,<span class="string">'Chad'</span>,<span class="string">'Cnewman'</span>,<span class="number">750</span>)</span><br><span class="line">,(<span class="number">5</span>,<span class="string">'Ropeburn'</span>,<span class="string">'Audrey'</span>,<span class="string">'Aropebur'</span>,<span class="number">1550</span>);</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> my_employees</span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span>,<span class="string">'patel'</span>,<span class="string">'Ralph'</span>,<span class="string">'Rpatel'</span>,<span class="number">895</span> <span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">2</span>,<span class="string">'Dancs'</span>,<span class="string">'Betty'</span>,<span class="string">'Bdancs'</span>,<span class="number">860</span> <span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">3</span>,<span class="string">'Biri'</span>,<span class="string">'Ben'</span>,<span class="string">'Bbiri'</span>,<span class="number">1100</span> <span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">4</span>,<span class="string">'Newman'</span>,<span class="string">'Chad'</span>,<span class="string">'Cnewman'</span>,<span class="number">750</span> <span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">5</span>,<span class="string">'Ropeburn'</span>,<span class="string">'Audrey'</span>,<span class="string">'Aropebur'</span>,<span class="number">1550</span>;</span><br></pre></td></tr></table></figure>

<p>insert into后面可以跟select语句，利用union将多条select语句变为一条，最后一个select后不用加union。</p>
<p>2、将3号员工的last_name修改为“drelxer”</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> my_employees</span><br><span class="line"><span class="keyword">SET</span> Last_name=<span class="string">'drelxer'</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>3、将userid 为Bbiri的user表和my_employees表的记录全部删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> my,us</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">users</span> us</span><br><span class="line"><span class="keyword">JOIN</span> my_employees my <span class="keyword">ON</span> us.<span class="string">`userid`</span>=my.<span class="string">`Userid`</span></span><br><span class="line"><span class="keyword">WHERE</span> us.<span class="string">`userid`</span>=<span class="string">'Bbiri'</span>;</span><br></pre></td></tr></table></figure>

<p>4、检查表所做的修正</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> my_employees;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span>;</span><br></pre></td></tr></table></figure>

<h2 id="DDL语言"><a href="#DDL语言" class="headerlink" title="DDL语言"></a>DDL语言</h2><p>数据定义语言，库和表的管理</p>
<p>1、库的管理</p>
<p>创建、修改、删除</p>
<p>2、表的管理</p>
<p>创建、修改、删除</p>
<p>与数据操作语言区分，这里管理的是表的结构，而不是数据</p>
<ul>
<li>创建：create</li>
<li>修改：alter</li>
<li>删除：drop</li>
</ul>
<h3 id="库的管理"><a href="#库的管理" class="headerlink" title="库的管理"></a>库的管理</h3><h4 id="库的创建"><a href="#库的创建" class="headerlink" title="库的创建"></a>库的创建</h4><p>语法：</p>
<p>create database 【if not exsits】库名 【character set 字符集名】;</p>
<p>案例：创建库books</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> books;</span><br></pre></td></tr></table></figure>

<p>但是这样创建完成后，再次执行会报错，采用下面语句提高语句容错性</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> books;</span><br></pre></td></tr></table></figure>

<h4 id="库的修改"><a href="#库的修改" class="headerlink" title="库的修改"></a>库的修改</h4><p><strong>基本不修改</strong></p>
<p>库名不能使用sql语句去修改</p>
<p>可以更改库的字符集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> books <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> gbk;</span><br></pre></td></tr></table></figure>

<h4 id="库的删除"><a href="#库的删除" class="headerlink" title="库的删除"></a>库的删除</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> books;</span><br></pre></td></tr></table></figure>

<p>存在才删除</p>
<h3 id="表的管理"><a href="#表的管理" class="headerlink" title="表的管理"></a>表的管理</h3><h4 id="表的创建【重要】"><a href="#表的创建【重要】" class="headerlink" title="表的创建【重要】"></a>表的创建【重要】</h4><p>create table 【if not exists】表名(</p>
<p>​    列名 列的类型【（长度）约束】，</p>
<p>​    列名 列的类型【（长度）约束】，</p>
<p>​    ….</p>
<p>​    列名 列的类型【（长度）约束】</p>
<p>);</p>
<p>案例：创建表book</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span>,<span class="comment">#编号</span></span><br><span class="line">	bName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="comment">#书名</span></span><br><span class="line">	price <span class="keyword">DOUBLE</span>,<span class="comment">#价格</span></span><br><span class="line">	authorId <span class="built_in">INT</span>,<span class="comment">#作者编号</span></span><br><span class="line">	publishDate DATETIME<span class="comment">#出版日期</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>不同字段用逗号隔开，最后个不用加逗号。</p>
<h4 id="表的修改"><a href="#表的修改" class="headerlink" title="表的修改"></a>表的修改</h4><p><strong>alter table 表名 add|drop|modify|change column 列名 【列类型 约束】;</strong></p>
<p>1、修改列名</p>
<p>alter table 表名 change column 旧列名 新列名 新列名类型</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">CHANGE</span> <span class="keyword">COLUMN</span> publishDate pubDate DATETIME;</span><br></pre></td></tr></table></figure>

<p>change column要求加上新的列名和类型。column可以省略。</p>
<p>2、修改列的类型或约束</p>
<p>alter table 表名 modify column 列名 新类型 【新约束】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> pubDate <span class="built_in">TIMESTAMP</span> 【新约束】;</span><br></pre></td></tr></table></figure>

<p>用到的为modify。</p>
<p>3、添加新列</p>
<p>默认添加在最后列，可以自己指定位置。在最开头，使用first，在某个字段后面，使用after字段名。</p>
<p>alter table 表名 add column 列名 类型 【first|after 字段名】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> author <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> annual <span class="keyword">DOUBLE</span> 【<span class="keyword">first</span>|<span class="keyword">after</span> 字段名】;</span><br></pre></td></tr></table></figure>

<p>用到的为add。同样需要加上类型。</p>
<p>4、删除列</p>
<p>alter table 表名 drop column 列名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> book <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> annual;</span><br></pre></td></tr></table></figure>

<p>用到的为drop，这时候就不需要指定类型了。</p>
<p>5、修改表名</p>
<p>alter table 表名 rename 【to】新表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> author <span class="keyword">RENAME</span> <span class="keyword">TO</span> book_author;</span><br></pre></td></tr></table></figure>

<h4 id="表的删除"><a href="#表的删除" class="headerlink" title="表的删除"></a>表的删除</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> 【<span class="keyword">IF</span> <span class="keyword">EXISTS</span>】 book_author;</span><br></pre></td></tr></table></figure>

<p>通用写法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> 旧库名;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> 新库名;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> 旧库名;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名();</span><br></pre></td></tr></table></figure>

<h4 id="表的复制"><a href="#表的复制" class="headerlink" title="表的复制"></a>表的复制</h4><p>1、仅复制表的结构</p>
<p>create table 表名 like 旧表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> copy <span class="keyword">LIKE</span> author;</span><br></pre></td></tr></table></figure>

<p>没有复制内容。</p>
<p>2、复制表的结构+数据</p>
<p>create table 表名</p>
<p>select 查询列表 from 表 【where 筛选】</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> copy2 </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> author;</span><br></pre></td></tr></table></figure>

<p>后面跟select查询语句</p>
<p>复制部门数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> copy3</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,au_name</span><br><span class="line"><span class="keyword">FROM</span> author</span><br><span class="line"><span class="keyword">WHERE</span> nation=<span class="string">'中国'</span>;</span><br></pre></td></tr></table></figure>

<p>仅复制某些字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> copy4</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span>,au_name</span><br><span class="line"><span class="keyword">FROM</span> author</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>利用where 0来获取数据。</p>
<h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p>1、将其他库中的表信息复制进当前库中的表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept2</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">`department_id`</span>,<span class="string">`department_name`</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`myemployees`</span>.<span class="string">`departments`</span>;</span><br></pre></td></tr></table></figure>

<p>使用库名.表名来进行调用。利用create后面+select子查询。</p>
<p>2、复制其他库中表的结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employees2 <span class="keyword">LIKE</span> <span class="string">`myemployees`</span>.employees;</span><br></pre></td></tr></table></figure>

<p>3、删除表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> emp5;</span><br></pre></td></tr></table></figure>

<h3 id="常见的数据类型"><a href="#常见的数据类型" class="headerlink" title="常见的数据类型"></a>常见的数据类型</h3><ul>
<li>数值型<ul>
<li>整数</li>
<li>小数<ul>
<li>定点数</li>
<li>浮点数</li>
</ul>
</li>
</ul>
</li>
<li>字符型<ul>
<li>较短的文本：char,varchar</li>
<li>较长的文本：text，blob（较长的二进制数据）</li>
</ul>
</li>
<li>日期型</li>
</ul>
<h4 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h4><p>所选择的类型越简单越好，能保存数值的类型越小越好</p>
<h4 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h4><p>分类：</p>
<p>tinyint（1字节）、smallint（2字节）、mediumint（3字节）、int/integer（4字节）、bigint（8字节）</p>
<p>特点：</p>
<ol>
<li><p>如果不设置有符号还是无符号，默认是有符号，如果要设置无符号，加上关键字unsigned</p>
</li>
<li><p>如果插入的数值超出了整形的范围，会报out of range异常，并且插入临界值</p>
<p>临界值为对应允许范围内最接近插入值的值如果tinyint范围是-128-127，插入-129，存入-128；插入128，存入127</p>
</li>
<li><p>如果不设置长度，会有默认长度</p>
<p>宽度效果为：如果数据长度没有达到指定长度，则在左方用0补齐，需要搭配关键字<strong>zerofill</strong>使用，此时整形默认变为<strong>无符号</strong>类型</p>
</li>
</ol>
<p>1、设置无符号和有符号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_int (</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">	id2 <span class="built_in">INT</span> <span class="keyword">UNSIGNED</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="小数"><a href="#小数" class="headerlink" title="小数"></a>小数</h4><p>分类</p>
<ol>
<li>浮点型<ul>
<li>float(M,D)  4字节</li>
<li>double(M,D) 8字节</li>
</ul>
</li>
<li>定点型<ul>
<li>dec(M,D)  M+2字节，最大取值范围与double相同</li>
<li>decimal(M,D)</li>
</ul>
</li>
</ol>
<p>特点：</p>
<ol>
<li><p>M：整数部位+小数部位的总长度</p>
<p>D：小数部位</p>
<p>如果超过范围，则插入临界值</p>
</li>
<li><p>M和D都可以省略</p>
<p>如果是decimal，则M默认是10，D默认是0</p>
<p>如果是float和double，则会根据插入数值的精度来决定精度</p>
</li>
<li><p>定点型的精确度较高，如果要求插入数值的精度较高，如货币运算则考虑使用</p>
</li>
</ol>
<h4 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h4><p>分类：</p>
<p>较短的文本：char、varchar</p>
<p>其他：</p>
<p>binary和varbiary用于保存较短的二进制</p>
<p>enum用于保存枚举</p>
<p>set用于保存集合</p>
<p>较长的文本：text、blob（较大的二进制数据）</p>
<p>特点：</p>
<h5 id="char和varchar类型【重要】"><a href="#char和varchar类型【重要】" class="headerlink" title="char和varchar类型【重要】"></a>char和varchar类型【重要】</h5><table>
<thead>
<tr>
<th>字符串类型</th>
<th>最多字符数</th>
<th>描述及存储需求</th>
<th>空间耗费</th>
<th>效率</th>
</tr>
</thead>
<tbody><tr>
<td>char(M)</td>
<td>M，可以省略，默认为1</td>
<td>M为0-255之间的整数</td>
<td>固定长度字符，比较耗费空间</td>
<td>高</td>
</tr>
<tr>
<td>varchar(M)</td>
<td>M，不可省略</td>
<td>M为0-65535之间的整数</td>
<td>可变长度字符，比较节省空间</td>
<td>低</td>
</tr>
</tbody></table>
<p>M为字符，一个汉字或者一个英文字符均为1字符。char固定长度，代表所有字符均用统一长度存储；varchar可变长度，代表存储长度随数据具体情况而变化。如果字符长度较为固定，用char，如性别；如果字符长度变化较大，用varchar，如姓名。</p>
<h5 id="binary和varbinary类型"><a href="#binary和varbinary类型" class="headerlink" title="binary和varbinary类型"></a>binary和varbinary类型</h5><p>类似于char和varchar，不同的是它们包含二进制字符串而不包含非二进制字符串</p>
<h5 id="Enum类型"><a href="#Enum类型" class="headerlink" title="Enum类型"></a>Enum类型</h5><p>枚举类型，要求插入的值必须属于列表中指定的值之一。如果列表成员为1~255，则需要1个字节存储，如果列表成员为255-65535，则需要2个字节存储，最多需要65535个成员！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c1 Enum('a','b','c');</span><br></pre></td></tr></table></figure>

<p>如果插入为对应的大写，保存为小写。如果插入类型不在枚举类型中，插入为空。</p>
<h5 id="Set类型"><a href="#Set类型" class="headerlink" title="Set类型"></a>Set类型</h5><p>说明：和ENUM类型类似，里面可以保存0~64个成员。和ENUM类型最大的区别是：SET类型一次可以选<strong>取多个成员</strong>，而ENUM只能选一个<br>根据成员个数不同，存储所占的字节也不同</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s1 <span class="keyword">SET</span>(<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_set <span class="keyword">values</span>(<span class="string">'a,b,c'</span>)</span><br></pre></td></tr></table></figure>

<p>同样不区分大小写。</p>
<h4 id="日期型"><a href="#日期型" class="headerlink" title="日期型"></a>日期型</h4><p>分类：</p>
<p>date 只保存日期</p>
<p>time 只保存时间</p>
<p>year 只保存年</p>
<p>datetime 保存日期+时间</p>
<p>timestamp 保存日期+时间</p>
<p>特点：</p>
<table>
<thead>
<tr>
<th></th>
<th>字节</th>
<th>范围</th>
<th>时区的影响</th>
</tr>
</thead>
<tbody><tr>
<td>datetime</td>
<td>8</td>
<td>1000-9999</td>
<td>不受</td>
</tr>
<tr>
<td>timestamp</td>
<td>4</td>
<td>1970-2038</td>
<td>受</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>日期和时间类型</th>
<th>字节</th>
<th>最小值</th>
<th>最大值</th>
</tr>
</thead>
<tbody><tr>
<td>date</td>
<td>4</td>
<td>1000-01-01</td>
<td>9999-12-31</td>
</tr>
<tr>
<td>datetime</td>
<td>8</td>
<td>1000-01-01 00:00:00</td>
<td>9999-12-31 23:59:59</td>
</tr>
<tr>
<td>timestam</td>
<td>4</td>
<td>19700101080001</td>
<td>2038年的某个时刻</td>
</tr>
<tr>
<td>time</td>
<td>3</td>
<td>-838:59:59</td>
<td>838:59:59</td>
</tr>
<tr>
<td>year</td>
<td>1</td>
<td>1901</td>
<td>2155</td>
</tr>
</tbody></table>
<p>重点为datatime和timestam。</p>
<h5 id="datetime和timestamp区别"><a href="#datetime和timestamp区别" class="headerlink" title="datetime和timestamp区别"></a>datetime和timestamp区别</h5><p>1、<strong>Timestamp</strong>支持的时间<strong>范围较小</strong>，取值范围：<br>    19700101080001——2038年的某个时间<br>    Datetime的取值范围：1000-1-1 ——9999-12-31<br>2、timestamp和<strong>实际时区</strong>有关，更能反映<strong>实际的日期</strong>，而datetime则只能反映出<strong>插入时的当地时区</strong><br>3、timestamp的属性受Mysql版本和SQLMode的影响很大</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_date(</span><br><span class="line">	t1 DATETIME,</span><br><span class="line">	t2 <span class="built_in">TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_date <span class="keyword">VALUES</span>(<span class="keyword">NOW</span>(),<span class="keyword">NOW</span>());</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> tab_date;</span><br></pre></td></tr></table></figure>

<p>这时候出来结果相同，但是当更改时区后</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">time_zone</span>=<span class="string">'+9:00'</span>;<span class="comment">#从东八更改为东九</span></span><br></pre></td></tr></table></figure>

<p>这时候，timestamp类型数据存储的时间比datetime存储的时间快一个小时，随着时区而变化了。</p>
<h3 id="常见约束"><a href="#常见约束" class="headerlink" title="常见约束"></a>常见约束</h3><p>含义：一种限制，用于限制表中的数据，为了保证表中数据的准确和可靠性</p>
<p>分类：六大约束</p>
<ul>
<li><p>NOT NULL：非空，用于保证该字段的值不能为空</p>
<p>如姓名，学号等</p>
</li>
<li><p>DEFAULT：默认，用于保证该字段有默认值</p>
<p>如性别</p>
</li>
<li><p>PRIMARY KEY：主键，用于保证该字段的值有<strong>唯一性</strong>，且要<strong>非空</strong></p>
<p>如学号，员工编号等，可以多个列组合成一个主键</p>
<p>primary key(id,stuname)，插入值要求不能所有组成主键的列相同</p>
</li>
<li><p>UNIQUE：唯一，用于保证该字段的值具有唯一性，可以为空</p>
<p>如座位号，但<strong>最多只能有一个为空</strong></p>
</li>
<li><p>CHECK：检查约束【mysql不支持】</p>
<p>比如年龄，性别</p>
</li>
<li><p>FOREIGN KEY：外键，用于限制两个表的关系，用于保证该字段的值必须来自于主表的关联列的值</p>
<p>在从表添加外键约束，用于引用主表中某列的值</p>
<p>如专业编号，员工表的部门编号，员工表的工种编号</p>
</li>
</ul>
<p><strong>一个字段可以添加多个约束，用空格隔开，无顺序要求</strong></p>
<p>添加约束的时机：</p>
<ol>
<li>创建表时</li>
<li>修改表时</li>
</ol>
<p>约束的添加分类：</p>
<ol>
<li><p>列级约束</p>
<p>六大约束语法上都支持，但外键约束没有效果</p>
</li>
<li><p>表级约束</p>
<p>除了<strong>非空</strong>，<strong>默认</strong>，其他都支持</p>
</li>
</ol>
<p>CREATE TABLE 表名(</p>
<p>​    字段名 字段类型 列级约束，</p>
<p>​    字段名 字段类型，</p>
<p>​    表级约束</p>
<p>)</p>
<h4 id="列级约束与表级约束"><a href="#列级约束与表级约束" class="headerlink" title="列级约束与表级约束"></a>列级约束与表级约束</h4><table>
<thead>
<tr>
<th></th>
<th>位置</th>
<th>支持的约束类型</th>
<th>是否可以起约束名</th>
</tr>
</thead>
<tbody><tr>
<td>列级约束</td>
<td>列的后面</td>
<td>语法都支持，但外键没有效果</td>
<td>不可以</td>
</tr>
<tr>
<td>表级约束</td>
<td>所有列下面</td>
<td>默认和非空不支持，其他支持</td>
<td>可以（对主键没有效果）</td>
</tr>
</tbody></table>
<h4 id="主键和唯一的对比【面试考-，重要】"><a href="#主键和唯一的对比【面试考-，重要】" class="headerlink" title="主键和唯一的对比【面试考 ，重要】"></a>主键和唯一的对比【面试考 ，重要】</h4><table>
<thead>
<tr>
<th></th>
<th>保证唯一性</th>
<th>是否允许为空</th>
<th>一个表中可以有多少个</th>
<th>是否允许组合</th>
</tr>
</thead>
<tbody><tr>
<td>主键</td>
<td>是</td>
<td>否</td>
<td>至多有1个</td>
<td>是，但不推荐</td>
</tr>
<tr>
<td>唯一</td>
<td>是</td>
<td>是，但最多一个为空</td>
<td>可以有多个</td>
<td>是，但不推荐</td>
</tr>
</tbody></table>
<h4 id="外键"><a href="#外键" class="headerlink" title="外键"></a>外键</h4><ol>
<li>要求在从表设置外键关系</li>
<li>从表的外键列的类型和主表的关联列的类型要求一致或兼容，名称无要求</li>
<li>主表的关联列<strong>必须是一个key</strong>（一般是<strong>主键</strong>或唯一）</li>
<li>插入数据时，先插入主表，再插入从表</li>
<li>删除数据时，先删除从表，再删除主表</li>
</ol>
<p>可通过以下两种方式删除主表的记录</p>
<p>方式一：级联删除</p>
<p>一般直接删除主表的信息不行因为要先删除从表，但加上级联删除后，直接删除主表信息后，从表信息也会被删除。</p>
<p>在添加外键的约束后加上on delete cascade</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stuinfo <span class="keyword">add</span> <span class="keyword">constraint</span> fk_stu_major <span class="keyword">foreign</span> <span class="keyword">key</span>(majorid) <span class="keyword">references</span> major(<span class="keyword">id</span>) <span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">cascade</span>;</span><br></pre></td></tr></table></figure>

<p>方式二：级联置空</p>
<p>如果不想删除主表信息时从表信息也被删除，就是用级联置空，主表信息被删除后，从表相应位置信息置空</p>
<p>在添加外键的约束后加上on delete set null</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> stuinfo <span class="keyword">add</span> <span class="keyword">constraint</span> fk_stu_major <span class="keyword">foreign</span> <span class="keyword">key</span>(majorid) <span class="keyword">references</span> major(<span class="keyword">id</span>) <span class="keyword">on</span> <span class="keyword">delete</span> <span class="keyword">set</span> <span class="literal">null</span></span><br></pre></td></tr></table></figure>

<h4 id="创建表时添加约束"><a href="#创建表时添加约束" class="headerlink" title="创建表时添加约束"></a>创建表时添加约束</h4><p>1、添加列级约束</p>
<p>语法：</p>
<p>直接在字段名和类型后面追加约束类型即可</p>
<p>只支持：主键、唯一、默认、非空</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stuinfo(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,<span class="comment">#主键</span></span><br><span class="line">	stuName <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,<span class="comment">#非空</span></span><br><span class="line">	gender <span class="built_in">CHAR</span>(<span class="number">1</span>) <span class="keyword">CHECK</span>(gender <span class="keyword">IN</span> (<span class="string">'男'</span>,<span class="string">'女'</span>)),<span class="comment">#检查</span></span><br><span class="line">	seat <span class="built_in">INT</span> <span class="keyword">UNIQUE</span>,<span class="comment">#唯一</span></span><br><span class="line">	age <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">18</span>,<span class="comment">#默认约束</span></span><br><span class="line">	majorId <span class="built_in">INT</span> <span class="keyword">REFERENCES</span> major(<span class="keyword">id</span>)<span class="comment">#外键</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>外键在列级约束时没有用</strong>。主键，外键，唯一键自动生成索引，使用下面语句查看索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> stuinfo;</span><br></pre></td></tr></table></figure>

<p>2、添加表级约束</p>
<p>语法：在各个字段的最下面，constraint 约束名可省略</p>
<p>【constraint 约束名】 约束类型（字段名）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stuinfo(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">	stuName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	gender <span class="built_in">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">	seat <span class="built_in">INT</span>,</span><br><span class="line">	age <span class="built_in">INT</span>,</span><br><span class="line">	majorId <span class="built_in">INT</span>,</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">CONSTRAINT</span> pk PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>),<span class="comment">#主键</span></span><br><span class="line">	<span class="keyword">CONSTRAINT</span> uk <span class="keyword">UNIQUE</span>(seat),<span class="comment">#唯一键</span></span><br><span class="line">	<span class="keyword">CONSTRAINT</span> ck <span class="keyword">CHECK</span>(gender <span class="keyword">IN</span> (<span class="string">'男'</span>,<span class="string">'女'</span>)),<span class="comment">#检查</span></span><br><span class="line">	<span class="keyword">CONSTRAINT</span> fk_stuinfo_major <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(majorid) <span class="keyword">REFERENCES</span> major(<span class="keyword">id</span>)<span class="comment">#外键</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>主键名是默认的，改了没有效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">外键名一般为fk_当前表名_主键名</span><br></pre></td></tr></table></figure>

<p>通用写法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> stuinfo(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">	stuname <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	gender <span class="built_in">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">	age <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">18</span>,</span><br><span class="line">	seat <span class="built_in">INT</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">	majorid <span class="built_in">INT</span>,</span><br><span class="line">	<span class="keyword">CONSTRAINT</span> fk_stuinfo_major <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(majorid) <span class="keyword">REFERENCES</span> major(<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="修改表时添加约束"><a href="#修改表时添加约束" class="headerlink" title="修改表时添加约束"></a>修改表时添加约束</h4><p>总结：</p>
<p>1、添加列级约束</p>
<p>alter table 表名 <strong>modify column</strong> 字段名 字段类型 新约束；</p>
<p>2、添加表级约束</p>
<p>alter table 表名 <strong>add</strong> 【constraint 约束名】 约束类型（字段名）【外键的引用】；</p>
<p>1、添加非空约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> stuname <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>2、添加默认约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> age <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">18</span>;</span><br></pre></td></tr></table></figure>

<p>3、添加主键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、列级约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>;</span><br><span class="line"><span class="comment">#2、表级约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure>

<p>4、添加唯一键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、列级约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> seat <span class="built_in">INT</span> <span class="keyword">UNIQUE</span>;</span><br><span class="line"><span class="comment">#2、表级约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span>(seat);</span><br></pre></td></tr></table></figure>

<p>5、添加外键</p>
<p>关键词为ADD，只有表级约束才有效果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(majorid) <span class="keyword">REFERENCES</span> major(<span class="keyword">id</span>);</span><br></pre></td></tr></table></figure>

<h4 id="修改表时删除约束"><a href="#修改表时删除约束" class="headerlink" title="修改表时删除约束"></a>修改表时删除约束</h4><p>1、删除非空约束</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> stuname <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>

<p>2、删除默认约束</p>
<p>不加约束即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">MODIFY</span> <span class="keyword">COLUMN</span> age <span class="built_in">INT</span>;</span><br></pre></td></tr></table></figure>

<p>3、删除主键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>;</span><br></pre></td></tr></table></figure>

<p>4、删除唯一</p>
<p>drop index 唯一键名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">DROP</span> <span class="keyword">INDEX</span> seat;</span><br></pre></td></tr></table></figure>

<p>5、删除外键</p>
<p>drop foreign key 外键名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> stuinfo <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> fk_stuinfo_major;</span><br></pre></td></tr></table></figure>

<h3 id="标识列"><a href="#标识列" class="headerlink" title="标识列"></a>标识列</h3><p>又称为自增长列，关键字为auto_increament</p>
<p>含义：可以<strong>不用手动的插入值</strong>，系统提供默认的序列值，默认从1开始，步长为1</p>
<p>特点：</p>
<ol>
<li><p>标识列必须和<strong>key搭配</strong></p>
</li>
<li><p>一个表中<strong>至多</strong>有一个标识列</p>
</li>
<li><p>标识列的类型只能是<strong>数值型</strong></p>
</li>
<li><p>标识列可以通过SET auto_increment_increment=2;设置步长</p>
<p>可以通过手动插入值，设置起始值</p>
</li>
</ol>
<p>一、创建表时设置标识列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tab_identity(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT,</span><br><span class="line">	<span class="keyword">NAME</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> tab_identity <span class="keyword">VALUES</span>(<span class="literal">NULL</span>,<span class="string">'john'</span>);</span><br></pre></td></tr></table></figure>

<p>可以设置自增长的步长，一般不会改</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%auto_increment%'</span>;</span><br><span class="line"><span class="keyword">SET</span> auto_increment_increment=<span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>二、修改表时设置标识列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tab_identity <span class="keyword">MODIFY</span> <span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT;</span><br></pre></td></tr></table></figure>

<p>三、修改表时删除标识列</p>
<p>去掉自增长列标识即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tab_identity <span class="keyword">MODIFY</span> <span class="keyword">id</span> <span class="built_in">INT</span>;</span><br></pre></td></tr></table></figure>

<h2 id="TCL语言"><a href="#TCL语言" class="headerlink" title="TCL语言"></a>TCL语言</h2><p>Transaction Control Language 事务控制语言</p>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>事务：</p>
<p>一个或一组sql语句组成一个执行单元，这个执行单元要么全部执行，要么全部不执行。每个sql语句是相互依赖的。整个单独单元作为一个不可分割的整体，如果单元中某条sql语句一旦执行失败或产生错误，整个单元将会回滚。所有受到影响的数据将返回到事务开始以前的状态；如果单元中的所有sql语句均执行成功，则事务被顺利执行。</p>
<h4 id="了解存储引擎"><a href="#了解存储引擎" class="headerlink" title="了解存储引擎"></a>了解存储引擎</h4><p>1、概念：在mysql中的数据用各种不同的技术存储在文件（或内存）中。</p>
<p>2、通过show engines;来查看mysql支持的存储引擎</p>
<p>3、在mysql中用的最多的存储引擎有：innodb，myisam，memory等。其中innodb支持事务，而myisam，memory等不支持事务</p>
<h4 id="事务的ACID（acid）属性【重要】"><a href="#事务的ACID（acid）属性【重要】" class="headerlink" title="事务的ACID（acid）属性【重要】"></a>事务的ACID（acid）属性【重要】</h4><p>事务的特性：</p>
<ol>
<li><p><strong>原子性</strong>（Atomicity）</p>
<p>原子性指事务是一个<strong>不可分割</strong>的工作单位，事务中的操作要么都发生，要么都不发生</p>
</li>
<li><p><strong>一致性</strong>（Consistency）</p>
<p>事务必须使数据库从一个一致性状态变换到另外一个一致性状态，保证数据的可靠性</p>
<p>数据要准确，可靠    </p>
</li>
<li><p><strong>隔离性</strong>（Isolation）</p>
<p>事务的隔离性是指一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。类似于锁？</p>
</li>
<li><p><strong>持久性</strong>（Durability）</p>
<p>持久性指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来的其他操作和数据库故障不应该对其有任何影响</p>
</li>
</ol>
<h4 id="事务的创建"><a href="#事务的创建" class="headerlink" title="事务的创建"></a>事务的创建</h4><p><strong>隐式事务</strong>：事务没有明显的开启和结束的标记</p>
<p>比如insert、update、delete语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表 <span class="keyword">where</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p><strong>显式事务</strong>：事务具有明显的开启和结束的标记</p>
<p>前提：必须先设置自动提交功能为禁用</p>
<p>只针对当前会话有效</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'%autocommit'</span>;</span><br><span class="line"><span class="keyword">SET</span> autocommit=<span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>步骤1：开启事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> autocommit=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;<span class="comment">#可选的</span></span><br></pre></td></tr></table></figure>

<p>步骤2：编写事务中的sql语句（<strong>select insert update delete</strong>）</p>
<p>语句1；</p>
<p>语句2；</p>
<p>…</p>
<p>【设置回滚点：</p>
<p>savepoint 回滚点名;】</p>
<p>步骤3：结束事务</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">commit</span>;提交事务</span><br><span class="line"><span class="keyword">rollback</span>;回滚事务</span><br><span class="line">[回滚到指定的地方：<span class="keyword">rollback</span> <span class="keyword">to</span> 回滚点名;]</span><br></pre></td></tr></table></figure>

<p>savepoint 节点名;#设置保存点</p>
<h5 id="演示事务的使用步骤"><a href="#演示事务的使用步骤" class="headerlink" title="演示事务的使用步骤"></a>演示事务的使用步骤</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、开启事务</span></span><br><span class="line"><span class="keyword">SET</span> autocommit=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="comment">#2、编写sql语句</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">account</span> <span class="keyword">SET</span> balance = <span class="number">500</span> <span class="keyword">WHERE</span> username=<span class="string">'张无忌'</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">account</span> <span class="keyword">SET</span> balance = <span class="number">1500</span> <span class="keyword">WHERE</span> username=<span class="string">'赵敏'</span>;</span><br><span class="line"><span class="comment">#3、结束事务</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>如果使用commit，可以正常修改数据，如果使用的是rollback，那么对数据没有影响</p>
<h3 id="并发事务【重要】"><a href="#并发事务【重要】" class="headerlink" title="并发事务【重要】"></a>并发事务【重要】</h3><p>对于同时运行的<strong>多个事务</strong>，当这些事务访问<strong>数据库中相同的数据</strong>时，如果没有采取必要的隔离机制，就会导致各种并发问题： </p>
<ul>
<li><strong>脏读</strong>：对于两个事务T1、T2，T1读取了已经被T2更新但<strong>还没有提交</strong>的字段，之后若T2回滚，T1读取的内容就是<strong>临时且无效</strong>的</li>
<li><strong>不可重复读</strong>：对于两个事务T1、T2，T1读取了一个字段，然后T2更新了该字段，之后T1再次读取同一个字段，值就不同了</li>
<li><strong>幻读</strong>：对于两个事务T1、T2，T1从一个表中读取了一个字段，然后T2在该表中<strong>插入</strong>了一些新的行，之后如果T1再次读取同一个表，就会多出几行</li>
</ul>
<p>脏读与幻读相对比，脏读侧重于字段的<strong>更新</strong>，幻读侧重于行的<strong>插入</strong>。</p>
<h4 id="解决并发问题【重要】"><a href="#解决并发问题【重要】" class="headerlink" title="解决并发问题【重要】"></a>解决并发问题【重要】</h4><p><strong>数据库的隔离级别</strong>：数据库系统必须具有隔离并发运行各个事务的能力，使它们不会相互影响，避免各种并发问题</p>
<p>数据库提供的4种事务隔离级别</p>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED（读未提交数据）</td>
<td>允许事务读取未被其他事务提交的变更，<strong>脏读、不可重复度和幻读</strong>的问题都会出现</td>
</tr>
<tr>
<td>READ COMMITTED（读已提交数据）</td>
<td>只允许事务读取已经被其他事务提交的变更，可以避免脏读，但<strong>不可重复读和幻读</strong>问题仍可能出现</td>
</tr>
<tr>
<td>REPEATABLE READ（可重复读）</td>
<td>确保事务可以多次从一个字段中读取相同的值，在这个事务持续期间，禁止其他事务对这个字段进行更新，可以避免脏读和不可重复读，但<strong>幻读</strong>的问题仍然存在</td>
</tr>
<tr>
<td>SERIALIZABLE（串行化）</td>
<td>确保事务可以从一个表中读取相同的行，在这个事务持续期间，禁止其他事务对该表执行插入，更新和删除操作，所有并发问题都可以避免，但性能十分低下</td>
</tr>
</tbody></table>
<p>Oracle支持的2种事务级别：<strong>READ COMMITTED</strong>，SERIALIZABLE。Oracle默认的事务隔离级别为READ COMMITTED</p>
<p>Mysql支持4种事务级别，Mysql默认的事务隔离级别为<strong>REPETABLE READ</strong></p>
<h4 id="具体演示"><a href="#具体演示" class="headerlink" title="具体演示"></a>具体演示</h4><p>查看当前隔离级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @@tx_isolation;</span><br><span class="line">8.0后改为<span class="keyword">select</span> @@transaction_isolation;</span><br></pre></td></tr></table></figure>

<p>将隔离级别设置成最低</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">session</span> <span class="keyword">transaction</span> <span class="keyword">isolation</span> <span class="keyword">level</span> <span class="keyword">read</span> uncommitted;</span><br></pre></td></tr></table></figure>

<p>如果中文显示为乱码，更改字符集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">names</span> gbk;</span><br></pre></td></tr></table></figure>

<p>这时候如果开启两个事务，一个将表中姓名更改但没有提交，这时候另一个事务去读表中内容，读到了没有提交的内容，当事务1回滚，再次读的时候事务2仍读到原来的，出现脏读。</p>
<p>当更改事务1的隔离级别为读已提交，更改数据但不提交，更改事务2的隔离级别为读已提交，查看表中数据，无法看到表格修改的内容。因此脏读被避免。但当事务1提交后，事务2再查看表中内容，发现两次看的数据不一样，出现不可重复读。</p>
<p>当更改事务1和2的隔离级别为可重复读，更改事务1的数据但不提交，事务2查看表中数据，为未修改前的；当事务1提交，事务2查看仍是未修改的。只有事务2提交后，再次查看才是修改后的。解决了脏读和不可重复读。但当事务1要更改所有行数据的名字，还未执行，在此时事务2插入了一条数据并commit了，这样当事务1执行的时候多影响到了事务2插入的这一条数据，有幻读出现。只有执行插入语句的事务提交后，事务1的更改语句才能执行成功。</p>
<p>当事务1,2的隔离级别修改为串行化后，当事务1，2均开启，事务1要执行update操作，事务2执行插入语句，但无法执行成功，只有事务1提交后，事务2才能执行。一次只能执行一个事务。</p>
<p>经过试验，在最高等级下，哪个事务先被开启不重要，如果同时有两个事务被开启，事务1要执行插入操作，事务2没有执行sql语句，此时事务1的插入操作可以成功；但一旦事务2执行了sql语句，插入操作便不能成功，当插入数据的事务没有提交前，其他事务不能进行查询操作。小结：只要其他表使用了sql语句查看or操作表，修改表的操作就不能被执行；只要有其他事务修改了表，就不能查看表。看了不能改，改了不能看。</p>
<h4 id="Mysql中设置隔离级别"><a href="#Mysql中设置隔离级别" class="headerlink" title="Mysql中设置隔离级别"></a>Mysql中设置隔离级别</h4><ul>
<li><p>每启动一个mysql程序，就会获得一个单独的数据库连接，每个数据库连接都有一个全局变量@@tx_isolation，表示当前的事务隔离级别</p>
</li>
<li><p>查看当前的隔离级别：select @@tx_isolation;</p>
</li>
<li><p>设置当前mysql连接的隔离级别</p>
<p>set session transaction isolation level <strong>read uncommitted</strong>;将其替换为需要的级别</p>
</li>
<li><p>设置数据库的全局隔离级别</p>
<p>set <strong>global</strong> transaction isolation level <strong>read uncommitted</strong>;</p>
</li>
</ul>
<h4 id="delete和truncate在事务使用时的区别"><a href="#delete和truncate在事务使用时的区别" class="headerlink" title="delete和truncate在事务使用时的区别"></a>delete和truncate在事务使用时的区别</h4><p>delete和truncate是针对数据的操作语言，而不是针对表结构的，要删除表使用drop table，删除数据使用delete from 表名和truncate table 表名。</p>
<p>演示delete</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> autocommit=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">account</span>;</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<p>数据并没有被删除。</p>
<p>演示truncate</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> autocommit=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> <span class="keyword">account</span>;</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<p>这时候数据仍然被删除了，没有回滚。因此truncate不支持回滚。</p>
<h4 id="savepoint的使用"><a href="#savepoint的使用" class="headerlink" title="savepoint的使用"></a>savepoint的使用</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> autocommit = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">account</span> <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SAVEPOINT</span> a;<span class="comment">#设置保存点</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">account</span> <span class="keyword">WHERE</span> <span class="keyword">id</span> = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">ROLLBACK</span> <span class="keyword">TO</span> a;<span class="comment">#回滚至保存点</span></span><br></pre></td></tr></table></figure>

<p>savepoint搭配rollback使用，回滚到保存点，因此id=1的行被删除，但是id=3的行没有。</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>含义：虚拟表，和普通表一起使用</p>
<p>mysql5.1版本出现的新特性，行和列的数据来自自定义视图的查询中使用的表，并且是在使用视图时<strong>动态生成</strong>的，<strong>只保存了sql逻辑，不保存查询结果</strong></p>
<p>应用场景：</p>
<ul>
<li>多个地方用到<strong>同样的查询结果</strong></li>
<li>该查询结果使用的sql语句<strong>较复杂</strong></li>
</ul>
<p>好处：</p>
<p>1、简化了sql语句</p>
<p>2、提高了sql的重用性</p>
<p>3、保护了基表的数据，提高了安全性    </p>
<p>案例：查询姓张的学生名和专业名</p>
<p>以前的做法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> stuname,majorName</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`stuinfo`</span> s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="string">`major`</span> m <span class="keyword">ON</span> s.<span class="string">`majorId`</span>=m.<span class="string">`id`</span></span><br><span class="line"><span class="keyword">WHERE</span> stuname <span class="keyword">LIKE</span> <span class="string">'张%'</span>;</span><br></pre></td></tr></table></figure>

<p>现在可以将常用的语句封装为视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> v1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> stuname,majorName</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`stuinfo`</span> s</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="string">`major`</span> m <span class="keyword">ON</span> s.<span class="string">`majorId`</span>=m.<span class="string">`id`</span>;</span><br></pre></td></tr></table></figure>

<p>要调用的时候</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> v1 <span class="keyword">WHERE</span> stuname <span class="keyword">LIKE</span> <span class="string">'张%'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h3><p>语法：</p>
<p>create view 视图名</p>
<p>as</p>
<p>查询语句;</p>
<p>1、查询姓名中包含a字符的员工名、部门名和工种信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myv1</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`employees`</span> e</span><br><span class="line"><span class="keyword">JOIN</span> <span class="string">`departments`</span> d <span class="keyword">ON</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">JOIN</span><span class="string">`jobs`</span> j <span class="keyword">ON</span> j.<span class="string">`job_id`</span>=e.<span class="string">`job_id`</span>;</span><br><span class="line"><span class="comment">#2、使用</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myv1 <span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">'%a%'</span>;</span><br></pre></td></tr></table></figure>

<p>2、查询各部门的平均工资级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建视图查看每个部门的平均工资</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myv2</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) ag,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br><span class="line"><span class="comment">#2、使用</span></span><br><span class="line"><span class="keyword">SELECT</span> myv2.<span class="string">`ag`</span>,g.grade_level</span><br><span class="line"><span class="keyword">FROM</span> myv2</span><br><span class="line"><span class="keyword">JOIN</span> job_grades g</span><br><span class="line"><span class="keyword">ON</span> myv2.<span class="string">`ag`</span> <span class="keyword">BETWEEN</span> g.<span class="string">`lowest_sal`</span> <span class="keyword">AND</span> g.<span class="string">`highest_sal`</span>;</span><br></pre></td></tr></table></figure>

<p>3、查询平均工资最低的部门信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#平均工资视图已经被创建</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myv2 <span class="keyword">ORDER</span> <span class="keyword">BY</span> myv2.<span class="string">`ag`</span> <span class="keyword">ASC</span> <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>4、查询平均工资最低的部门名和工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建平均工资最低的部门id表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myv3</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myv2 <span class="keyword">ORDER</span> <span class="keyword">BY</span> myv2.<span class="string">`ag`</span> <span class="keyword">ASC</span> <span class="keyword">LIMIT</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">#将视图与部门表进行连接</span></span><br><span class="line"><span class="keyword">SELECT</span> d.*,m.ag</span><br><span class="line"><span class="keyword">FROM</span> myv3 m</span><br><span class="line"><span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> m.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span>;</span><br></pre></td></tr></table></figure>

<h3 id="视图的好处"><a href="#视图的好处" class="headerlink" title="视图的好处"></a>视图的好处</h3><ul>
<li>重用sql语句</li>
<li>简化复杂的sql操作，不必知道其细节</li>
<li>保护数据，提高安全性</li>
</ul>
<h3 id="视图的修改"><a href="#视图的修改" class="headerlink" title="视图的修改"></a>视图的修改</h3><p>方式一：</p>
<p>意思为存在就替代，不存在就创建</p>
<p><strong>create or replace</strong> view 视图名</p>
<p>as</p>
<p>查询语句;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv3</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary),job_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id;</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<p>语法：</p>
<p>alter view 视图名</p>
<p>as</p>
<p>查询语句;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> myv3</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<h3 id="视图的删除"><a href="#视图的删除" class="headerlink" title="视图的删除"></a>视图的删除</h3><p>语法：</p>
<p><strong>drop view</strong> 视图名，视图名，…;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> myv1,myv2,myv3;</span><br></pre></td></tr></table></figure>

<h3 id="查看视图"><a href="#查看视图" class="headerlink" title="查看视图"></a>查看视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DESC myv3;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myv3;</span><br></pre></td></tr></table></figure>

<h3 id="视图练习"><a href="#视图练习" class="headerlink" title="视图练习"></a>视图练习</h3><p>1、创建视图emp_v1，要求查询电话号码以011开头的员工姓名和工资、邮箱</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> emp_v1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,salary,email</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> phone_number <span class="keyword">LIKE</span> <span class="string">'011%'</span>;</span><br></pre></td></tr></table></figure>

<p>不能先创建没有phone筛选的视图再调用视图筛选，因为视图中没有phone这一列。</p>
<p>2、创建视图emp_v2，要求查询的部门最高工资高于12000的部门信息</p>
<p>之前做法：先得到部门最高工资高于12000的工资和编号表，然后和部门表连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> d.*,m.mx</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">JOIN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary) mx,department_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">	<span class="keyword">HAVING</span> <span class="keyword">MAX</span>(salary)&gt;<span class="number">12000</span></span><br><span class="line">) <span class="keyword">AS</span> m</span><br><span class="line"><span class="keyword">ON</span> d.department_id=m.department_id;</span><br></pre></td></tr></table></figure>

<p>视图的做法，先将部门最高工资高于12000的工资和编号表作为视图，然后用视图和部门表连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> emp_v2</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(salary) mx,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">MAX</span>(salary)&gt;<span class="number">12000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> d.*,emp_v2.mx</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">JOIN</span> emp_v2</span><br><span class="line"><span class="keyword">ON</span> d.department_id=emp_v2.department_id;</span><br></pre></td></tr></table></figure>

<h3 id="视图的更新"><a href="#视图的更新" class="headerlink" title="视图的更新"></a>视图的更新</h3><p>对视图的数据更新，而不是结构。一般给视图添加权限，只允许读，不允许写。</p>
<p>视图的可更新性和视图中查询的定义有关系，以下类型的视图是不允许更新的</p>
<ul>
<li>包含以下关键字的sql语句：分组函数、distinct、group by、having、union或者union all</li>
<li>常量视图</li>
<li>select中包含子查询</li>
<li>join</li>
<li>from一个不能更新的视图</li>
<li>where子句的子查询引用了from子句中的表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,email</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>1、插入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> myv1 <span class="keyword">VALUES</span>(<span class="string">'张飞'</span>,<span class="string">'zf@qq.com'</span>);</span><br></pre></td></tr></table></figure>

<p>此时在原始的employees表中也插入了数据。</p>
<p>2、修改</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> myv1 <span class="keyword">SET</span> last_name=<span class="string">'张无忌'</span> <span class="keyword">WHERE</span> last_name=<span class="string">'张飞'</span>;</span><br></pre></td></tr></table></figure>

<p>原始表依然被更改了</p>
<p>3、删除</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> myv1 <span class="keyword">WHERE</span> last_name=<span class="string">'张无忌'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="视图与表的比较"><a href="#视图与表的比较" class="headerlink" title="视图与表的比较"></a>视图与表的比较</h3><table>
<thead>
<tr>
<th></th>
<th>创建语法的关键字</th>
<th>是否实际占用屋里空间</th>
<th>使用</th>
</tr>
</thead>
<tbody><tr>
<td>视图</td>
<td>create view</td>
<td>只是保存了sql逻辑</td>
<td>一般仅用来查</td>
</tr>
<tr>
<td>表</td>
<td>create table</td>
<td>保存了数据</td>
<td>增删改查</td>
</tr>
</tbody></table>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>系统变量</p>
<ul>
<li><p>全局变量</p>
<p>作用域：服务器每次启动将为所有的全局变量赋初始值，针对于所有的会话（连接）有效，但不能跨重启。</p>
</li>
<li><p>会话变量</p>
<p>作用域：仅仅针对于当前会话（连接）有效</p>
</li>
</ul>
<p>自定义变量</p>
<ul>
<li>用户变量</li>
<li>局部变量</li>
</ul>
<h3 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h3><p>说明：变量由系统提供，不是用户定义，属于服务器层面</p>
<p>使用的语法    ：</p>
<p>1、查看所有的系统变量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> <span class="keyword">VARIABLES</span>;<span class="comment">#全局变量</span></span><br><span class="line"><span class="keyword">SHOW</span> 【<span class="keyword">SESSION</span>】 <span class="keyword">VARIABLES</span>;<span class="comment">#会话变量</span></span><br></pre></td></tr></table></figure>

<p>2、查看满足条件的部分系统变量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span>|[<span class="keyword">SESSION</span>] <span class="keyword">VARIABLES</span> <span class="keyword">like</span> <span class="string">'%查询字符%'</span>;</span><br></pre></td></tr></table></figure>

<p>3、查看指定的某个系统变量的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @@global.系统变量名;<span class="comment">#全局变量</span></span><br><span class="line"><span class="keyword">select</span> @@[session.]系统变量名;<span class="comment">#会话变量</span></span><br></pre></td></tr></table></figure>

<p>4、为某个系统变量赋值</p>
<p>方式一：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span>|【<span class="keyword">session</span>】 系统变量名=值;</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> @@<span class="keyword">global</span>|【<span class="keyword">session</span>】 .系统变量名=值;</span><br></pre></td></tr></table></figure>

<p>注意：如果是全局级别，则需要加global，如果是会话级别，则需要加session，如果不写，则默认session</p>
<h3 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h3><p>说明：变量是用户自定义的，不是由系统定义的。</p>
<p>使用步骤：</p>
<p>声明</p>
<p>赋值</p>
<p>使用（查看、比较、运算等）</p>
<p>1、用户变量</p>
<p>作用域：针对于当前的会话（连接）有效，同于会话变量的作用域</p>
<p>应用在任何地方，也就是begin end里面或者外面</p>
<p>赋值的操作符：=或:=</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、声明并初始化</span></span><br><span class="line"><span class="keyword">SET</span> @用户变量名=值;或</span><br><span class="line"><span class="keyword">SET</span> @用户变量名:=值;或</span><br><span class="line"><span class="keyword">SELECT</span> @用户变量名:=值;</span><br><span class="line"><span class="comment">#2、赋值（更新用户变量的值）</span></span><br><span class="line">方式一：通过<span class="keyword">SET</span>或<span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">SET</span> @用户变量名=值;或</span><br><span class="line">    <span class="keyword">SET</span> @用户变量名:=值;或</span><br><span class="line">    <span class="keyword">SELECT</span> @用户变量名:=值;</span><br><span class="line">方式二：通过<span class="keyword">SELECT</span> <span class="keyword">INTO</span></span><br><span class="line">    <span class="keyword">SELECT</span> 字段 <span class="keyword">INTO</span> @变量名</span><br><span class="line">    <span class="keyword">FROM</span> 表;</span><br><span class="line"><span class="comment">#3、使用（查看用户变量的值）</span></span><br><span class="line">    <span class="keyword">SELECT</span> @用户变量名;</span><br></pre></td></tr></table></figure>

<p>2、局部变量</p>
<p>作用域：仅仅在定义它的begin end中有效</p>
<p>应用在 begin end中的第一句话</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1、声明</span><br><span class="line">  <span class="keyword">DECLARE</span> 变量名 类型;</span><br><span class="line">  <span class="keyword">DECLARE</span> 变量名 类型 <span class="keyword">DEFAULT</span> 值;</span><br><span class="line">2、赋值</span><br><span class="line">  方式一：通过<span class="keyword">SET</span>或<span class="keyword">SELECT</span></span><br><span class="line">      <span class="keyword">SET</span> 局部变量名=值;或</span><br><span class="line">      <span class="keyword">SET</span> 局部变量名:=值;或</span><br><span class="line">      <span class="keyword">SELECT</span> @局部变量名:=值;</span><br><span class="line">  方式二：通过<span class="keyword">SELECT</span> <span class="keyword">INTO</span></span><br><span class="line">      <span class="keyword">SELECT</span> 字段 <span class="keyword">INTO</span> 局部变量名</span><br><span class="line">      <span class="keyword">FROM</span> 表;</span><br><span class="line">3、使用</span><br><span class="line">  <span class="keyword">SELECT</span> 局部变量名;</span><br></pre></td></tr></table></figure>

<h4 id="对比用户变量和局部变量"><a href="#对比用户变量和局部变量" class="headerlink" title="对比用户变量和局部变量"></a>对比用户变量和局部变量</h4><table>
<thead>
<tr>
<th></th>
<th>作用域</th>
<th>定义和使用的位置</th>
<th>语法</th>
</tr>
</thead>
<tbody><tr>
<td>用户变量</td>
<td>当前会话</td>
<td>会话中的任何地方</td>
<td>必须加@符号</td>
</tr>
<tr>
<td>局部变量</td>
<td>BEGIN END中</td>
<td>只能在BEGIN END 中，且为第一句话</td>
<td>一般不用加@符号，需要限定类型</td>
</tr>
</tbody></table>
<p>案例：声明两个变量并赋初值，求和，并打印</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、用户变量</span></span><br><span class="line"><span class="keyword">SET</span> @m = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> @n = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">sum</span> = @m + @n;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">sum</span>;</span><br><span class="line"><span class="comment">#语法报错，需要使用在BEGIN END中</span></span><br><span class="line"><span class="comment">#2、局部变量</span></span><br><span class="line"><span class="keyword">DECLARE</span> m <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> n <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> <span class="keyword">SUM</span> <span class="built_in">INT</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">SUM</span>=m+n;</span><br></pre></td></tr></table></figure>

<h2 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h2><p>类似Java中的方法</p>
<h3 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h3><h4 id="存储过程创建与调用"><a href="#存储过程创建与调用" class="headerlink" title="存储过程创建与调用"></a>存储过程创建与调用</h4><p>含义：一组预先编译好的SQL语句的集合，理解成批处理语句</p>
<p>好处：</p>
<ol>
<li>提高代码的重用性</li>
<li>简化操作</li>
<li>减少了编译次数并且减少了和数据库服务器的连接次数，提高了效率</li>
</ol>
<p>一、创建语法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create procedure 存储过程名(in|out|inout 参数名  参数类型,...)</span><br><span class="line">begin</span><br><span class="line">	存储过程体（一组合法的SQL语句）</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<p>1、参数列表包括三部分</p>
<p>参数模式 参数名 参数类型</p>
<p>举例：</p>
<p>IN stuname VARCHAR(20)</p>
<p>参数模式：</p>
<p>IN：该参数可以作为输入，即该参数需要调入方传入值</p>
<p>OUT：该参数可以作为输出，即该参数可以作为返回值</p>
<p>INOUT：该参数即可以作为输入又可以作为输出，该参数既需要传入值，又可以返回值</p>
<p>2、如果存储过程体只有一句话，begin end可以省略</p>
<p>存储过程中的每条sql语句的结尾必须加分号。存储过程的结尾可以使用DELIMITER重新设置</p>
<p>语法：</p>
<p>DELIMITER 结束标记</p>
<p>DELIMITER $</p>
<p>二、调用语法</p>
<p>CALL 存储过程名（实参列表）；</p>
<p>1、空参列表</p>
<p>案例：插入到admin表中5条记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建存储过程</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp1()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(username,<span class="string">`password`</span>)</span><br><span class="line">	<span class="keyword">VALUES</span>(<span class="string">'john1'</span>,<span class="string">'0000'</span>),(<span class="string">'lili'</span>,<span class="string">'0000'</span>),(<span class="string">'rose'</span>,<span class="string">'0000'</span>),(<span class="string">'jack'</span>,<span class="string">'0000'</span>),(<span class="string">'tom'</span>,<span class="string">'0000'</span>);</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"><span class="comment">#2、调用</span></span><br><span class="line"><span class="keyword">CALL</span> myp1()$</span><br></pre></td></tr></table></figure>

<p>2、创建带in模式参数的存储过程</p>
<p>案例1：创建存储过程实现根据女神名，查询对应的男神信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1、创建</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp2(<span class="keyword">IN</span> beautyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> bo.*</span><br><span class="line">	<span class="keyword">FROM</span> boys bo</span><br><span class="line">	<span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> beauty b</span><br><span class="line">	<span class="keyword">ON</span> bo.id = b.<span class="string">`boyfriend_id`</span></span><br><span class="line">	<span class="keyword">WHERE</span> b.name=beautyName;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"><span class="comment">#2、调用</span></span><br><span class="line"><span class="keyword">CALL</span> myp2(<span class="string">'小昭'</span>);</span><br></pre></td></tr></table></figure>

<p>案例2：创建存储过程实现用户是否登录成功</p>
<p>思路：先创建存储过程来查询表中与输入信息相同的个数（count(*)），然后为了将个数赋值给变量，声明了int类型的变量result，然后用if语句来判断如果个数&gt;0，则输出成功。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp4(<span class="keyword">IN</span> username <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">IN</span> <span class="keyword">PASSWORD</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">#声明并初始化</span></span><br><span class="line">	<span class="keyword">DECLARE</span> <span class="keyword">result</span> <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">INTO</span> <span class="keyword">result</span><span class="comment">#赋值 select into用法</span></span><br><span class="line">	<span class="keyword">FROM</span> <span class="keyword">admin</span> </span><br><span class="line">	<span class="comment">#出现冲突时，使用表名.变量名的形式</span></span><br><span class="line">	<span class="keyword">WHERE</span> admin.username = username</span><br><span class="line">	<span class="keyword">AND</span> admin.password = <span class="keyword">PASSWORD</span>;</span><br><span class="line">	<span class="comment">#使用</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="keyword">result</span>&gt;<span class="number">0</span>,<span class="string">'成功'</span>,<span class="string">'失败'</span>);</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> myp4(<span class="string">'张飞'</span>,<span class="string">'8888'</span>);</span><br></pre></td></tr></table></figure>

<p>3、创建带out模式的存储过程</p>
<p>案例1：根据女神名，返回对应的男神名</p>
<p>思路：查询后的结果利用select into 参数名进行传递，然后调用时可以定义用户变量在begin end外面接收，然后输出即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp5(<span class="keyword">IN</span> beautyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">OUT</span> boyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> bo.<span class="string">`boyName`</span> <span class="keyword">INTO</span> boyName</span><br><span class="line">	<span class="keyword">FROM</span> <span class="string">`boys`</span> bo</span><br><span class="line">	<span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="string">`beauty`</span> b</span><br><span class="line">	<span class="keyword">ON</span> bo.<span class="string">`id`</span> = b.<span class="string">`boyfriend_id`</span></span><br><span class="line">	<span class="keyword">WHERE</span> b.<span class="string">`name`</span>=beautyName;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"><span class="comment">#调用</span></span><br><span class="line"><span class="keyword">SET</span> @bName;</span><br><span class="line"><span class="keyword">CALL</span> myp5(<span class="string">'小昭'</span>,@bName);</span><br><span class="line"><span class="keyword">SELECT</span> @bName;</span><br></pre></td></tr></table></figure>

<p>案例2：根据女神名，返回对应的男神名和男神魅力值</p>
<p>注意：为了输出多个OUT，需要在select写完后，再INTO后面加变量1，变量2。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp6(<span class="keyword">IN</span> beautyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">OUT</span> boyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">OUT</span> userCP <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> bo.<span class="string">`boyName`</span> ,bo.<span class="string">`userCP`</span> <span class="keyword">INTO</span> boyName,userCP</span><br><span class="line">	<span class="keyword">FROM</span> <span class="string">`boys`</span> bo</span><br><span class="line">	<span class="keyword">INNER</span> <span class="keyword">JOIN</span> <span class="string">`beauty`</span> b</span><br><span class="line">	<span class="keyword">ON</span> bo.<span class="string">`id`</span> = b.<span class="string">`boyfriend_id`</span></span><br><span class="line">	<span class="keyword">WHERE</span> b.<span class="string">`name`</span>=beautyName;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> myp6(<span class="string">'小昭'</span>,@bName,@userCP);</span><br><span class="line"><span class="keyword">SELECT</span> @bName,@userCP;</span><br></pre></td></tr></table></figure>

<p>4、创建带inout模式参数的存储过程</p>
<p>案例1：传入a和b两个值，最终a和b都翻倍并返回</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> myp7(INOUT a <span class="built_in">INT</span>, INOUT b <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SET</span> a=a*<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">SET</span> b=b*<span class="number">2</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> @m=<span class="number">10</span>;</span><br><span class="line"><span class="keyword">SET</span> @n=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">CALL</span> myp7(@m,@n);</span><br><span class="line"><span class="keyword">SELECT</span> @m,@n;</span><br></pre></td></tr></table></figure>

<h4 id="存储过程删除"><a href="#存储过程删除" class="headerlink" title="存储过程删除"></a>存储过程删除</h4><p>语法：drop procedure 存储过程名</p>
<h4 id="查看存储过程的信息"><a href="#查看存储过程的信息" class="headerlink" title="查看存储过程的信息"></a>查看存储过程的信息</h4><p>show create procedure 存储过程名</p>
<h4 id="存储过程练习"><a href="#存储过程练习" class="headerlink" title="存储过程练习"></a>存储过程练习</h4><p>1、创建存储过程实现传入用户名和密码，插入到admin表中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_pro1(<span class="keyword">IN</span> username <span class="built_in">VARCHAR</span>(<span class="number">20</span>), <span class="keyword">IN</span> <span class="keyword">PASSWORD</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(admin.username,admin.<span class="string">`password`</span>)</span><br><span class="line">	<span class="keyword">VALUES</span>(username,<span class="keyword">PASSWORD</span>);</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_pro1(<span class="string">'admin'</span>,<span class="string">'0000'</span>);</span><br></pre></td></tr></table></figure>

<p>2、创建存储过程或函数实现传入女神编号，返回女神名称和女神电话</p>
<p>有复制，用select 字段 into 变量名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_pro2(<span class="keyword">IN</span> beautyID <span class="built_in">INT</span>,<span class="keyword">OUT</span> beautyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>),<span class="keyword">OUT</span> beautyPhone <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="string">`name`</span> ,<span class="string">`phone`</span> <span class="keyword">INTO</span> beautyName,beautyPhone</span><br><span class="line">	<span class="keyword">FROM</span> <span class="string">`beauty`</span></span><br><span class="line">	<span class="keyword">WHERE</span> <span class="keyword">id</span>=beautyID;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_pro2(<span class="number">12</span>,@<span class="keyword">name</span>,@phone);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">name</span>,@phone;</span><br></pre></td></tr></table></figure>

<p>3、创建存储过程或函数实现传入两个女神生日，返回大小</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_pro3(<span class="keyword">IN</span> birth1 DATETIME, <span class="keyword">IN</span> birth2 DATETIME, <span class="keyword">OUT</span> <span class="keyword">result</span> <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DATEDIFF</span>(birth1,birth2) <span class="keyword">INTO</span> <span class="keyword">result</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_pro3(<span class="string">'1988-1-1'</span>,<span class="keyword">NOW</span>(),@<span class="keyword">result</span>);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">result</span>;</span><br></pre></td></tr></table></figure>

<p>4、创建存储过程或函数传入一个日期，格式化成xx年xx月xx日并返回</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_pro4(<span class="keyword">IN</span> mydate DATETIME, <span class="keyword">OUT</span> <span class="keyword">str</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(mydate,<span class="string">'%y年%m月%d日'</span>) <span class="keyword">INTO</span> <span class="keyword">str</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_pro4(<span class="keyword">NOW</span>(),@<span class="keyword">str</span>);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">str</span>;</span><br></pre></td></tr></table></figure>

<p>5、创建存储过程或函数传入女神名称，返回：女神 and 男神 格式的字符串</p>
<p>如：传入 小昭</p>
<p>返回：小昭 and 张无忌</p>
<p>思路：正常查询，其中字符串拼接使用CONCAT函数，中间用逗号隔开，输出存入变量，查询用右外连接，加上筛选条件。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_pro5(<span class="keyword">IN</span> beautyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>), <span class="keyword">OUT</span> <span class="keyword">str</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(beautyName,<span class="string">' and '</span>,boyName) <span class="keyword">INTO</span> <span class="keyword">str</span></span><br><span class="line">	<span class="keyword">FROM</span> boys bo</span><br><span class="line">	<span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> beauty b</span><br><span class="line">	<span class="keyword">ON</span> bo.id=b.boyfriend_id</span><br><span class="line">	<span class="keyword">WHERE</span> b.name=beautyName;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_pro5(<span class="string">'小昭'</span>,@<span class="keyword">str</span>);</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">str</span>;</span><br></pre></td></tr></table></figure>

<p>但是这样写的话，当boyName为null的时候，拼接在一起也是null，因此最好使用ifnull来进行判断，只要有为空可能的字段，要是跟其他字符串拼接或者要使用它，最好加上IFNULL判断。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_pro5(<span class="keyword">IN</span> beautyName <span class="built_in">VARCHAR</span>(<span class="number">20</span>), <span class="keyword">OUT</span> <span class="keyword">str</span> <span class="built_in">VARCHAR</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(beautyName,<span class="string">' and '</span>,<span class="keyword">IFNULL</span>(boyName,<span class="string">'null'</span>)) <span class="keyword">INTO</span> <span class="keyword">str</span></span><br><span class="line">	<span class="keyword">FROM</span> boys bo</span><br><span class="line">	<span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> beauty b</span><br><span class="line">	<span class="keyword">ON</span> bo.id=b.boyfriend_id</span><br><span class="line">	<span class="keyword">WHERE</span> b.name=beautyName;</span><br><span class="line"><span class="keyword">END</span> $</span><br></pre></td></tr></table></figure>

<p>6、创建存储过程或函数，根据传入的条目数和起始索引，查询beauty表的记录</p>
<p>其中用到了分页，limit 【offset】，size</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_pro6(<span class="keyword">IN</span> <span class="keyword">size</span> <span class="built_in">INT</span>, <span class="keyword">IN</span> startIndex <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> beauty <span class="keyword">LIMIT</span> startIndex,<span class="keyword">size</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_pro6(<span class="number">3</span>,<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>与存储过程的区别是：</p>
<ul>
<li>存储过程：可以有0个返回，也可以有多个返回，适合做批量插入、批量更新</li>
<li>函数：有且仅有1个返回，适合做处理数据后返回一个结果</li>
</ul>
<h4 id="函数创建"><a href="#函数创建" class="headerlink" title="函数创建"></a>函数创建</h4><p>1、创建语法</p>
<p>create function 函数名（参数列表）<strong>returns</strong> 返回类型</p>
<p>begin</p>
<p>​    函数体</p>
<p>end</p>
<p>注意：</p>
<ul>
<li><p>参数列表包含两部分，参数名  参数类型</p>
</li>
<li><p>函数体：肯定会有return语句，如果没有会报错，如果return语句不放在函数体最后不报错，但不建议</p>
</li>
<li><p>函数体中仅有一句话，可以省略begin end</p>
</li>
<li><p>使用delimiter语句设置结束标记</p>
</li>
</ul>
<h4 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h4><p>执行语句并显示返回值</p>
<p>语法：</p>
<p>select 函数名（参数列表）</p>
<p>1、无参有返回</p>
<p>案例：返回公司的员工个数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> myf1() <span class="keyword">RETURNS</span> <span class="built_in">INT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> c <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;<span class="comment">#定义变量</span></span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">INTO</span> c<span class="comment">#赋值</span></span><br><span class="line">	<span class="keyword">FROM</span> employees;</span><br><span class="line">	RETURN c;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"><span class="comment">#调用</span></span><br><span class="line"><span class="keyword">SELECT</span> myf1();</span><br></pre></td></tr></table></figure>

<p>2、有参有返回</p>
<p>案例1：根据员工名，返回它的工资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> myf2(empName <span class="built_in">VARCHAR</span>(<span class="number">20</span>)) <span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SET</span> @sal=<span class="number">0</span>;<span class="comment">#定义用户变量</span></span><br><span class="line">	<span class="keyword">SELECT</span> salary <span class="keyword">INTO</span> @sal<span class="comment">#赋值</span></span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name = empName;</span><br><span class="line">	RETURN @sal;<span class="comment">#返回值</span></span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> myf2(<span class="string">'Kochhar'</span>);</span><br></pre></td></tr></table></figure>

<p>案例2：根据部门名，返回该部门的平均工资</p>
<p>规律：</p>
<ul>
<li>记得写returns 变量 类型</li>
<li>在begin end中定义变量（declare sal double）or （set @sal double）</li>
<li>利用select 字段 into 变量赋值</li>
<li>最后return 变量。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> myf3(depName <span class="built_in">VARCHAR</span>(<span class="number">20</span>)) <span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">#定义返回值</span></span><br><span class="line">	<span class="keyword">DECLARE</span> sal <span class="keyword">DOUBLE</span>;</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">AVG</span>(salary) <span class="keyword">INTO</span> sal</span><br><span class="line">	<span class="keyword">FROM</span> employees e</span><br><span class="line">	<span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line">	<span class="keyword">WHERE</span> d.<span class="string">`department_name`</span>= depName;</span><br><span class="line">	RETURN sal;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> myf3(<span class="string">'IT'</span>);</span><br></pre></td></tr></table></figure>

<h4 id="查看函数"><a href="#查看函数" class="headerlink" title="查看函数"></a>查看函数</h4><p>语法</p>
<p>show create function 函数名;</p>
<h4 id="删除函数"><a href="#删除函数" class="headerlink" title="删除函数"></a>删除函数</h4><p>语法</p>
<p>drop function 函数名；</p>
<h4 id="函数练习"><a href="#函数练习" class="headerlink" title="函数练习"></a>函数练习</h4><p>案例：创建函数，实现传入两个float，返回二者之和</p>
<p>这里给变量赋值，可以使用set 变量=语句，也可以使用select 语句 into 变量名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> myf4(num1 <span class="built_in">FLOAT</span>,num2 <span class="built_in">FLOAT</span>) <span class="keyword">RETURNS</span> <span class="built_in">FLOAT</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> num3 <span class="built_in">FLOAT</span>;</span><br><span class="line">	<span class="keyword">SET</span> num3 = num1 + num2;</span><br><span class="line">	RETURN num3;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> myf4(<span class="number">1</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>

<h2 id="流程控制结构"><a href="#流程控制结构" class="headerlink" title="流程控制结构"></a>流程控制结构</h2><ul>
<li>顺序结构：程序从上往下一次执行</li>
<li>分支结构：程序从两条或多条路径中选择一条去执行</li>
<li>循环结构：程序在满足一定条件的基础上，重复执行一段代码</li>
</ul>
<h3 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h3><h4 id="IF函数"><a href="#IF函数" class="headerlink" title="IF函数"></a>IF函数</h4><p>功能：实现简单的双分支</p>
<p>select If(表达式1，表达式2，表达式3)</p>
<p>执行顺序：如果IF函数成立，则IF函数返回表达式2的值，否则返回表达式3的值</p>
<p>应用在任何地方</p>
<h4 id="CASE结构"><a href="#CASE结构" class="headerlink" title="CASE结构"></a>CASE结构</h4><p>情况1：类似于java中的switch语句，一般用于实现等值判断</p>
<p>语法：</p>
<p>case 变量|表达式|字段</p>
<p>when 要判断的值 then 返回的值1或语句1【；】</p>
<p>when 要判断的值 then 返回的值2或语句2【；】</p>
<p>…</p>
<p>else 要返回的值 n或语句n【；】</p>
<p>end 【case;】</p>
<p>情况2：类似于java中的多重IF语句，一般用于实现区间判断</p>
<p>case </p>
<p>when 要判断的条件1 then 返回的值1或语句1【；】</p>
<p>when 要判断的条件2 then 返回的值2或语句2【；】</p>
<p>…</p>
<p>else 要返回的值 n或语句n【；】</p>
<p>end 【case；】</p>
<p>特点：</p>
<ol>
<li><p>可以作为表达式，嵌套在其他语句中使用，可以放在任何地方，begin end中或外面</p>
<p>可以作为<strong>独立的语句</strong>使用，只能放在begin end中</p>
</li>
<li><p>如果when中的值满足或条件成立，则执行对应的then后面的语句，并且结束case </p>
<p>如果都不满足，则执行else中的语句或值</p>
</li>
<li><p>else可以省略，如果else省略了，并且所有的when条件都不满足，则返回null</p>
</li>
</ol>
<p>案例：创建存储过程，根据传入的成绩来显示等级，如传入成绩：90-100，显示A；80-90，显示B；60-80，显示C；否则显示D</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_case(<span class="keyword">IN</span> score <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">CASE</span> </span><br><span class="line">	<span class="keyword">WHEN</span> score&gt;=<span class="number">90</span> <span class="keyword">AND</span> score&lt;=<span class="number">100</span> <span class="keyword">THEN</span> <span class="keyword">SELECT</span> <span class="string">'A'</span>;</span><br><span class="line">	WHEN score&gt;=80 THEN SELECT 'B';</span><br><span class="line">	WHEN score&gt;=60 THEN SELECT 'C';</span><br><span class="line">	ELSE <span class="keyword">SELECT</span> <span class="string">'D'</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_case(<span class="number">55</span>);</span><br></pre></td></tr></table></figure>

<h4 id="IF结构"><a href="#IF结构" class="headerlink" title="IF结构"></a>IF结构</h4><p>功能：实现多重分支</p>
<p>语法：</p>
<p>if 条件1 then 语句1；</p>
<p>elseif 条件2 then 语句2；</p>
<p>…</p>
<p>【else 语句n;】</p>
<p>end if;</p>
<p>应用场景：应用在begin end中</p>
<p>案例：根据传入的成绩，来显示等级，比如传入成绩：90-100，返回A；80-90，返回B；60-80，返回C；否则返回D</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $	 </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> test_if(score <span class="built_in">INT</span>) <span class="keyword">RETURNS</span> <span class="built_in">CHAR</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">IF</span> score&gt;=<span class="number">90</span> <span class="keyword">AND</span> score&lt;=<span class="number">100</span> <span class="keyword">THEN</span> <span class="keyword">RETURN</span> <span class="string">'A'</span>;</span><br><span class="line">	ELSEIF score&gt;=80 THEN RETURN 'B';</span><br><span class="line">	ELSEIF score&gt;=60 THEN RETURN 'C';</span><br><span class="line">	ELSE RETURN 'D';</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> test_if(<span class="number">86</span>);</span><br></pre></td></tr></table></figure>

<h3 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h3><p>分类：while、loop、repeat</p>
<p>循环控制：</p>
<p>iterate类似于continue，继续，结束本次循环，继续下一次</p>
<p>leave类似于break，跳出，结束当前所在的循环</p>
<h4 id="while"><a href="#while" class="headerlink" title="while"></a>while</h4><p>语法：</p>
<p>【标签：】while 循环条件 do</p>
<p>​    循环体;</p>
<p>end while【标签】；</p>
<h4 id="loop"><a href="#loop" class="headerlink" title="loop"></a>loop</h4><p>语法：</p>
<p>【标签：】loop</p>
<p>​    循环体；</p>
<p>end loop【标签】；</p>
<p>可以用来模拟简单的死循环</p>
<h4 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h4><p>类似于do while，至少执行一次</p>
<p>语法：</p>
<p>【标签：】repeat</p>
<p>​    循环体；</p>
<p>until 结束循环的条件</p>
<p>end repeat 【标签】；</p>
<h4 id="循环的使用"><a href="#循环的使用" class="headerlink" title="循环的使用"></a>循环的使用</h4><p>没有添加循环控制语句</p>
<p>案例：批量插入，根据次数插入到admin表中多条记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> pro_while1(<span class="keyword">IN</span> insertCount <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">#定义循环变量i，int类型初始值为1</span></span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">	WHILE i&lt;=insertCount DO</span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(username,<span class="string">`password`</span>) <span class="keyword">VALUES</span>(<span class="keyword">CONCAT</span>(<span class="string">'rose'</span>,i),<span class="string">'666'</span>);</span><br><span class="line">		<span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span>; </span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> pro_while1(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<p>添加leave语句</p>
<p>案例：批量插入，根据次数插入到admin表中多条记录，如果次数&gt;20则停止</p>
<p>这里配合了IF结构来使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_while1(<span class="keyword">IN</span> insertCount <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">	a:WHILE i&lt;=insertCount DO</span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(username,<span class="string">`password`</span>) <span class="keyword">VALUES</span>(<span class="keyword">CONCAT</span>(<span class="string">'hua'</span>,i),<span class="string">'0000'</span>);</span><br><span class="line">		IF i&gt;=20 THEN LEAVE a;</span><br><span class="line">		<span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">		<span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span> a;	</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_while1(<span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<p>添加iterate语句</p>
<p>案例：批量插入，根据次数插入到admin表中多条记录，只插入偶数次</p>
<p>思路：在不为偶数次的时候，iterate退出即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_while2(<span class="keyword">IN</span> insertCount <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> i <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	a:WHILE i&lt;=insertCount DO</span><br><span class="line">		<span class="keyword">SET</span> i=i+<span class="number">1</span>;</span><br><span class="line">		IF MOD(i,2)!=0 THEN ITERATE a;</span><br><span class="line">		<span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">admin</span>(username,<span class="string">`password`</span>) <span class="keyword">VALUES</span>(<span class="keyword">CONCAT</span>(<span class="string">'xi'</span>,i),<span class="string">'0000'</span>);</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">WHILE</span> a;	</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_while2(<span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<h4 id="循环总结"><a href="#循环总结" class="headerlink" title="循环总结"></a>循环总结</h4>

<h2 id="重要函数"><a href="#重要函数" class="headerlink" title="重要函数"></a>重要函数</h2><h3 id="IFNULL【重要】"><a href="#IFNULL【重要】" class="headerlink" title="IFNULL【重要】"></a>IFNULL【重要】</h3><p>IFNULL（变量名，常量）</p>
<p>如果变量为空，则用常量代替。</p>
<p>只要有为空可能的字段，要是跟其他字符串拼接或者要使用它，最好加上IFNULL判断。</p>
<h3 id="SET-NAMES-gbk"><a href="#SET-NAMES-gbk" class="headerlink" title="SET NAMES gbk;"></a>SET NAMES gbk;</h3><p>要是字符集报错，一般需要重新设置字符集</p>
<h3 id="DATEDIFF（time1-time2）"><a href="#DATEDIFF（time1-time2）" class="headerlink" title="DATEDIFF（time1,time2）"></a>DATEDIFF（time1,time2）</h3><p>返回两个datetime类型的时间差，返回为整数</p>
<h3 id="NOW"><a href="#NOW" class="headerlink" title="NOW()"></a>NOW()</h3><p>返回现在的时间，datetime类型</p>
<h3 id="CONCAT"><a href="#CONCAT" class="headerlink" title="CONCAT()"></a>CONCAT()</h3><p>拼接字符串，中间用逗号隔开</p>
<h3 id="LIMIT"><a href="#LIMIT" class="headerlink" title="LIMIT"></a>LIMIT</h3><p>limit 【offset】，size</p>
<p>用来分页，其中offset为开始的地方，从0开始，size表示数据量。</p>
<h2 id="牛客网题目"><a href="#牛客网题目" class="headerlink" title="牛客网题目"></a>牛客网题目</h2><p>1、查找当前薪水(to_date=’9999-01-01’)排名第二多的员工编号emp_no、薪水salary、last_name以及first_name，不准使用order by</p>
<p>思路：不能使用order by，就只能先找到最高薪水，然后将其排除在salary的选择之中（NOT IN），然后在剩下的工资中选择最大的，即为总体第二大的，用到的是内连接+where子查询的嵌套。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> e.emp_no,<span class="keyword">max</span>(salary) salary ,e.last_name,e.first_name</span><br><span class="line"><span class="keyword">from</span> employees e</span><br><span class="line"><span class="keyword">join</span> salaries s</span><br><span class="line"><span class="keyword">on</span> e.emp_no=s.emp_no</span><br><span class="line"><span class="keyword">where</span> s.to_date=<span class="string">'9999-01-01'</span></span><br><span class="line"><span class="keyword">and</span> s.salary <span class="keyword">not</span> <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">max</span>(salary)</span><br><span class="line">    <span class="keyword">from</span> salaries</span><br><span class="line">    <span class="keyword">where</span> <span class="keyword">to_date</span>=<span class="string">'9999-01-01'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>2、查找员工编号emp_no为10001其自入职以来的薪水salary涨幅值growth</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`salaries`</span> (</span><br><span class="line"><span class="string">`emp_no`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`salary`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`from_date`</span> <span class="built_in">date</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`to_date`</span> <span class="built_in">date</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`emp_no`</span>,<span class="string">`from_date`</span>));</span><br></pre></td></tr></table></figure>

<p>将工资按照时间排序，找出第一个和最后一个，然后二者相减。考察的是<strong>select的子句查询</strong>。最外层的select不用加from表，因为用不到。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">(<span class="keyword">select</span> salary <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no = <span class="number">10001</span> <span class="keyword">order</span> <span class="keyword">by</span> from_date <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">1</span>)</span><br><span class="line">-(<span class="keyword">select</span> salary <span class="keyword">from</span> salaries <span class="keyword">where</span> emp_no = <span class="number">10001</span> <span class="keyword">order</span> <span class="keyword">by</span> from_date <span class="keyword">asc</span> <span class="keyword">limit</span> <span class="number">1</span>)</span><br><span class="line"><span class="keyword">as</span> growth;</span><br></pre></td></tr></table></figure>



<h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><h3 id="MySQL客户端"><a href="#MySQL客户端" class="headerlink" title="MySQL客户端"></a>MySQL客户端</h3><ul>
<li>F12 将选中语句自动换行</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/14/Java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="Java学习笔记">
      <i class="fa fa-chevron-left"></i> Java学习笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/02/13/%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0/" rel="next" title="前端学习">
      前端学习 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#数据库操作基础"><span class="nav-number">1.</span> <span class="nav-text">数据库操作基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据库概述"><span class="nav-number">1.1.</span> <span class="nav-text">数据库概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#优点"><span class="nav-number">1.1.1.</span> <span class="nav-text">优点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常见数据库产品"><span class="nav-number">1.1.2.</span> <span class="nav-text">常见数据库产品</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库相关概念"><span class="nav-number">1.1.3.</span> <span class="nav-text">数据库相关概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库存储数据特点"><span class="nav-number">1.1.4.</span> <span class="nav-text">数据库存储数据特点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#初识MySQL"><span class="nav-number">1.2.</span> <span class="nav-text">初识MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL数据库介绍"><span class="nav-number">1.2.1.</span> <span class="nav-text">MySQL数据库介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DBMS分类"><span class="nav-number">1.2.2.</span> <span class="nav-text">DBMS分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL服务的启动与停止"><span class="nav-number">1.2.3.</span> <span class="nav-text">MySQL服务的启动与停止</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL服务的登录与退出"><span class="nav-number">1.2.4.</span> <span class="nav-text">MySQL服务的登录与退出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL的常见命令和语法规范"><span class="nav-number">1.3.</span> <span class="nav-text">MySQL的常见命令和语法规范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#常见命令"><span class="nav-number">1.3.1.</span> <span class="nav-text">常见命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#语法规范"><span class="nav-number">1.3.2.</span> <span class="nav-text">语法规范</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DQL语言"><span class="nav-number">1.4.</span> <span class="nav-text">DQL语言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分类"><span class="nav-number">1.4.1.</span> <span class="nav-text">分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进阶一：基础查询"><span class="nav-number">1.4.2.</span> <span class="nav-text">进阶一：基础查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#查询常量"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">查询常量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询表达式"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">查询表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询单个字段"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">查询单个字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询多个字段"><span class="nav-number">1.4.2.4.</span> <span class="nav-text">查询多个字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询所有字段"><span class="nav-number">1.4.2.5.</span> <span class="nav-text">查询所有字段</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查询函数（调用函数，获取返回值）"><span class="nav-number">1.4.2.6.</span> <span class="nav-text">查询函数（调用函数，获取返回值）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#起别名"><span class="nav-number">1.4.2.7.</span> <span class="nav-text">起别名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#concat的使用"><span class="nav-number">1.4.2.8.</span> <span class="nav-text">concat的使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#distinct去重"><span class="nav-number">1.4.2.9.</span> <span class="nav-text">distinct去重</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看表的结构"><span class="nav-number">1.4.2.10.</span> <span class="nav-text">查看表的结构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习题1"><span class="nav-number">1.4.3.</span> <span class="nav-text">练习题1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进阶二：条件查询"><span class="nav-number">1.4.4.</span> <span class="nav-text">进阶二：条件查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#语法："><span class="nav-number">1.4.4.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#特点："><span class="nav-number">1.4.4.2.</span> <span class="nav-text">特点：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按关系表达式查询"><span class="nav-number">1.4.4.3.</span> <span class="nav-text">按关系表达式查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按逻辑表达式查询"><span class="nav-number">1.4.4.4.</span> <span class="nav-text">按逻辑表达式查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模糊查询"><span class="nav-number">1.4.4.5.</span> <span class="nav-text">模糊查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#like"><span class="nav-number">1.4.4.5.1.</span> <span class="nav-text">like</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#in"><span class="nav-number">1.4.4.5.2.</span> <span class="nav-text">in</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#between-and"><span class="nav-number">1.4.4.5.3.</span> <span class="nav-text">between and</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#is-null"><span class="nav-number">1.4.4.5.4.</span> <span class="nav-text">is null</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进阶三：排序查询"><span class="nav-number">1.4.5.</span> <span class="nav-text">进阶三：排序查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#按单个字段排序"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">按单个字段排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按表达式排序"><span class="nav-number">1.4.5.2.</span> <span class="nav-text">按表达式排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按别名排序"><span class="nav-number">1.4.5.3.</span> <span class="nav-text">按别名排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按函数的结果排序"><span class="nav-number">1.4.5.4.</span> <span class="nav-text">按函数的结果排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按多个字段排序"><span class="nav-number">1.4.5.5.</span> <span class="nav-text">按多个字段排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按列数排序，用的少"><span class="nav-number">1.4.5.6.</span> <span class="nav-text">按列数排序，用的少</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习题2"><span class="nav-number">1.4.6.</span> <span class="nav-text">练习题2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进阶四：常见函数"><span class="nav-number">1.4.7.</span> <span class="nav-text">进阶四：常见函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#字符函数"><span class="nav-number">1.4.7.1.</span> <span class="nav-text">字符函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#数学函数"><span class="nav-number">1.4.7.2.</span> <span class="nav-text">数学函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#日期函数"><span class="nav-number">1.4.7.3.</span> <span class="nav-text">日期函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#其他函数"><span class="nav-number">1.4.7.4.</span> <span class="nav-text">其他函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#流程控制函数"><span class="nav-number">1.4.7.5.</span> <span class="nav-text">流程控制函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习题3"><span class="nav-number">1.4.8.</span> <span class="nav-text">练习题3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分组函数"><span class="nav-number">1.4.9.</span> <span class="nav-text">分组函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#count的补充介绍"><span class="nav-number">1.4.9.1.</span> <span class="nav-text">count的补充介绍</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进阶五：分组查询"><span class="nav-number">1.4.10.</span> <span class="nav-text">进阶五：分组查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#分组查询引入"><span class="nav-number">1.4.10.1.</span> <span class="nav-text">分组查询引入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#语法"><span class="nav-number">1.4.10.2.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#特点"><span class="nav-number">1.4.10.3.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#简单的分组"><span class="nav-number">1.4.10.4.</span> <span class="nav-text">简单的分组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可以实现分组前的筛选"><span class="nav-number">1.4.10.5.</span> <span class="nav-text">可以实现分组前的筛选</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可以实现分组后的筛选"><span class="nav-number">1.4.10.6.</span> <span class="nav-text">可以实现分组后的筛选</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可以实现排序"><span class="nav-number">1.4.10.7.</span> <span class="nav-text">可以实现排序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#按多个字段分组"><span class="nav-number">1.4.10.8.</span> <span class="nav-text">按多个字段分组</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进阶六：连接查询"><span class="nav-number">1.4.11.</span> <span class="nav-text">进阶六：连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sql92标准"><span class="nav-number">1.4.11.1.</span> <span class="nav-text">sql92标准</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#等值连接"><span class="nav-number">1.4.11.1.1.</span> <span class="nav-text">等值连接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#非等值连接"><span class="nav-number">1.4.11.1.2.</span> <span class="nav-text">非等值连接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#自连接"><span class="nav-number">1.4.11.1.3.</span> <span class="nav-text">自连接</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习题4"><span class="nav-number">1.4.12.</span> <span class="nav-text">练习题4</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sql99标准"><span class="nav-number">1.4.12.1.</span> <span class="nav-text">sql99标准</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#内连接"><span class="nav-number">1.4.12.1.1.</span> <span class="nav-text">内连接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#外连接"><span class="nav-number">1.4.12.1.2.</span> <span class="nav-text">外连接</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#全外"><span class="nav-number">1.4.12.1.3.</span> <span class="nav-text">全外</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#交叉连接"><span class="nav-number">1.4.12.1.4.</span> <span class="nav-text">交叉连接</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sql92与sql99"><span class="nav-number">1.4.12.2.</span> <span class="nav-text">sql92与sql99</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#多表连接练习"><span class="nav-number">1.4.13.</span> <span class="nav-text">多表连接练习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进阶七：子查询"><span class="nav-number">1.4.14.</span> <span class="nav-text">进阶七：子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#含义："><span class="nav-number">1.4.14.1.</span> <span class="nav-text">含义：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分类："><span class="nav-number">1.4.14.2.</span> <span class="nav-text">分类：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#where或having后面"><span class="nav-number">1.4.14.3.</span> <span class="nav-text">where或having后面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#select后面"><span class="nav-number">1.4.14.4.</span> <span class="nav-text">select后面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#from后面"><span class="nav-number">1.4.14.5.</span> <span class="nav-text">from后面</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exists后面（相关子查询）"><span class="nav-number">1.4.14.6.</span> <span class="nav-text">exists后面（相关子查询）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习题5"><span class="nav-number">1.4.15.</span> <span class="nav-text">练习题5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进阶八：分页查询"><span class="nav-number">1.4.16.</span> <span class="nav-text">进阶八：分页查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习题6"><span class="nav-number">1.4.17.</span> <span class="nav-text">练习题6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子查询经典案例"><span class="nav-number">1.4.18.</span> <span class="nav-text">子查询经典案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进阶九：union联合查询"><span class="nav-number">1.4.19.</span> <span class="nav-text">进阶九：union联合查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询总结"><span class="nav-number">1.4.20.</span> <span class="nav-text">查询总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DML语言"><span class="nav-number">1.5.</span> <span class="nav-text">DML语言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#插入语句"><span class="nav-number">1.5.1.</span> <span class="nav-text">插入语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方式一：经典插入"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">方式一：经典插入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方式二："><span class="nav-number">1.5.1.2.</span> <span class="nav-text">方式二：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#两种方式比较"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">两种方式比较</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#修改语句"><span class="nav-number">1.5.2.</span> <span class="nav-text">修改语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#修改单表的记录【重要】"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">修改单表的记录【重要】</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改多表的记录【补充】"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">修改多表的记录【补充】</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#删除语句"><span class="nav-number">1.5.3.</span> <span class="nav-text">删除语句</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#方式一：delete"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">方式一：delete</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#方式二：truncate语句"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">方式二：truncate语句</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#两种方式比较【面试题，重要】"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">两种方式比较【面试题，重要】</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习题"><span class="nav-number">1.5.4.</span> <span class="nav-text">练习题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DDL语言"><span class="nav-number">1.6.</span> <span class="nav-text">DDL语言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#库的管理"><span class="nav-number">1.6.1.</span> <span class="nav-text">库的管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#库的创建"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">库的创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#库的修改"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">库的修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#库的删除"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">库的删除</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#表的管理"><span class="nav-number">1.6.2.</span> <span class="nav-text">表的管理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#表的创建【重要】"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">表的创建【重要】</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#表的修改"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">表的修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#表的删除"><span class="nav-number">1.6.2.3.</span> <span class="nav-text">表的删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#表的复制"><span class="nav-number">1.6.2.4.</span> <span class="nav-text">表的复制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#练习"><span class="nav-number">1.6.3.</span> <span class="nav-text">练习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常见的数据类型"><span class="nav-number">1.6.4.</span> <span class="nav-text">常见的数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#原则"><span class="nav-number">1.6.4.1.</span> <span class="nav-text">原则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#整型"><span class="nav-number">1.6.4.2.</span> <span class="nav-text">整型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#小数"><span class="nav-number">1.6.4.3.</span> <span class="nav-text">小数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#字符型"><span class="nav-number">1.6.4.4.</span> <span class="nav-text">字符型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#char和varchar类型【重要】"><span class="nav-number">1.6.4.4.1.</span> <span class="nav-text">char和varchar类型【重要】</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#binary和varbinary类型"><span class="nav-number">1.6.4.4.2.</span> <span class="nav-text">binary和varbinary类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Enum类型"><span class="nav-number">1.6.4.4.3.</span> <span class="nav-text">Enum类型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Set类型"><span class="nav-number">1.6.4.4.4.</span> <span class="nav-text">Set类型</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#日期型"><span class="nav-number">1.6.4.5.</span> <span class="nav-text">日期型</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#datetime和timestamp区别"><span class="nav-number">1.6.4.5.1.</span> <span class="nav-text">datetime和timestamp区别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常见约束"><span class="nav-number">1.6.5.</span> <span class="nav-text">常见约束</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#列级约束与表级约束"><span class="nav-number">1.6.5.1.</span> <span class="nav-text">列级约束与表级约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#主键和唯一的对比【面试考-，重要】"><span class="nav-number">1.6.5.2.</span> <span class="nav-text">主键和唯一的对比【面试考 ，重要】</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#外键"><span class="nav-number">1.6.5.3.</span> <span class="nav-text">外键</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建表时添加约束"><span class="nav-number">1.6.5.4.</span> <span class="nav-text">创建表时添加约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改表时添加约束"><span class="nav-number">1.6.5.5.</span> <span class="nav-text">修改表时添加约束</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改表时删除约束"><span class="nav-number">1.6.5.6.</span> <span class="nav-text">修改表时删除约束</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#标识列"><span class="nav-number">1.6.6.</span> <span class="nav-text">标识列</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TCL语言"><span class="nav-number">1.7.</span> <span class="nav-text">TCL语言</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#事务"><span class="nav-number">1.7.1.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#了解存储引擎"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">了解存储引擎</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事务的ACID（acid）属性【重要】"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">事务的ACID（acid）属性【重要】</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事务的创建"><span class="nav-number">1.7.1.3.</span> <span class="nav-text">事务的创建</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#演示事务的使用步骤"><span class="nav-number">1.7.1.3.1.</span> <span class="nav-text">演示事务的使用步骤</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#并发事务【重要】"><span class="nav-number">1.7.2.</span> <span class="nav-text">并发事务【重要】</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#解决并发问题【重要】"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">解决并发问题【重要】</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#具体演示"><span class="nav-number">1.7.2.2.</span> <span class="nav-text">具体演示</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Mysql中设置隔离级别"><span class="nav-number">1.7.2.3.</span> <span class="nav-text">Mysql中设置隔离级别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete和truncate在事务使用时的区别"><span class="nav-number">1.7.2.4.</span> <span class="nav-text">delete和truncate在事务使用时的区别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#savepoint的使用"><span class="nav-number">1.7.2.5.</span> <span class="nav-text">savepoint的使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#视图"><span class="nav-number">1.8.</span> <span class="nav-text">视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建视图"><span class="nav-number">1.8.1.</span> <span class="nav-text">创建视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图的好处"><span class="nav-number">1.8.2.</span> <span class="nav-text">视图的好处</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图的修改"><span class="nav-number">1.8.3.</span> <span class="nav-text">视图的修改</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图的删除"><span class="nav-number">1.8.4.</span> <span class="nav-text">视图的删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看视图"><span class="nav-number">1.8.5.</span> <span class="nav-text">查看视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图练习"><span class="nav-number">1.8.6.</span> <span class="nav-text">视图练习</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图的更新"><span class="nav-number">1.8.7.</span> <span class="nav-text">视图的更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#视图与表的比较"><span class="nav-number">1.8.8.</span> <span class="nav-text">视图与表的比较</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#变量"><span class="nav-number">1.9.</span> <span class="nav-text">变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#系统变量"><span class="nav-number">1.9.1.</span> <span class="nav-text">系统变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义变量"><span class="nav-number">1.9.2.</span> <span class="nav-text">自定义变量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#对比用户变量和局部变量"><span class="nav-number">1.9.2.1.</span> <span class="nav-text">对比用户变量和局部变量</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储过程和函数"><span class="nav-number">1.10.</span> <span class="nav-text">存储过程和函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#存储过程"><span class="nav-number">1.10.1.</span> <span class="nav-text">存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#存储过程创建与调用"><span class="nav-number">1.10.1.1.</span> <span class="nav-text">存储过程创建与调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#存储过程删除"><span class="nav-number">1.10.1.2.</span> <span class="nav-text">存储过程删除</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看存储过程的信息"><span class="nav-number">1.10.1.3.</span> <span class="nav-text">查看存储过程的信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#存储过程练习"><span class="nav-number">1.10.1.4.</span> <span class="nav-text">存储过程练习</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数"><span class="nav-number">1.10.2.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#函数创建"><span class="nav-number">1.10.2.1.</span> <span class="nav-text">函数创建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数调用"><span class="nav-number">1.10.2.2.</span> <span class="nav-text">函数调用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#查看函数"><span class="nav-number">1.10.2.3.</span> <span class="nav-text">查看函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#删除函数"><span class="nav-number">1.10.2.4.</span> <span class="nav-text">删除函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数练习"><span class="nav-number">1.10.2.5.</span> <span class="nav-text">函数练习</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#流程控制结构"><span class="nav-number">1.11.</span> <span class="nav-text">流程控制结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#分支结构"><span class="nav-number">1.11.1.</span> <span class="nav-text">分支结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#IF函数"><span class="nav-number">1.11.1.1.</span> <span class="nav-text">IF函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CASE结构"><span class="nav-number">1.11.1.2.</span> <span class="nav-text">CASE结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IF结构"><span class="nav-number">1.11.1.3.</span> <span class="nav-text">IF结构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#循环结构"><span class="nav-number">1.11.2.</span> <span class="nav-text">循环结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#while"><span class="nav-number">1.11.2.1.</span> <span class="nav-text">while</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#loop"><span class="nav-number">1.11.2.2.</span> <span class="nav-text">loop</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#repeat"><span class="nav-number">1.11.2.3.</span> <span class="nav-text">repeat</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#循环的使用"><span class="nav-number">1.11.2.4.</span> <span class="nav-text">循环的使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#循环总结"><span class="nav-number">1.11.2.5.</span> <span class="nav-text">循环总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#重要函数"><span class="nav-number">1.12.</span> <span class="nav-text">重要函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#IFNULL【重要】"><span class="nav-number">1.12.1.</span> <span class="nav-text">IFNULL【重要】</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SET-NAMES-gbk"><span class="nav-number">1.12.2.</span> <span class="nav-text">SET NAMES gbk;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DATEDIFF（time1-time2）"><span class="nav-number">1.12.3.</span> <span class="nav-text">DATEDIFF（time1,time2）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#NOW"><span class="nav-number">1.12.4.</span> <span class="nav-text">NOW()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CONCAT"><span class="nav-number">1.12.5.</span> <span class="nav-text">CONCAT()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LIMIT"><span class="nav-number">1.12.6.</span> <span class="nav-text">LIMIT</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#牛客网题目"><span class="nav-number">1.13.</span> <span class="nav-text">牛客网题目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#快捷键"><span class="nav-number">1.14.</span> <span class="nav-text">快捷键</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL客户端"><span class="nav-number">1.14.1.</span> <span class="nav-text">MySQL客户端</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="未名Hugh"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">未名Hugh</p>
  <div class="site-description" itemprop="description">技术博客，Java，Spring Boot，并发编程，网络编程</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">未名Hugh</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.6.0
  </div>
-->

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共135.8k字</span>
</div>
        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/clicklove.js"></script>